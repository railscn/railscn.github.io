<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Rails 入门 — Ruby on Rails 指南</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
  <link rel="stylesheet" type="text/css" href="stylesheets/highlight.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/backtop.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/chntypo.css" data-turbolinks-track="reload">
  <link href="images/favicon.ico" rel="icon" type="image/x-icon" />
  <script src="javascripts/turbolinks.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/clipboard.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/guides.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/back2top.js" data-turbolinks-track="reload"></script>
  <meta property="og:title" content="Rails 入门 — Ruby on Rails 指南" />
  <meta name="description" content="Rails 入门本指南内容覆盖 Ruby on Rails 启动和运行的相关知识。通过阅读本指南，您将掌握： 如何安装 Rails，创建新 Rails 应用程序，以及连接应用程序和数据库系统。 Rails 应用程序常用布局（Layout）。 MVC（Model、View、Controller）和 REST 式设计的基本原理。 如何快速生成 Rails 应用程序的基本框架。" />
  <meta property="og:description" content="Rails 入门本指南内容覆盖 Ruby on Rails 启动和运行的相关知识。通过阅读本指南，您将掌握： 如何安装 Rails，创建新 Rails 应用程序，以及连接应用程序和数据库系统。 Rails 应用程序常用布局（Layout）。 MVC（Model、View、Controller）和 REST 式设计的基本原理。 如何快速生成 Rails 应用程序的基本框架。" />
  <meta property="og:locale" content="zh_CN" />
  <meta property="og:site_name" content="Ruby on Rails 指南" />
  <meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
  <meta property="og:type" content="website" />
</head>
<body class="guide">
  <div>
    <div id="version-badge">edge</div>
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">更多信息在 <a href="https://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        更多 Ruby on Rails 信息
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://rubyonrails.org/blog">博客</a></li>
        <li class="more-info"><a href="https://guides.rubyonrails.org/">指南</a></li>
        <li class="more-info"><a href="https://api.rubyonrails.org/">API</a></li>
        <li class="more-info"><a href="https://discuss.rubyonrails.org/">论坛</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">在 GitHub 做贡献</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="返回首页">railsguides.cn</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">首页</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">指南目录</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
            <dl class="guides-section-container">
                <div class="guides-section">
                  <dt>从这里开始</dt>
                  <dd><a href="getting_started.html">Rails 入门</a></dd>
                </div>
                <div class="guides-section">
                  <dt>模型（Model）</dt>
                  <dd><a href="active_record_basics.html">Active Record 基础</a></dd>
                  <dd><a href="active_record_migrations.html">Active Record 修改</a></dd>
                  <dd><a href="active_record_validations.html">Active Record 验证</a></dd>
                  <dd><a href="active_record_callbacks.html">Active Record 回调</a></dd>
                  <dd><a href="association_basics.html">Active Record 关联</a></dd>
                  <dd><a href="active_record_querying.html">Active Record 查询接口</a></dd>
                </div>
                <div class="guides-section">
                  <dt>视图（View）</dt>
                  <dd><a href="layouts_and_rendering.html">Rails 的模板布局与视图呈现</a></dd>
                  <dd><a href="form_helpers.html">Action View 表单辅助方法</a></dd>
                </div>
                <div class="guides-section">
                  <dt>控制器（Controller）</dt>
                  <dd><a href="action_controller_overview.html">Action Controller 概览</a></dd>
                  <dd><a href="routing.html">Rails 路由从入门到精通</a></dd>
                </div>
                <div class="guides-section">
                  <dt>其他组件</dt>
                  <dd><a href="active_support_core_extensions.html">Active Support 核心扩展</a></dd>
                  <dd><a href="action_mailer_basics.html">Action Mailer 基础</a></dd>
                  <dd><a href="active_job_basics.html">Active Job 基础</a></dd>
                  <dd><a href="active_storage_overview.html">Active Storage 概览</a></dd>
                  <dd><a href="action_cable_overview.html">Action Cable 概览</a></dd>
                  <dd><a href="webpacker.html">Webpacker</a></dd>
                </div>
                <div class="guides-section">
                  <dt>高级指南</dt>
                  <dd><a href="i18n.html">Rails 国际化（I18n） API</a></dd>
                  <dd><a href="testing.html">Rails 应用程序的测试</a></dd>
                  <dd><a href="security.html">Rails 应用程序的安全</a></dd>
                  <dd><a href="debugging_rails_applications.html">Rails 应用程序的调试</a></dd>
                  <dd><a href="configuring.html">Rails 应用程序的配置</a></dd>
                  <dd><a href="command_line.html">Rails 命令行</a></dd>
                  <dd><a href="asset_pipeline.html">Asset Pipeline</a></dd>
                  <dd><a href="working_with_javascript_in_rails.html">在 Rails 中使用 JavaScript</a></dd>
                  <dd><a href="autoloading_and_reloading_constants.html">自动加载和重载常量</a></dd>
                  <dd><a href="classic_to_zeitwerk_howto.html">如何从传统过渡到 Zeitwerk</a></dd>
                  <dd><a href="caching_with_rails.html">Rails 缓存概览</a></dd>
                  <dd><a href="api_app.html">用 Rails 只做应用程序后台 API</a></dd>
                  <dd><a href="active_record_multiple_databases.html">Active Record 支持多数据库</a></dd>
                </div>
                <div class="guides-section">
                  <dt>扩展 Rails</dt>
                  <dd><a href="rails_on_rack.html">Rack 中的 Rails</a></dd>
                  <dd><a href="generators.html">创建和定制 Rails 生成器/模板</a></dd>
                </div>
                <div class="guides-section">
                  <dt>贡献</dt>
                  <dd><a href="contributing_to_ruby_on_rails.html">为 Ruby on Rails 贡献</a></dd>
                  <dd><a href="api_documentation_guidelines.html">API 文档指南</a></dd>
                  <dd><a href="ruby_on_rails_guides_guidelines.html">指南大纲</a></dd>
                </div>
                <div class="guides-section">
                  <dt>政策（Policies）</dt>
                  <dd><a href="maintenance_policy.html">维护政策</a></dd>
                </div>
                <div class="guides-section">
                  <dt>版本说明</dt>
                  <dd><a href="upgrading_ruby_on_rails.html">更新 Ruby on Rails</a></dd>
                  <dd><a href="7_0_release_notes.html">7.0 版本 —— 2021 年 12 月</a></dd>
                  <dd><a href="6_1_release_notes.html">6.1 版本 —— 2020 年 12 月</a></dd>
                  <dd><a href="6_0_release_notes.html">6.0 版本 —— 2019 年 9 月</a></dd>
                  <dd><a href="5_2_release_notes.html">5.2 版本 —— 2018 年 4 月</a></dd>
                  <dd><a href="5_1_release_notes.html">5.1 版本 —— 2017 年 4 月</a></dd>
                  <dd><a href="5_0_release_notes.html">5.0 版本 —— 2016 年 6 月</a></dd>
                  <dd><a href="4_2_release_notes.html">4.2 版本 —— 2014 年 12 月</a></dd>
                  <dd><a href="4_1_release_notes.html">4.1 版本 —— 2014 年 4 月</a></dd>
                  <dd><a href="4_0_release_notes.html">4.0 版本 —— 2013 年 6 月</a></dd>
                  <dd><a href="3_2_release_notes.html">3.2 版本 —— 2012 年 1 月</a></dd>
                  <dd><a href="3_1_release_notes.html">3.1 版本 —— 2011 年 8 月</a></dd>
                  <dd><a href="3_0_release_notes.html">3.0 版本 —— 2010 年 8 月</a></dd>
                  <dd><a href="2_3_release_notes.html">2.3 版本 —— 2009 年 3 月</a></dd>
                  <dd><a href="2_2_release_notes.html">2.2 版本 —— 2008 年 11 月</a></dd>
                </div>
            </dl>
          </div>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">贡献</a></li>
        <li><a class="nav-item" href="about.html">关于</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">指南目录</option>
              <optgroup label="从这里开始">
                  <option value="getting_started.html">Rails 入门</option>
              </optgroup>
              <optgroup label="模型（Model）">
                  <option value="active_record_basics.html">Active Record 基础</option>
                  <option value="active_record_migrations.html">Active Record 修改</option>
                  <option value="active_record_validations.html">Active Record 验证</option>
                  <option value="active_record_callbacks.html">Active Record 回调</option>
                  <option value="association_basics.html">Active Record 关联</option>
                  <option value="active_record_querying.html">Active Record 查询接口</option>
              </optgroup>
              <optgroup label="视图（View）">
                  <option value="layouts_and_rendering.html">Rails 的模板布局与视图呈现</option>
                  <option value="form_helpers.html">Action View 表单辅助方法</option>
              </optgroup>
              <optgroup label="控制器（Controller）">
                  <option value="action_controller_overview.html">Action Controller 概览</option>
                  <option value="routing.html">Rails 路由从入门到精通</option>
              </optgroup>
              <optgroup label="其他组件">
                  <option value="active_support_core_extensions.html">Active Support 核心扩展</option>
                  <option value="action_mailer_basics.html">Action Mailer 基础</option>
                  <option value="active_job_basics.html">Active Job 基础</option>
                  <option value="active_storage_overview.html">Active Storage 概览</option>
                  <option value="action_cable_overview.html">Action Cable 概览</option>
                  <option value="webpacker.html">Webpacker</option>
              </optgroup>
              <optgroup label="高级指南">
                  <option value="i18n.html">Rails 国际化（I18n） API</option>
                  <option value="testing.html">Rails 应用程序的测试</option>
                  <option value="security.html">Rails 应用程序的安全</option>
                  <option value="debugging_rails_applications.html">Rails 应用程序的调试</option>
                  <option value="configuring.html">Rails 应用程序的配置</option>
                  <option value="command_line.html">Rails 命令行</option>
                  <option value="asset_pipeline.html">Asset Pipeline</option>
                  <option value="working_with_javascript_in_rails.html">在 Rails 中使用 JavaScript</option>
                  <option value="autoloading_and_reloading_constants.html">自动加载和重载常量</option>
                  <option value="classic_to_zeitwerk_howto.html">如何从传统过渡到 Zeitwerk</option>
                  <option value="caching_with_rails.html">Rails 缓存概览</option>
                  <option value="api_app.html">用 Rails 只做应用程序后台 API</option>
                  <option value="active_record_multiple_databases.html">Active Record 支持多数据库</option>
              </optgroup>
              <optgroup label="扩展 Rails">
                  <option value="rails_on_rack.html">Rack 中的 Rails</option>
                  <option value="generators.html">创建和定制 Rails 生成器/模板</option>
              </optgroup>
              <optgroup label="贡献">
                  <option value="contributing_to_ruby_on_rails.html">为 Ruby on Rails 贡献</option>
                  <option value="api_documentation_guidelines.html">API 文档指南</option>
                  <option value="ruby_on_rails_guides_guidelines.html">指南大纲</option>
              </optgroup>
              <optgroup label="政策（Policies）">
                  <option value="maintenance_policy.html">维护政策</option>
              </optgroup>
              <optgroup label="版本说明">
                  <option value="upgrading_ruby_on_rails.html">更新 Ruby on Rails</option>
                  <option value="7_0_release_notes.html">7.0 版本 —— 2021 年 12 月</option>
                  <option value="6_1_release_notes.html">6.1 版本 —— 2020 年 12 月</option>
                  <option value="6_0_release_notes.html">6.0 版本 —— 2019 年 9 月</option>
                  <option value="5_2_release_notes.html">5.2 版本 —— 2018 年 4 月</option>
                  <option value="5_1_release_notes.html">5.1 版本 —— 2017 年 4 月</option>
                  <option value="5_0_release_notes.html">5.0 版本 —— 2016 年 6 月</option>
                  <option value="4_2_release_notes.html">4.2 版本 —— 2014 年 12 月</option>
                  <option value="4_1_release_notes.html">4.1 版本 —— 2014 年 4 月</option>
                  <option value="4_0_release_notes.html">4.0 版本 —— 2013 年 6 月</option>
                  <option value="3_2_release_notes.html">3.2 版本 —— 2012 年 1 月</option>
                  <option value="3_1_release_notes.html">3.1 版本 —— 2011 年 8 月</option>
                  <option value="3_0_release_notes.html">3.0 版本 —— 2010 年 8 月</option>
                  <option value="2_3_release_notes.html">2.3 版本 —— 2009 年 3 月</option>
                  <option value="2_2_release_notes.html">2.2 版本 —— 2008 年 11 月</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Rails 入门</h2><p>本指南内容覆盖 Ruby on Rails 启动和运行的相关知识。</p><p>通过阅读本指南，您将掌握：</p>
<ul>
<li>如何安装 Rails，创建新 Rails 应用程序，以及连接应用程序和数据库系统。</li>
<li>Rails 应用程序常用布局（Layout）。</li>
<li>MVC（Model、View、Controller）和 REST 式设计的基本原理。</li>
<li>如何快速生成 Rails 应用程序的基本框架。</li>
</ul>


                <div id="subCol" data-turbolinks="false">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />题要</h3>
            <ol class="chapters">
<li><a href="#%E6%8C%87%E5%8D%97%E8%AE%BE%E5%AE%9A">指南设定</a></li>
<li><a href="#rails-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F">Rails 是什么？</a></li>
<li>
<a href="#%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0-rails-%E9%A1%B9%E7%9B%AE">构建一个新 Rails 项目</a>

<ul>
<li><a href="#%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0-rails-%E9%A1%B9%E7%9B%AE-%E5%AE%89%E8%A3%85-rails">安装 Rails</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA-blog-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F">创建 Blog 应用程序</a></li>
</ul>
</li>
<li>
<a href="#hello%EF%BC%8Crails%EF%BC%81">Hello，Rails！</a>

<ul>
<li><a href="#%E5%90%AF%E5%8A%A8-web-%E6%9C%8D%E5%8A%A1%E5%99%A8">启动 Web 服务器</a></li>
<li><a href="#%E8%AF%B4-hello-%EF%BC%8Crails">说 "Hello"，Rails</a></li>
<li><a href="#%E8%AE%BE%E5%AE%9A%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E4%B8%BB%E9%A1%B5">设定应用程序主页</a></li>
</ul>
</li>
<li><a href="#%E8%87%AA%E5%8A%A8%E5%8A%A0%E8%BD%BD">自动加载</a></li>
<li>
<a href="#mvc-%E5%92%8C%E6%82%A8">MVC 和您</a>

<ul>
<li><a href="#mvc-%E5%92%8C%E6%82%A8-%E7%94%9F%E6%88%90%E6%A8%A1%E5%9E%8B">生成模型</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%94%B9%E8%BF%81">数据库改迁</a></li>
<li><a href="#%E7%94%A8%E6%A8%A1%E5%9E%8B%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%92%E5%8A%A8">用模型与数据库互动</a></li>
<li><a href="#%E6%98%BE%E7%A4%BA%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8">显示文章列表</a></li>
</ul>
</li>
<li>
<a href="#%E5%BD%93-crud-%E5%88%99-crud">当 CRUD 则 CRUD</a>

<ul>
<li><a href="#%E6%98%BE%E7%A4%BA%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0">显示一篇文章</a></li>
<li><a href="#%E8%B5%84%E6%BA%90%E5%8C%96%E8%B7%AF%E7%94%B1">资源化路由</a></li>
<li><a href="#%E6%96%B0%E5%BB%BA%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0">新建一篇文章</a></li>
<li><a href="#%E6%9B%B4%E6%96%B0%E6%96%87%E7%AB%A0">更新文章</a></li>
<li><a href="#%E5%88%A0%E9%99%A4%E6%96%87%E7%AB%A0">删除文章</a></li>
</ul>
</li>
<li>
<a href="#%E6%B7%BB%E5%8A%A0%E7%AC%AC%E4%BA%8C%E4%B8%AA%E6%A8%A1%E5%9E%8B">添加第二个模型</a>

<ul>
<li><a href="#%E6%B7%BB%E5%8A%A0%E7%AC%AC%E4%BA%8C%E4%B8%AA%E6%A8%A1%E5%9E%8B-%E7%94%9F%E6%88%90%E6%A8%A1%E5%9E%8B">生成模型</a></li>
<li><a href="#%E6%A8%A1%E5%9E%8B%E5%85%B3%E8%81%94">模型关联</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0%E8%AF%84%E8%AE%BA%EF%BC%88comment%EF%BC%89%E8%B7%AF%E7%94%B1">添加评论（Comment）路由</a></li>
<li><a href="#%E7%94%9F%E6%88%90%E6%8E%A7%E5%88%B6%E5%99%A8%EF%BC%88controller%EF%BC%89">生成控制器（Controller）</a></li>
</ul>
</li>
<li>
<a href="#%E9%87%8D%E6%9E%84">重构</a>

<ul>
<li><a href="#%E9%80%9A%E8%BF%87%E5%B1%80%E9%83%A8%E6%A8%A1%E6%9D%BF%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE%E9%9B%86">通过局部模板渲染数据集</a></li>
<li><a href="#%E6%B8%B2%E6%9F%93%E5%B1%80%E9%83%A8%E6%A8%A1%E6%9D%BF%E8%A1%A8%E5%8D%95">渲染局部模板表单</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E7%84%A6%E7%82%B9%EF%BC%88concern%EF%BC%89">使用焦点（Concern）</a></li>
</ul>
</li>
<li>
<a href="#%E5%88%A0%E9%99%A4%E8%AF%84%E8%AE%BA">删除评论</a>

<ul>
<li><a href="#%E5%88%A0%E9%99%A4%E5%85%B3%E8%81%94%E5%AF%B9%E8%B1%A1">删除关联对象</a></li>
</ul>
</li>
<li>
<a href="#%E5%AE%89%E5%85%A8">安全</a>

<ul>
<li><a href="#%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%81">基本认证</a></li>
<li><a href="#%E5%85%B6%E4%BB%96%E5%AE%89%E5%85%A8%E6%96%B9%E6%A1%88">其他安全方案</a></li>
</ul>
</li>
<li><a href="#%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%81%9A%E4%BB%80%E4%B9%88%EF%BC%9F">接下来做什么？</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE%E7%9A%84%E5%9D%91">配置的坑</a></li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id="指南设定"><a class="anchorlink" href="#%E6%8C%87%E5%8D%97%E8%AE%BE%E5%AE%9A" data-turbolinks="false">1 指南设定</a></h3><p>本指南面向那些希望通过创建一个应用程序的过程就可以上手 Rails 的初学者——这也就是说不需要您有任何的 Rails 编程经验。</p><p>Rails 是一款基于 Ruby 编程语言的 Web 应用程序框架。如果您没有 Ruby 编程经验，想要深入学习
Rails 可能会有一定的困难。这有一个精选的在线 Ruby 学习资源清单：</p>
<ul>
<li><a href="https://www.ruby-lang.org/en/documentation/">Ruby 编程语言官方站点</a></li>
<li><a href="https://github.com/EbookFoundation/free-programming-books/blob/master/books/free-programming-books-langs.md#ruby">免费编程书籍列表</a></li>
</ul>
<p>有些资源虽然很优秀，但是可能是基于旧版的 Ruby，所以对您日常 Rails 开发可能会有些遗憾——因为有些学习资源还没有涵盖最新的语法知识。</p><h3 id="rails-是什么？"><a class="anchorlink" href="#rails-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F" data-turbolinks="false">2 Rails 是什么？</a></h3><p>Rails 是基于 Ruby 编程语言的 Web 应用程序开发框架。其使 Web 编程更容易的设计得宜于
预设了每个开发者开始时的需要。同其他语言和框架相比，它可以做到写更少的代码完成更多的
功能。甚至有经验丰富的开发者称 Rails 开发更有趣。</p><p>Rails 是自以为是的软件——它坚信做任何事都有“最好”的方式，也鼓励您使用最好的方式——换句话说，
也就是不鼓励其他方式。如果您学会了 “Rails 之道”，您会发现您的研发能力会大幅提升。如果您
坚持将其他语言的开发习惯带入到 Rails 开发中，可能您的体验会很糟糕。</p><p>Rails 哲学包含两条主要的指导原则：</p>
<ul>
<li>
<strong>DRY - Don't Repeat Yourself（不自我重复）:</strong> DRY 是软件开发的一条原则，它指出
“每一条知识在系统中有应该是单一的、明确的、权威的表述”。只有不重复编写相同的信息，
我们的代码才会更易于维护、更具有扩展性且错误更少。</li>
<li>
<strong>COC - Convention Over Configuration（约定优于配置）:</strong> Rails 认为在 Web 应用程
序开发中每件事都有最好的方式——这些最好的方式就是默认的约定设置，而不是去进行无休止的
配置文件设定。</li>
</ul>
<h3 id="构建一个新-rails-项目"><a class="anchorlink" href="#%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0-rails-%E9%A1%B9%E7%9B%AE" data-turbolinks="false">3 构建一个新 Rails 项目</a></h3><p>阅读本指南最好的方式就是跟着指南一步一步做。所有的步骤都是运行本示例程序必
须的，没有多余的代码和不必要的步骤。</p><p>按照指南的步骤，您会创建一个叫做 <code>blog</code> 的 Rails 项目，这是一个（非常）简单的博客程序。
在构建应用程序之前，您需要确认是否安装了 Rails。</p><div class="note"><p>下面的示例中使用 <code>$</code> 代表类 UNIX 系统的终端提示符，当然该符号可以通过定制来改变，
我们这里只使用最原始的符号。如果您使用的是 Windows 系统，您的提示符应该像这样 <code>C:\source_code&gt;</code>。</p></div><h4 id="构建一个新-rails-项目-安装-rails"><a class="anchorlink" href="#%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0-rails-%E9%A1%B9%E7%9B%AE-%E5%AE%89%E8%A3%85-rails" data-turbolinks="false">3.1 安装 Rails</a></h4><p>安装 Rails 之前，您需要检查您的操作系统是否预装了：</p>
<ul>
<li>Ruby</li>
<li>SQLite3</li>
</ul>
<h5 id="安装-ruby"><a class="anchorlink" href="#%E5%AE%89%E8%A3%85-ruby" data-turbolinks="false">3.1.1 安装 Ruby</a></h5><p>打开一个命令行终端。macOS 系统打开 Terminal.app；Windows 系统从开始菜单选择
“运行”，然后输入<code>cmd.exe</code>。任何以美元符号<code>$</code>开始的行都表示在终端命令行下
输入的命令。验证您是否安装了正确的 Ruby 版本：</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">ruby</span> <span class="nt">--version</span>
<span class="go">ruby 2.7.0
</span></code></pre>
<button class="clipboard-button" data-clipboard-text="ruby --version
">复制</button>
</div>
<p>Rails 需要 Ruby 2.7.0 或更高版本，当然最好使用最新版本的 Ruby。
如果命令行反馈的版本数字低于上面看到的（例如 2.3.7, or 1.8.7），您就需要安装
一个更新的 Ruby 版本。</p><p>在 Winodows 上安装 Rails，需要首先安装 <a href="https://rubyinstaller.org/">Ruby Installer</a>。</p><p>更多与操作系统相关的安装方法参阅
<a href="https://www.ruby-lang.org/en/documentation/installation/">ruby-lang.org</a>。</p><h5 id="安装-sqlite3"><a class="anchorlink" href="#%E5%AE%89%E8%A3%85-sqlite3" data-turbolinks="false">3.1.2 安装 SQLite3</a></h5><p>SQLite3 数据库是 Rails 的默认数据库。许多类 UNIX 系统都会默认安装系统许可版
本的 SQLite3。如果没有安装可参考 <a href="https://www.sqlite.org">SQLite3 站点</a>的安装
说明进行安装。</p><p>验证 SQLite3 是否安装以及是否已经加载到 <code>PATH</code>：</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">sqlite3</span> <span class="nt">--version</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="sqlite3 --version
">复制</button>
</div>
<p>程序会反馈其安装的版本。</p><h5 id="构建一个新-rails-项目-安装-rails-安装-rails"><a class="anchorlink" href="#%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0-rails-%E9%A1%B9%E7%9B%AE-%E5%AE%89%E8%A3%85-rails-%E5%AE%89%E8%A3%85-rails" data-turbolinks="false">3.1.3 安装 Rails</a></h5><p>安装 Rails，使用 RubyGems 提供的 <code>gem install</code> 命令：</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">gem install rails</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="gem install rails
">复制</button>
</div>
<p>验证安装正确与否，在终端运行下面命令：</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails</span> <span class="nt">--version</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="rails --version
">复制</button>
</div>
<p>如果反馈信息类似于 “Rails 7.0.0”，则说明您的系统已经准备好了。</p><h4 id="创建-blog-应用程序"><a class="anchorlink" href="#%E5%88%9B%E5%BB%BA-blog-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F" data-turbolinks="false">3.2 创建 Blog 应用程序</a></h4><p>Rails 自带一组称为生成器的脚本程序，这些生成器是专门针对开发初期的各种任务、生成相应
文件等进行的定制，使用这些生成器可以使您的开发更容易。这些生成器之一就是——新应用程序
生成器，该生成器会生成一个全新的应用程序，包括基本目录结构和必要的文件等等，有了它就
不需要您自己去一个个编写了。</p><p>使用该生成器，需要打开一个终端，进入您享有编写文件权限的目录，然后运行：</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>new blog
</code></pre>
<button class="clipboard-button" data-clipboard-text="rails new blog
">复制</button>
</div>
<p>该命令将在 <code>blog</code> 目录生成一个叫做 Blog 的 Rails 应用程序，并且使用 <code>bundle install</code>
 命令安装 <code>Gemfile</code> 中提供的所有依赖的 Gem。
.</p><div class="info"><p>通过运行 <code>rails new --help</code> 您可查阅 Rails 应用程序生成器可接受的所有命令行选项。</p></div><p>创建 blog 程序之后，进入应用程序文件夹：</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>blog
</code></pre>
<button class="clipboard-button" data-clipboard-text="cd blog
">复制</button>
</div>
<p><code>blog</code> 目录内有很多文件夹和文件，这些文件和文件夹共同构成了 Rails 应用程序。 接下来
本教程的操作基本都是在 <code>app</code> 文件夹内进行，关于这些 Rails 生成的文件夹和文件的功能和
用途见下表：</p>
<table>
<thead>
<tr>
<th>文件/文件夹</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>app/</td>
<td>包含控制器、模型、视图、helpers、mailers、channels、jobs、和应用程序资源等。本指南的其余部分也将重点关注此文件夹。</td>
</tr>
<tr>
<td>bin/</td>
<td>包含用于启动您的应用和其他诸如创建、更新、发布或者运行应用程序的 <code>rails</code> 命令等。</td>
</tr>
<tr>
<td>config/</td>
<td>包含设置应用程序路由、数据库等的配置文件，更多细节查阅 <a href="configuring.html">Rails 应用程序配置</a>。</td>
</tr>
<tr>
<td>config.ru</td>
<td>为基于 Rack 的服务器进行启动配置。更多信息参阅 <a href="https://rack.github.io/">Rack 站点</a>。</td>
</tr>
<tr>
<td>db/</td>
<td>包含您的当前数据库的 Schema 以及数据库迁移文件等。</td>
</tr>
<tr>
<td>Gemfile<br>Gemfile.lock</td>
<td>这些文件用于定义您的 Rails 应用程序有那些 Gem 依赖。通常配合 Bundler 使用，更多信息 参阅 <a href="https://bundler.io">Bundler 站点</a>。</td>
</tr>
<tr>
<td>lib/</td>
<td>您的应用程序的扩展模块。</td>
</tr>
<tr>
<td>log/</td>
<td>应用程序日志文件。</td>
</tr>
<tr>
<td>public/</td>
<td>包含静态文件和编译资源。当您的应用运行的时候，该目录会完全开放。</td>
</tr>
<tr>
<td>Rakefile</td>
<td>此文件定位和加载可从命令行运行的任务。通过 Rails 组件定义任务。您应该通过将文件添加到应用程序的 <code>lib/tasks</code> 目录来添加自己的任务，而不是更改 <code>Rakefile</code>。</td>
</tr>
<tr>
<td>README.md</td>
<td>这是您的应用的简要说明书——通过该文件内容告诉其他人您的应用是做什么的，如何运行等等。</td>
</tr>
<tr>
<td>storage/</td>
<td>基于硬盘服务的 Active Storage 文件存储目录。更多信息查阅 <a href="active_storage_overview.html">Active Storage 概览</a>。</td>
</tr>
<tr>
<td>test/</td>
<td>单元测试、夹具和其他测试数据。更多信息参阅<a href="testing.html">测试 Rails 应用程序</a>。</td>
</tr>
<tr>
<td>tmp/</td>
<td>临时文件（例如缓存和 pid 文件）。</td>
</tr>
<tr>
<td>vendor/</td>
<td>放置第三方代码的目录。典型的 Rails 应用程序这里会托管 Gem。</td>
</tr>
<tr>
<td>.gitattributes</td>
<td>此文件定义一个 Git 代码库的规范路径元数据，可用于 Git 或者其他工具来增强其功能。更多细节参阅  <a href="https://git-scm.com/docs/gitattributes">gitattributes 文档</a>。</td>
</tr>
<tr>
<td>.gitignore</td>
<td>此文件告诉 Git 那些文件（或者模式）应该忽略追踪。更多信息查阅 <a href="https://help.github.com/articles/ignoring-files">GitHub - 忽略文件</a> 。</td>
</tr>
<tr>
<td>.ruby-version</td>
<td>此文件包含默认 Ruby 版本。</td>
</tr>
</tbody>
</table>
<h3 id="hello，rails！"><a class="anchorlink" href="#hello%EF%BC%8Crails%EF%BC%81" data-turbolinks="false">4 Hello，Rails！</a></h3><p>接下来，我们想在屏幕上显示一些文字。所以，您需要让 Rails 应用程序服务器运行起来。</p><h4 id="启动-web-服务器"><a class="anchorlink" href="#%E5%90%AF%E5%8A%A8-web-%E6%9C%8D%E5%8A%A1%E5%99%A8" data-turbolinks="false">4.1 启动 Web 服务器</a></h4><p>实际上，Rails 早已准备好了一切。让我们来看一下，如何在开发计算机上启动 Web 
服务器：您需要在 <code>blog</code> 目录下运行命令：</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>server
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails server
">复制</button>
</div>
<div class="info"><p>如果您使用的是 Windows 操作系统，需要传递 <code>bin</code>文件夹下的启动脚本给 Ruby
 解释器，例如： <code>ruby bin\rails server</code>。</p></div><div class="info"><p>JavaScript 资产压缩需要操作系统提供 JavaScript 运行时环境，如果没有程序
在进行资产压缩时您会收到 <code>execjs</code> 错误信息。macOS 和 Windows 通常会预先安装
 JavaScript 运行时环境。JRuby 用户推荐使用 <code>therubyrhino</code> 运行时环境，想要添
 该软件可以通过在应用程序的 <code>Gemfile</code> 中添加。您可以在 <a href="https://github.com/rails/execjs#readme">ExecJS</a>
  查阅所有的运行时环境详情。</p></div><p>这将启动 Rails 默认的 Web 服务器——Puma。要查看您的应用程序，打开浏览器窗口，
进入 <a href="http://localhost:3000">http://localhost:3000</a>。您会看到 Rails 默认信息页面：</p><p><img src="images/getting_started/rails_welcome.png" alt="Rails 启动页面截屏"></p><p>要停止 Web 服务器，在服务器运行终端窗口内点击 Ctrl+C。在开发环境下，Rails 通
常不需要您重启服务器；您所作的文件修改会被服务器捕捉到并且自动加载。</p><p>Rails 启动页面只是针对新 Rails 应用程序的<em>冒烟测试</em>：它只确保您的服务器配置
正确并且可以运行提供网页服务。</p><h4 id="说-hello-，rails"><a class="anchorlink" href="#%E8%AF%B4-hello-%EF%BC%8Crails" data-turbolinks="false">4.2 说 "Hello"，Rails</a></h4><p>让 Rails 说“Hello”，您需要创建最简单的<strong>路由（route）</strong>，一个<strong>控制器（controller）</strong>
和一个<strong>动作（action）</strong>和一个<strong>视图（view）</strong>。路由映射请求（request）到控制器
动作（action）；控制器动作执行必要的运算处理请求，然后为视图（view)准备数据。
最后视图根据需要呈现最终结果。</p><p>用术语解释：路由使用 Ruby <a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL (Domain-Specific Language)</a> 
编写的规则；控制器是 Ruby 类，其公共方法就是动作；视图就是混合 HTML 和 Ruby
 的模板。</p><p>让我们开始添加一条路由到路由文件 <code>config/routes.rb</code> 中，在 <code>Rails.application.routes.draw</code> 块
的顶部加入：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#index"</span>

  <span class="c1"># For details on the DSL available within this file, see https://guides.rubyonrails.org/routing.html</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='Rails.application.routes.draw do
  get "/articles", to: "articles#index"

  # For details on the DSL available within this file, see https://guides.rubyonrails.org/routing.html
end
'>复制</button>
</div>
<p>上面的路由声明 <code>GET /articles</code> 请求映射到 <code>ArticlesController</code> 控制器的 <code>index</code> 
动作上。</p><p>创建 <code>ArticlesController</code> 和它的 <code>index</code> 动作，我们需要运行控制器生成器（使用
 <code>--skip-routes</code> 选项是因为我们已经有了路由）：</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate controller Articles index <span class="nt">--skip-routes</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails generate controller Articles index --skip-routes
">复制</button>
</div>
<p>Rails 会生成一些文件：</p><div class="code_container">
<pre><code class="highlight plaintext">create  app/controllers/articles_controller.rb
invoke  erb
create    app/views/articles
create    app/views/articles/index.html.erb
invoke  test_unit
create    test/controllers/articles_controller_test.rb
invoke  helper
create    app/helpers/articles_helper.rb
invoke    test_unit
</code></pre>
<button class="clipboard-button" data-clipboard-text="create  app/controllers/articles_controller.rb
invoke  erb
create    app/views/articles
create    app/views/articles/index.html.erb
invoke  test_unit
create    test/controllers/articles_controller_test.rb
invoke  helper
create    app/helpers/articles_helper.rb
invoke    test_unit
">复制</button>
</div>
<p>最重要的是控制器文件 <code>app/controllers/articles_controller.rb</code>。然我们看一看它：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class ArticlesController &lt; ApplicationController
  def index
  end
end
">复制</button>
</div>
<p><code>index</code> 动作没有内容。当一个动作没有没有明确指定渲染的视图（或者以其他方式
触发一个 HTTP 响应）时，Rails 会根据控制器和动作名称自动匹配视图。约定优于配置！视图
位置在 <code>app/views</code> 目录。所以，<code>index</code> 动作默认由 <code>app/views/articles/index.html.erb</code> 
渲染。</p><p>让我们打开文件 <code>app/views/articles/index.html.erb</code>，输入以下内容：</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;h1&gt;</span>Hello, Rails!<span class="nt">&lt;/h1&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;h1&gt;Hello, Rails!&lt;/h1&gt;
">复制</button>
</div>
<p>如果您前面运行控制器生成器时已经停止了 Web 服务器，那么用 <code>bin/rails server</code> 重启服
务器。然后访问 <a href="http://localhost:3000/articles">http://localhost:3000/articles</a>，看一看我们设定的文字。</p><h4 id="设定应用程序主页"><a class="anchorlink" href="#%E8%AE%BE%E5%AE%9A%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E4%B8%BB%E9%A1%B5" data-turbolinks="false">4.3 设定应用程序主页</a></h4><p>此时，<a href="http://localhost:3000">http://localhost:3000</a> 还是那个显示 Ruby on Rails 标志的页面。让我们在 <a href="http://localhost:3000">http://localhost:3000</a> 
显示我们设定的 "Hello, Rails!" 吧。要想达到这个效果，我们还需要添加一条路由来映射应
用程序的<strong>根路径（root path）</strong> 到特定的控制器和动作上。</p><p>我们打开 <code>config/routes.rb</code>，添加下面的 <code>root</code> 路由到 <code>Rails.application.routes.draw</code> 
代码块的顶部：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s2">"articles#index"</span>

  <span class="n">get</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#index"</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='Rails.application.routes.draw do
  root "articles#index"

  get "/articles", to: "articles#index"
end
'>复制</button>
</div>
<p>现在当我们访问 <a href="http://localhost:3000">http://localhost:3000</a> 的时候看到我们设定的“Hello, Rails!”了，这表明
 <code>root</code> 路由确实映射到了 <code>ArticlesController</code> 控制器的 <code>index</code> 动作上。</p><div class="info"><p>学习更多路由知识，查阅 <a href="routing.html">Rails 路由全解</a>。</p></div><h3 id="自动加载"><a class="anchorlink" href="#%E8%87%AA%E5%8A%A8%E5%8A%A0%E8%BD%BD" data-turbolinks="false">5 自动加载</a></h3><p>Rails 应用程序<strong>不</strong>使用 <code>require</code> 来加载 application 代码。</p><p>您可能已经注意到 <code>ArticlesController</code> 继承自 <code>ApplicationController</code>，但是 <code>app/controllers/articles_controller.rb</code> 中没有类似</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">require</span> <span class="s2">"application_controller"</span> <span class="c1"># DON'T DO THIS.</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="require &quot;application_controller&quot; # DON'T DO THIS.
">复制</button>
</div>
<p>的代码。</p><p>Application 类和模块在应用程序中随处可用，在 <code>app</code> 目录您不需要并且<strong>不应当</strong>使用 
<code>require</code> 加载任何东西。这个功能叫做<strong>自动加载（autoloading）</strong>，更多信息查阅<a href="https://guides.rubyonrails.org/autoloading_and_reloading_constants.html"><em>常量的自动加载和重载</em></a>。</p><p>您需要使用 <code>require</code> 的情况只有两种：</p>
<ul>
<li>加载 <code>lib</code> 目录的文件。</li>
<li>加载在 <code>Gemfile</code> 中已经设置 <code>require: false</code> 的 Gem。</li>
</ul>
<h3 id="mvc-和您"><a class="anchorlink" href="#mvc-%E5%92%8C%E6%82%A8" data-turbolinks="false">6 MVC 和您</a></h3><p>迄今为止，我们已经讨论过路由、控制器、动作和视图。所有的这些，都是遵循 
<a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">MVC (Model-View-Controller)</a>
模式的 Web 应用的典型组成。MVC 是一种将应用程序的职责分开以使其更容易管理的设计模式。
Rails 按照管理就遵从了这种设计模式。</p><p>因为我们已经有了一个控制器和一个视图，接下来我们要生成另一部分：一个模型。</p><h4 id="mvc-和您-生成模型"><a class="anchorlink" href="#mvc-%E5%92%8C%E6%82%A8-%E7%94%9F%E6%88%90%E6%A8%A1%E5%9E%8B" data-turbolinks="false">6.1 生成模型</a></h4><p>一个<strong>模型（Model）</strong>就是一个用于表示数据的 Ruby 类。另外，模型可以同应用程
序的数据库基于 Rails 的 <strong>Active Record</strong> 进行互动。</p><p>定义一个模型，我们需要使用模型生成器：</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate model Article title:string body:text
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails generate model Article title:string body:text
">复制</button>
</div>
<div class="note"><p>模型名字用<strong>单数</strong>，因为一个实例化的模型代表一个数据。为了有助于记住
这条约定，想象一下您要调用模型生成器：我们想要写新文章——<code>Article.new(...)</code>，
<strong>不是</strong>新文章们——<code>Articles.new(...)</code>。</p></div><p>这将生成一些文件：</p><div class="code_container">
<pre><code class="highlight plaintext">invoke  active_record
create    db/migrate/&lt;timestamp&gt;_create_articles.rb
create    app/models/article.rb
invoke    test_unit
create      test/models/article_test.rb
create      test/fixtures/articles.yml
</code></pre>
<button class="clipboard-button" data-clipboard-text="invoke  active_record
create    db/migrate/&lt;timestamp&gt;_create_articles.rb
create    app/models/article.rb
invoke    test_unit
create      test/models/article_test.rb
create      test/fixtures/articles.yml
">复制</button>
</div>
<p>两个主要的文件是改迁文件（<code>db/migrate/&lt;timestamp&gt;_create_articles.rb</code>）和模型
文件（<code>app/models/article.rb</code>）。</p><h4 id="数据库改迁"><a class="anchorlink" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%94%B9%E8%BF%81" data-turbolinks="false">6.2 数据库改迁</a></h4><p><strong>改迁（Migration）</strong>用于修改用用程序的数据库结构。在 Rails 应用程序中，改迁
文件使用 Ruby 编写，所以他们可以做到与数据库系统无关。</p><p>我们来看一下我们的新改迁文件内容：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">CreateArticles</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">7.0</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:articles</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:title</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">text</span> <span class="ss">:body</span>

      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class CreateArticles &lt; ActiveRecord::Migration[7.0]
  def change
    create_table :articles do |t|
      t.string :title
      t.text :body

      t.timestamps
    end
  end
end
">复制</button>
</div>
<p>调用 <code>create_table</code> 指定将对 <code>articles</code> 表的进行修改。默认情况下，<code>create_table</code>
 方法添加 <code>id</code> 栏做为自增主键。所以表的第一条记录的 <code>id</code> 是 1，下一条记录的
 <code>id</code> 是 2，以此类推。</p><p>在代码块 <code>create_table</code> 内定义了两栏：<code>title</code> 和 <code>body</code>。因为我们在生成命令中
（<code>bin/rails generate model Article title:string body:text</code>）定义了他们，所以生
成器自动添加了该栏位。</p><p>代码块最后调用了 <code>t.timestamps</code>，该命令定义了两个叫做 <code>created_at</code> 和 <code>updated_at</code> 
的附加栏位。如我们所见，Rails 自动管理它们，在创建和个更新模型对象时设置相应值。</p><p>用下面命令运行改迁：</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>db:migrate
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails db:migrate
">复制</button>
</div>
<p>执行显示表已创建：</p><div class="code_container">
<pre><code class="highlight plaintext">==  CreateArticles: migrating ===================================
-- create_table(:articles)
   -&gt; 0.0018s
==  CreateArticles: migrated (0.0018s) ==========================
</code></pre>
<button class="clipboard-button" data-clipboard-text="==  CreateArticles: migrating ===================================
-- create_table(:articles)
   -&gt; 0.0018s
==  CreateArticles: migrated (0.0018s) ==========================
">复制</button>
</div>
<div class="info"><p>学习更多改迁知识查阅 <a href="active_record_migrations.html">Active Record 改迁</a>。</p></div><p>现在我们可以使用模型与表互动了！</p><h4 id="用模型与数据库互动"><a class="anchorlink" href="#%E7%94%A8%E6%A8%A1%E5%9E%8B%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%92%E5%8A%A8" data-turbolinks="false">6.3 用模型与数据库互动</a></h4><p>要控制模型，可以使用 Rails 叫做 <strong>console</strong> 的功能。Console 是一个类似 <code>irb</code> 
代码互动环境，但是可以自动加载 Rails 和应用程序代码。</p><p>用下面命令加载 console：</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>console
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails console
">复制</button>
</div>
<p>您应当看到一个 <code>irb</code> 提示符：</p><div class="code_container">
<pre><code class="highlight irb"><span class="go">Loading development environment (Rails 7.0.0)
</span><span class="gp">irb(main):001:0&gt;</span><span class="w">
</span></code></pre>
<button class="clipboard-button" data-clipboard-text="">复制</button>
</div>
<p>在该提示符后我们初始化一个新 <code>Article</code> 对象：</p><div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">title: </span><span class="s2">"Hello Rails"</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"I am on Rails!"</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='article = Article.new(title: "Hello Rails", body: "I am on Rails!")
'>复制</button>
</div>
<p>一定要记住我们只是<strong>初始化</strong>该对象，并没有存储到数据库。此时该对象仅存在于 
console 内。要保存该对象到数据库，必须调用 <a href="https://edgeapi.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-save"><code>save</code></a>：</p><div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">article</span><span class="p">.</span><span class="nf">save</span>
<span class="go">(0.1ms)  begin transaction
Article Create (0.4ms)  INSERT INTO "articles" ("title", "body", "created_at", "updated_at") VALUES (?, ?, ?, ?)  [["title", "Hello Rails"], ["body", "I am on Rails!"], ["created_at", "2020-01-18 23:47:30.734416"], ["updated_at", "2020-01-18 23:47:30.734416"]]
(0.9ms)  commit transaction
</span><span class="p">=&gt;</span> <span class="kp">true</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="article.save
">复制</button>
</div>
<p>上面的输出显示一条 <code>INSERT INTO "articles" ...</code> 数据库查询。这表示该文章已经
插入我们的表中。我们再看一下 <code>article</code> 对象，我们看到有意思的事情发生了：</p><div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">article</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">Article</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">title: </span><span class="s2">"Hello Rails"</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"I am on Rails!"</span><span class="p">,</span> <span class="ss">created_at: </span><span class="s2">"2020-01-18 23:47:30"</span><span class="p">,</span> <span class="ss">updated_at: </span><span class="s2">"2020-01-18 23:47:30"</span><span class="kt">&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="article
">复制</button>
</div>
<p>对象的 <code>id</code>、<code>created_at</code> 和 <code>updated_at</code> 属性都设定了值。是 Rails 在我们保存
对象时做了该设置。</p><p>当我们想要从数据库获取该文章时，我们在模型上调用 <a href="https://edgeapi.rubyonrails.org/classes/ActiveRecord/FinderMethods.html#method-i-find"><code>find</code></a> 方法并且传递参数 <code>id</code> ：</p><div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">Article</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">title: </span><span class="s2">"Hello Rails"</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"I am on Rails!"</span><span class="p">,</span> <span class="ss">created_at: </span><span class="s2">"2020-01-18 23:47:30"</span><span class="p">,</span> <span class="ss">updated_at: </span><span class="s2">"2020-01-18 23:47:30"</span><span class="kt">&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Article.find(1)
">复制</button>
</div>
<p>当我们想要从数据库中获取全部文章时在模型上调用 <a href="https://edgeapi.rubyonrails.org/classes/ActiveRecord/Scoping/Named/ClassMethods.html#method-i-all"><code>all</code></a> 方法：</p><div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Relation</span> <span class="p">[</span><span class="kt">#&lt;</span><span class="no">Article</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">title: </span><span class="s2">"Hello Rails"</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"I am on Rails!"</span><span class="p">,</span> <span class="ss">created_at: </span><span class="s2">"2020-01-18 23:47:30"</span><span class="p">,</span> <span class="ss">updated_at: </span><span class="s2">"2020-01-18 23:47:30"</span><span class="kt">&gt;</span><span class="p">]</span><span class="kt">&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Article.all
">复制</button>
</div>
<p>此方法返回一个 <a href="https://edgeapi.rubyonrails.org/classes/ActiveRecord/Relation.html"><code>ActiveRecord::Relation</code></a> 
对象——您可以将其想象为一个超级数列。</p><div class="info"><p>学习更多模型知识查阅 <a href="active_record_basics.html">Active Record 基础</a> 和 <a href="active_record_querying.html">Active Record 查询接口</a>。</p></div><p>模型是 MVC 拼图的最后一块。接下来我们将所有拼图拼到一起。</p><h4 id="显示文章列表"><a class="anchorlink" href="#%E6%98%BE%E7%A4%BA%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8" data-turbolinks="false">6.4 显示文章列表</a></h4><p>让我们返回到控制器 <code>app/controllers/articles_controller.rb</code>，修改 <code>index</code> 动作
让其获取数据库所有文章：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class ArticlesController &lt; ApplicationController
  def index
    @articles = Article.all
  end
end
">复制</button>
</div>
<p>控制器实例变量可以在视图中访问，这就是说我们可以在 <code>app/views/articles/index.html.erb</code>
 中引用 <code>@articles</code> 。打开文件输入下面内容：</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;li&gt;
      &lt;%= article.title %&gt;
    &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;
">复制</button>
</div>
<p>上面代码混合了 HTML 和 <strong>ERB</strong>。ERB 是一个可以在文档中嵌入 Ruby 代码的模板系
统。我们会在其中看到两种类型的 Ruby 标签：<code>&lt;% %&gt;</code> 和 <code>&lt;%= %&gt;</code>。<code>&lt;% %&gt;</code> 标签
表示这是“一段 Ruby 代码”，<code>&lt;%= %&gt;</code> 标签表示这是“一段 Ruby 代码，并且输出
返回值”。您能写的任何一段常规的 Ruby 程序都可以使用 ERB 标签表示，但是一般
情况下，我们需要 ERB 标签尽量简洁、易读。</p><p>因为我们不想输出 <code>@articles.each</code> 的值，所以我们使用 <code>&lt;% %&gt;</code>，但是，因为我们
<strong>想</strong>输出 <code>article.title</code> （每一篇文章）的值，所以我们使用了 <code>&lt;%= %&gt;</code>。</p><p>我们访问 <a href="http://localhost:3000">http://localhost:3000</a> 可以看到最终结果。（记得要先运行
<code>bin/rails server</code> ！）这就是我们所做的：</p>
<ol>
<li>浏览器发送请求： <code>GET http://localhost:3000</code>。</li>
<li>我们的 Rails 应用程序接收请求。</li>
<li>Rails 路由映射根路由到控制器 <code>ArticlesController</code> 的 <code>index</code> 动作。</li>
<li>
<code>index</code> 动作使用 <code>Article</code> 模型从数据库获取所有文章。</li>
<li>Rails 自动使用 <code>app/views/articles/index.html.erb</code> 试图渲染。</li>
<li>试图中的 ERB 代码执行并输出 HTML。</li>
<li>服务器发送一个 HTML 响应给浏览器。</li>
</ol>
<p>我们整合了 MVC 的各个部分，而且我们有了第一个控制器动作！接下来，我们开始第二个动作。</p><h3 id="当-crud-则-crud"><a class="anchorlink" href="#%E5%BD%93-crud-%E5%88%99-crud" data-turbolinks="false">7 当 CRUD 则 CRUD</a></h3><p>几乎所有的 Web 应用程序都会涉及到 <a href="https://en.wikipedia.org/wiki/Create,_read,_update,_and_delete">CRUD（Create、Read、Update 和 Delete）</a> 操作。您可能已经
发现应用程序的主要工作就是 CRUD。Rails 也是如此，它提供横多功能来帮助简化 CRUD 的编码。</p><p>让我们通过给我们的应用程序添加更多功能来探索这些特色吧。</p><h4 id="显示一篇文章"><a class="anchorlink" href="#%E6%98%BE%E7%A4%BA%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0" data-turbolinks="false">7.1 显示一篇文章</a></h4><p>我们现在有一个列出所有数据库文章的视图，再添加一个显示单篇文章标题和内容的新视图。</p><p>我们开始添加一个映射到新控制器动作（我们接下来将添加） 的新路由。打开 <code>config/routes.rb</code>，
插入下面现实的最后一个路由：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s2">"articles#index"</span>

  <span class="n">get</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#index"</span>
  <span class="n">get</span> <span class="s2">"/articles/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#show"</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='Rails.application.routes.draw do
  root "articles#index"

  get "/articles", to: "articles#index"
  get "/articles/:id", to: "articles#show"
end
'>复制</button>
</div>
<p>新路由是另一个 <code>get</code> 路由，但是它有一些额外的东西：<code>:id</code>。这是指定的路由<strong>参数</strong>。
一个路由参数会匹配请求路径的一部分，然后将其值放入 <code>params</code> 哈希内，该值可以在控制器
动作内访问。例如：当处理一个类似
<code>GET http://localhost:3000/articles/1</code> 的请求时，<code>1</code> 就会匹配为 <code>:id</code> 的值，然后就
可以在控制器 <code>ArticlesController</code> 的 <code>show</code> 动作内通过 <code>params[:id]</code> 访问。
.</p><p>现在让我们在 <code>app/controllers/articles_controller.rb</code> 的 <code>index</code> 动作下方添加
 <code>show</code> 动作：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class ArticlesController &lt; ApplicationController
  def index
    @articles = Article.all
  end

  def show
    @article = Article.find(params[:id])
  end
end
">复制</button>
</div>
<p><code>show</code> 动作调用 <code>Article.find</code> (<a href="#%E7%94%A8%E6%A8%A1%E5%9E%8B%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%92%E5%8A%A8">前面提过</a>) 通过路由参数匹
配到的 ID 找到文章。返回的文章存储在 <code>@article</code> 实例变量中，所以可以视图中访问。默认
情况下，<code>show</code> 动作通过 <code>app/views/articles/show.html.erb</code> 渲染。</p><p>用下面内容创建 <code>app/views/articles/show.html.erb</code>：</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;
">复制</button>
</div>
<p>现在通过访问 <a href="http://localhost:3000/articles/1">http://localhost:3000/articles/1</a> 可以看到文章信息了！</p><p>完善一下，我们以约定方式转到文章详细页面。我们将在 <code>app/views/articles/index.html.erb</code>
 页面通过标题链接到该文章详细页面：</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/articles/</span><span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">id</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;li&gt;
      &lt;a href="/articles/&lt;%= article.id %&gt;"&gt;
        &lt;%= article.title %&gt;
      &lt;/a&gt;
    &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;
'>复制</button>
</div>
<h4 id="资源化路由"><a class="anchorlink" href="#%E8%B5%84%E6%BA%90%E5%8C%96%E8%B7%AF%E7%94%B1" data-turbolinks="false">7.2 资源化路由</a></h4><p>So far, we've covered the "R" (Read) of CRUD. We will eventually cover the "C"
(Create), "U" (Update), and "D" (Delete). As you might have guessed, we will do
so by adding new routes, controller actions, and views. Whenever we have such a
combination of routes, controller actions, and views that work together to
perform CRUD operations on an entity, we call that entity a <em>resource</em>. For
example, in our application, we would say an article is a resource.</p><p>Rails provides a routes method named <a href="https://edgeapi.rubyonrails.org/classes/ActionDispatch/Routing/Mapper/Resources.html#method-i-resources"><code>resources</code></a>
that maps all of the conventional routes for a collection of resources, such as
articles. So before we proceed to the "C", "U", and "D" sections, let's replace
the two <code>get</code> routes in <code>config/routes.rb</code> with <code>resources</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s2">"articles#index"</span>

  <span class="n">resources</span> <span class="ss">:articles</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='Rails.application.routes.draw do
  root "articles#index"

  resources :articles
end
'>复制</button>
</div>
<p>We can inspect what routes are mapped by running the <code>bin/rails routes</code> command:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>routes
<span class="gp">      Prefix Verb   URI Pattern                  Controller#</span>Action
<span class="gp">        root GET    /                            articles#</span>index
<span class="gp">    articles GET    /articles(.:format)          articles#</span>index
<span class="gp"> new_article GET    /articles/new(.:format)      articles#</span>new
<span class="gp">     article GET    /articles/:id(.:format)      articles#</span>show
<span class="gp">             POST   /articles(.:format)          articles#</span>create
<span class="gp">edit_article GET    /articles/:id/edit(.:format) articles#</span>edit
<span class="gp">             PATCH  /articles/:id(.:format)      articles#</span>update
<span class="gp">             DELETE /articles/:id(.:format)      articles#</span>destroy
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails routes
">复制</button>
</div>
<p>The <code>resources</code> method also sets up URL and path helper methods that we can use
to keep our code from depending on a specific route configuration. The values
in the "Prefix" column above plus a suffix of <code>_url</code> or <code>_path</code> form the names
of these helpers. For example, the <code>article_path</code> helper returns
<code>"/articles/#{article.id}"</code> when given an article. We can use it to tidy up our
links in <code>app/views/articles/index.html.erb</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">&lt;%=</span> <span class="n">article_path</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;li&gt;
      &lt;a href="&lt;%= article_path(article) %&gt;"&gt;
        &lt;%= article.title %&gt;
      &lt;/a&gt;
    &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;
'>复制</button>
</div>
<p>However, we will take this one step further by using the <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/UrlHelper.html#method-i-link_to"><code>link_to</code></a>
helper. The <code>link_to</code> helper renders a link with its first argument as the
link's text and its second argument as the link's destination. If we pass a
model object as the second argument, <code>link_to</code> will call the appropriate path
helper to convert the object to a path. For example, if we pass an article,
<code>link_to</code> will call <code>article_path</code>. So <code>app/views/articles/index.html.erb</code>
becomes:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span><span class="p">,</span> <span class="n">article</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;li&gt;
      &lt;%= link_to article.title, article %&gt;
    &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;
">复制</button>
</div>
<p>Nice!</p><div class="info"><p>To learn more about routing, see <a href="routing.html">Rails Routing from the Outside In</a>.</p></div><h4 id="新建一篇文章"><a class="anchorlink" href="#%E6%96%B0%E5%BB%BA%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0" data-turbolinks="false">7.3 新建一篇文章</a></h4><p>Now we move on to the "C" (Create) of CRUD. Typically, in web applications,
creating a new resource is a multi-step process. First, the user requests a form
to fill out. Then, the user submits the form. If there are no errors, then the
resource is created and some kind of confirmation is displayed. Else, the form
is redisplayed with error messages, and the process is repeated.</p><p>In a Rails application, these steps are conventionally handled by a controller's
<code>new</code> and <code>create</code> actions. Let's add a typical implementation of these actions
to <code>app/controllers/articles_controller.rb</code>, below the <code>show</code> action:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">title: </span><span class="s2">"..."</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"..."</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:new</span><span class="p">,</span> <span class="ss">status: :unprocessable_entity</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='class ArticlesController &lt; ApplicationController
  def index
    @articles = Article.all
  end

  def show
    @article = Article.find(params[:id])
  end

  def new
    @article = Article.new
  end

  def create
    @article = Article.new(title: "...", body: "...")

    if @article.save
      redirect_to @article
    else
      render :new, status: :unprocessable_entity
    end
  end
end
'>复制</button>
</div>
<p>The <code>new</code> action instantiates a new article, but does not save it. This article
will be used in the view when building the form. By default, the <code>new</code> action
will render <code>app/views/articles/new.html.erb</code>, which we will create next.</p><p>The <code>create</code> action instantiates a new article with values for the title and
body, and attempts to save it. If the article is saved successfully, the action
redirects the browser to the article's page at <code>"http://localhost:3000/articles/#{@article.id}"</code>.
Else, the action redisplays the form by rendering <code>app/views/articles/new.html.erb</code>
with status code <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422">422 Unprocessable Entity</a>.
The title and body here are dummy values. After we create the form, we will come
back and change these.</p><div class="note"><p><a href="https://edgeapi.rubyonrails.org/classes/ActionController/Redirecting.html#method-i-redirect_to"><code>redirect_to</code></a>
will cause the browser to make a new request,
whereas <a href="https://edgeapi.rubyonrails.org/classes/AbstractController/Rendering.html#method-i-render"><code>render</code></a>
renders the specified view for the current request.
It is important to use <code>redirect_to</code> after mutating the database or application state.
Otherwise, if the user refreshes the page, the browser will make the same request, and the mutation will be repeated.</p></div><h5 id="使用表单构建器"><a class="anchorlink" href="#%E4%BD%BF%E7%94%A8%E8%A1%A8%E5%8D%95%E6%9E%84%E5%BB%BA%E5%99%A8" data-turbolinks="false">7.3.1 使用表单构建器</a></h5><p>We will use a feature of Rails called a <em>form builder</em> to create our form. Using
a form builder, we can write a minimal amount of code to output a form that is
fully configured and follows Rails conventions.</p><p>Let's create <code>app/views/articles/new.html.erb</code> with the following contents:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>New Article<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@article</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;h1&gt;New Article&lt;/h1&gt;

&lt;%= form_with model: @article do |form| %&gt;
  &lt;div&gt;
    &lt;%= form.label :title %&gt;&lt;br&gt;
    &lt;%= form.text_field :title %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.submit %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
">复制</button>
</div>
<p>The <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormHelper.html#method-i-form_with"><code>form_with</code></a>
helper method instantiates a form builder. In the <code>form_with</code> block we call
methods like <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-label"><code>label</code></a>
and <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-text_field"><code>text_field</code></a>
on the form builder to output the appropriate form elements.</p><p>The resulting output from our <code>form_with</code> call will look like:</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/articles"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"authenticity_token"</span> <span class="na">value=</span><span class="s">"..."</span><span class="nt">&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"article_title"</span><span class="nt">&gt;</span>Title<span class="nt">&lt;/label&gt;&lt;br&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"article[title]"</span> <span class="na">id=</span><span class="s">"article_title"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"article_body"</span><span class="nt">&gt;</span>Body<span class="nt">&lt;/label&gt;&lt;br&gt;</span>
    <span class="nt">&lt;textarea</span> <span class="na">name=</span><span class="s">"article[body]"</span> <span class="na">id=</span><span class="s">"article_body"</span><span class="nt">&gt;&lt;/textarea&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">name=</span><span class="s">"commit"</span> <span class="na">value=</span><span class="s">"Create Article"</span> <span class="na">data-disable-with=</span><span class="s">"Create Article"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;form action="/articles" accept-charset="UTF-8" method="post"&gt;
  &lt;input type="hidden" name="authenticity_token" value="..."&gt;

  &lt;div&gt;
    &lt;label for="article_title"&gt;Title&lt;/label&gt;&lt;br&gt;
    &lt;input type="text" name="article[title]" id="article_title"&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;label for="article_body"&gt;Body&lt;/label&gt;&lt;br&gt;
    &lt;textarea name="article[body]" id="article_body"&gt;&lt;/textarea&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;input type="submit" name="commit" value="Create Article" data-disable-with="Create Article"&gt;
  &lt;/div&gt;
&lt;/form&gt;
'>复制</button>
</div>
<div class="info"><p>To learn more about form builders, see <a href="form_helpers.html">Action View Form Helpers</a>.</p></div><h5 id="使用强参数"><a class="anchorlink" href="#%E4%BD%BF%E7%94%A8%E5%BC%BA%E5%8F%82%E6%95%B0" data-turbolinks="false">7.3.2 使用强参数</a></h5><p>Submitted form data is put into the <code>params</code> Hash, alongside captured route
parameters. Thus, the <code>create</code> action can access the submitted title via
<code>params[:article][:title]</code> and the submitted body via <code>params[:article][:body]</code>.
We could pass these values individually to <code>Article.new</code>, but that would be
verbose and possibly error-prone. And it would become worse as we add more
fields.</p><p>Instead, we will pass a single Hash that contains the values. However, we must
still specify what values are allowed in that Hash. Otherwise, a malicious user
could potentially submit extra form fields and overwrite private data. In fact,
if we pass the unfiltered <code>params[:article]</code> Hash directly to <code>Article.new</code>,
Rails will raise a <code>ForbiddenAttributesError</code> to alert us about the problem.
So we will use a feature of Rails called <em>Strong Parameters</em> to filter <code>params</code>.
Think of it as <a href="https://en.wikipedia.org/wiki/Strong_and_weak_typing">strong typing</a>
for <code>params</code>.</p><p>Let's add a private method to the bottom of <code>app/controllers/articles_controller.rb</code>
named <code>article_params</code> that filters <code>params</code>. And let's change <code>create</code> to use
it:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:new</span><span class="p">,</span> <span class="ss">status: :unprocessable_entity</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">article_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:article</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class ArticlesController &lt; ApplicationController
  def index
    @articles = Article.all
  end

  def show
    @article = Article.find(params[:id])
  end

  def new
    @article = Article.new
  end

  def create
    @article = Article.new(article_params)

    if @article.save
      redirect_to @article
    else
      render :new, status: :unprocessable_entity
    end
  end

  private
    def article_params
      params.require(:article).permit(:title, :body)
    end
end
">复制</button>
</div>
<div class="info"><p>To learn more about Strong Parameters, see <a href="action_controller_overview.html#strong-parameters">Action Controller Overview §
Strong Parameters</a>.</p></div><h5 id="验证和显示错误信息"><a class="anchorlink" href="#%E9%AA%8C%E8%AF%81%E5%92%8C%E6%98%BE%E7%A4%BA%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF" data-turbolinks="false">7.3.3 验证和显示错误信息</a></h5><p>As we have seen, creating a resource is a multi-step process. Handling invalid
user input is another step of that process. Rails provides a feature called
<em>validations</em> to help us deal with invalid user input. Validations are rules
that are checked before a model object is saved. If any of the checks fail, the
save will be aborted, and appropriate error messages will be added to the
<code>errors</code> attribute of the model object.</p><p>Let's add some validations to our model in <code>app/models/article.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">10</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Article &lt; ApplicationRecord
  validates :title, presence: true
  validates :body, presence: true, length: { minimum: 10 }
end
">复制</button>
</div>
<p>The first validation declares that a <code>title</code> value must be present. Because
<code>title</code> is a string, this means that the <code>title</code> value must contain at least one
non-whitespace character.</p><p>The second validation declares that a <code>body</code> value must also be present.
Additionally, it declares that the <code>body</code> value must be at least 10 characters
long.</p><div class="note"><p>You may be wondering where the <code>title</code> and <code>body</code> attributes are defined.
Active Record automatically defines model attributes for every table column, so
you don't have to declare those attributes in your model file.</p></div><p>With our validations in place, let's modify <code>app/views/articles/new.html.erb</code> to
display any error messages for <code>title</code> and <code>body</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>New Article<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@article</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages_for</span><span class="p">(</span><span class="ss">:title</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">message</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;div&gt;</span><span class="cp">&lt;%=</span> <span class="n">message</span> <span class="cp">%&gt;</span><span class="nt">&lt;/div&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages_for</span><span class="p">(</span><span class="ss">:body</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">message</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;div&gt;</span><span class="cp">&lt;%=</span> <span class="n">message</span> <span class="cp">%&gt;</span><span class="nt">&lt;/div&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;h1&gt;New Article&lt;/h1&gt;

&lt;%= form_with model: @article do |form| %&gt;
  &lt;div&gt;
    &lt;%= form.label :title %&gt;&lt;br&gt;
    &lt;%= form.text_field :title %&gt;
    &lt;% @article.errors.full_messages_for(:title).each do |message| %&gt;
      &lt;div&gt;&lt;%= message %&gt;&lt;/div&gt;
    &lt;% end %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;&lt;br&gt;
    &lt;% @article.errors.full_messages_for(:body).each do |message| %&gt;
      &lt;div&gt;&lt;%= message %&gt;&lt;/div&gt;
    &lt;% end %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.submit %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
">复制</button>
</div>
<p>The <a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/Errors.html#method-i-full_messages_for"><code>full_messages_for</code></a>
method returns an array of user-friendly error messages for a specified
attribute. If there are no errors for that attribute, the array will be empty.</p><p>To understand how all of this works together, let's take another look at the
<code>new</code> and <code>create</code> controller actions:</p><div class="code_container">
<pre><code class="highlight ruby">  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:new</span><span class="p">,</span> <span class="ss">status: :unprocessable_entity</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="  def new
    @article = Article.new
  end

  def create
    @article = Article.new(article_params)

    if @article.save
      redirect_to @article
    else
      render :new, status: :unprocessable_entity
    end
  end
">复制</button>
</div>
<p>When we visit <a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a>, the <code>GET /articles/new</code>
request is mapped to the <code>new</code> action. The <code>new</code> action does not attempt to save
<code>@article</code>. Therefore, validations are not checked, and there will be no error
messages.</p><p>When we submit the form, the <code>POST /articles</code> request is mapped to the <code>create</code>
action. The <code>create</code> action <em>does</em> attempt to save <code>@article</code>. Therefore,
validations <em>are</em> checked. If any validation fails, <code>@article</code> will not be
saved, and <code>app/views/articles/new.html.erb</code> will be rendered with error
messages.</p><div class="info"><p>To learn more about validations, see <a href="active_record_validations.html">Active Record Validations</a>. To learn more about validation error messages,
see <a href="active_record_validations.html#working-with-validation-errors">Active Record Validations § Working with Validation Errors</a>.</p></div><h5 id="新建一篇文章-完善一下"><a class="anchorlink" href="#%E6%96%B0%E5%BB%BA%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0-%E5%AE%8C%E5%96%84%E4%B8%80%E4%B8%8B" data-turbolinks="false">7.3.4 完善一下</a></h5><p>We can now create an article by visiting <a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a>.
To finish up, let's link to that page from the bottom of
<code>app/views/articles/index.html.erb</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span><span class="p">,</span> <span class="n">article</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"New Article"</span><span class="p">,</span> <span class="n">new_article_path</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;li&gt;
      &lt;%= link_to article.title, article %&gt;
    &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;

&lt;%= link_to "New Article", new_article_path %&gt;
'>复制</button>
</div>
<h4 id="更新文章"><a class="anchorlink" href="#%E6%9B%B4%E6%96%B0%E6%96%87%E7%AB%A0" data-turbolinks="false">7.4 更新文章</a></h4><p>We've covered the "CR" of CRUD. Now let's move on to the "U" (Update). Updating
a resource is very similar to creating a resource. They are both multi-step
processes. First, the user requests a form to edit the data. Then, the user
submits the form. If there are no errors, then the resource is updated. Else,
the form is redisplayed with error messages, and the process is repeated.</p><p>These steps are conventionally handled by a controller's <code>edit</code> and <code>update</code>
actions. Let's add a typical implementation of these actions to
<code>app/controllers/articles_controller.rb</code>, below the <code>create</code> action:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:new</span><span class="p">,</span> <span class="ss">status: :unprocessable_entity</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">status: :unprocessable_entity</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">article_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:article</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class ArticlesController &lt; ApplicationController
  def index
    @articles = Article.all
  end

  def show
    @article = Article.find(params[:id])
  end

  def new
    @article = Article.new
  end

  def create
    @article = Article.new(article_params)

    if @article.save
      redirect_to @article
    else
      render :new, status: :unprocessable_entity
    end
  end

  def edit
    @article = Article.find(params[:id])
  end

  def update
    @article = Article.find(params[:id])

    if @article.update(article_params)
      redirect_to @article
    else
      render :edit, status: :unprocessable_entity
    end
  end

  private
    def article_params
      params.require(:article).permit(:title, :body)
    end
end
">复制</button>
</div>
<p>Notice how the <code>edit</code> and <code>update</code> actions resemble the <code>new</code> and <code>create</code>
actions.</p><p>The <code>edit</code> action fetches the article from the database, and stores it in
<code>@article</code> so that it can be used when building the form. By default, the <code>edit</code>
action will render <code>app/views/articles/edit.html.erb</code>.</p><p>The <code>update</code> action (re-)fetches the article from the database, and attempts
to update it with the submitted form data filtered by <code>article_params</code>. If no
validations fail and the update is successful, the action redirects the browser
to the article's page. Else, the action redisplays the form — with error
messages — by rendering <code>app/views/articles/edit.html.erb</code>.</p><h5 id="使用局部模板（partial）共享视图代码"><a class="anchorlink" href="#%E4%BD%BF%E7%94%A8%E5%B1%80%E9%83%A8%E6%A8%A1%E6%9D%BF%EF%BC%88partial%EF%BC%89%E5%85%B1%E4%BA%AB%E8%A7%86%E5%9B%BE%E4%BB%A3%E7%A0%81" data-turbolinks="false">7.4.1 使用局部模板（partial）共享视图代码</a></h5><p>Our <code>edit</code> form will look the same as our <code>new</code> form. Even the code will be the
same, thanks to the Rails form builder and resourceful routing. The form builder
automatically configures the form to make the appropriate kind of request, based
on whether the model object has been previously saved.</p><p>Because the code will be the same, we're going to factor it out into a shared
view called a <em>partial</em>. Let's create <code>app/views/articles/_form.html.erb</code> with
the following contents:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="n">article</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="n">article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages_for</span><span class="p">(</span><span class="ss">:title</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">message</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;div&gt;</span><span class="cp">&lt;%=</span> <span class="n">message</span> <span class="cp">%&gt;</span><span class="nt">&lt;/div&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%</span> <span class="n">article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages_for</span><span class="p">(</span><span class="ss">:body</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">message</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;div&gt;</span><span class="cp">&lt;%=</span> <span class="n">message</span> <span class="cp">%&gt;</span><span class="nt">&lt;/div&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: article do |form| %&gt;
  &lt;div&gt;
    &lt;%= form.label :title %&gt;&lt;br&gt;
    &lt;%= form.text_field :title %&gt;
    &lt;% article.errors.full_messages_for(:title).each do |message| %&gt;
      &lt;div&gt;&lt;%= message %&gt;&lt;/div&gt;
    &lt;% end %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;&lt;br&gt;
    &lt;% article.errors.full_messages_for(:body).each do |message| %&gt;
      &lt;div&gt;&lt;%= message %&gt;&lt;/div&gt;
    &lt;% end %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.submit %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
">复制</button>
</div>
<p>The above code is the same as our form in <code>app/views/articles/new.html.erb</code>,
except that all occurrences of <code>@article</code> have been replaced with <code>article</code>.
Because partials are shared code, it is best practice that they do not depend on
specific instance variables set by a controller action. Instead, we will pass
the article to the partial as a local variable.</p><p>Let's update <code>app/views/articles/new.html.erb</code> to use the partial via <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/RenderingHelper.html#method-i-render"><code>render</code></a>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>New Article<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s2">"form"</span><span class="p">,</span> <span class="ss">article: </span><span class="vi">@article</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;h1&gt;New Article&lt;/h1&gt;

&lt;%= render "form", article: @article %&gt;
'>复制</button>
</div>
<div class="note"><p>A partial's filename must be prefixed <strong>with</strong> an underscore, e.g.
<code>_form.html.erb</code>. But when rendering, it is referenced <strong>without</strong> the
underscore, e.g. <code>render "form"</code>.</p></div><p>And now, let's create a very similar <code>app/views/articles/edit.html.erb</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Edit Article<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s2">"form"</span><span class="p">,</span> <span class="ss">article: </span><span class="vi">@article</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;h1&gt;Edit Article&lt;/h1&gt;

&lt;%= render "form", article: @article %&gt;
'>复制</button>
</div>
<div class="info"><p>To learn more about partials, see <a href="layouts_and_rendering.html#using-partials">Layouts and Rendering in Rails § Using
Partials</a>.</p></div><h5 id="更新文章-完善一下"><a class="anchorlink" href="#%E6%9B%B4%E6%96%B0%E6%96%87%E7%AB%A0-%E5%AE%8C%E5%96%84%E4%B8%80%E4%B8%8B" data-turbolinks="false">7.4.2 完善一下</a></h5><p>We can now update an article by visiting its edit page, e.g.
<a href="http://localhost:3000/articles/1/edit">http://localhost:3000/articles/1/edit</a>. To finish up, let's link to the edit
page from the bottom of <code>app/views/articles/show.html.erb</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Edit"</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to "Edit", edit_article_path(@article) %&gt;&lt;/li&gt;
&lt;/ul&gt;
'>复制</button>
</div>
<h4 id="删除文章"><a class="anchorlink" href="#%E5%88%A0%E9%99%A4%E6%96%87%E7%AB%A0" data-turbolinks="false">7.5 删除文章</a></h4><p>Finally, we arrive at the "D" (Delete) of CRUD. Deleting a resource is a simpler
process than creating or updating. It only requires a route and a controller
action. And our resourceful routing (<code>resources :articles</code>) already provides the
route, which maps <code>DELETE /articles/:id</code> requests to the <code>destroy</code> action of
<code>ArticlesController</code>.</p><p>So, let's add a typical <code>destroy</code> action to <code>app/controllers/articles_controller.rb</code>,
below the <code>update</code> action:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:new</span><span class="p">,</span> <span class="ss">status: :unprocessable_entity</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">status: :unprocessable_entity</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
    <span class="vi">@article</span><span class="p">.</span><span class="nf">destroy</span>

    <span class="n">redirect_to</span> <span class="n">root_path</span><span class="p">,</span> <span class="ss">status: :see_other</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">article_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:article</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class ArticlesController &lt; ApplicationController
  def index
    @articles = Article.all
  end

  def show
    @article = Article.find(params[:id])
  end

  def new
    @article = Article.new
  end

  def create
    @article = Article.new(article_params)

    if @article.save
      redirect_to @article
    else
      render :new, status: :unprocessable_entity
    end
  end

  def edit
    @article = Article.find(params[:id])
  end

  def update
    @article = Article.find(params[:id])

    if @article.update(article_params)
      redirect_to @article
    else
      render :edit, status: :unprocessable_entity
    end
  end

  def destroy
    @article = Article.find(params[:id])
    @article.destroy

    redirect_to root_path, status: :see_other
  end

  private
    def article_params
      params.require(:article).permit(:title, :body)
    end
end
">复制</button>
</div>
<p>The <code>destroy</code> action fetches the article from the database, and calls <a href="https://edgeapi.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-destroy"><code>destroy</code></a>
on it. Then, it redirects the browser to the root path with status code
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/303">303 See Other</a>.</p><p>We have chosen to redirect to the root path because that is our main access
point for articles. But, in other circumstances, you might choose to redirect to
e.g. <code>articles_path</code>.</p><p>Now let's add a link at the bottom of <code>app/views/articles/show.html.erb</code> so that
we can delete an article from its own page:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Edit"</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Destroy"</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">),</span> <span class="ss">data: </span><span class="p">{</span>
                    <span class="ss">turbo_method: :delete</span><span class="p">,</span>
                    <span class="ss">turbo_confirm: </span><span class="s2">"Are you sure?"</span>
                  <span class="p">}</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to "Edit", edit_article_path(@article) %&gt;&lt;/li&gt;
  &lt;li&gt;&lt;%= link_to "Destroy", article_path(@article), data: {
                    turbo_method: :delete,
                    turbo_confirm: "Are you sure?"
                  } %&gt;&lt;/li&gt;
&lt;/ul&gt;
'>复制</button>
</div>
<p>In the above code, we use the <code>data</code> option to set the <code>data-turbo-method</code> and
<code>data-turbo-confirm</code> HTML attributes of the "Destroy" link. Both of these
attributes hook into <a href="https://turbo.hotwired.dev/">Turbo</a>, which is included by
default in fresh Rails applications. <code>data-turbo-method="delete"</code> will cause the
link to make a <code>DELETE</code> request instead of a <code>GET</code> request.
<code>data-turbo-confirm="Are you sure?"</code> will cause a confirmation dialog to appear
when the link is clicked. If the user cancels the dialog, the request will be
aborted.</p><p>And that's it! We can now list, show, create, update, and delete articles!
InCRUDable!</p><h3 id="添加第二个模型"><a class="anchorlink" href="#%E6%B7%BB%E5%8A%A0%E7%AC%AC%E4%BA%8C%E4%B8%AA%E6%A8%A1%E5%9E%8B" data-turbolinks="false">8 添加第二个模型</a></h3><p>It's time to add a second model to the application. The second model will handle
comments on articles.</p><h4 id="添加第二个模型-生成模型"><a class="anchorlink" href="#%E6%B7%BB%E5%8A%A0%E7%AC%AC%E4%BA%8C%E4%B8%AA%E6%A8%A1%E5%9E%8B-%E7%94%9F%E6%88%90%E6%A8%A1%E5%9E%8B" data-turbolinks="false">8.1 生成模型</a></h4><p>We're going to see the same generator that we used before when creating
the <code>Article</code> model. This time we'll create a <code>Comment</code> model to hold a
reference to an article. Run this command in your terminal:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate model Comment commenter:string body:text article:references
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails generate model Comment commenter:string body:text article:references
">复制</button>
</div>
<p>This command will generate four files:</p>
<table>
<thead>
<tr>
<th>文件</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>db/migrate/20140120201010_create_comments.rb</td>
<td>Migration to create the comments table in your database (your name will include a different timestamp)</td>
</tr>
<tr>
<td>app/models/comment.rb</td>
<td>The Comment model</td>
</tr>
<tr>
<td>test/models/comment_test.rb</td>
<td>Testing harness for the comment model</td>
</tr>
<tr>
<td>test/fixtures/comments.yml</td>
<td>Sample comments for use in testing</td>
</tr>
</tbody>
</table>
<p>First, take a look at <code>app/models/comment.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:article</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Comment &lt; ApplicationRecord
  belongs_to :article
end
">复制</button>
</div>
<p>This is very similar to the <code>Article</code> model that you saw earlier. The difference
is the line <code>belongs_to :article</code>, which sets up an Active Record <em>association</em>.
You'll learn a little about associations in the next section of this guide.</p><p>The (<code>:references</code>) keyword used in the shell command is a special data type for models.
It creates a new column on your database table with the provided model name appended with an <code>_id</code>
that can hold integer values. To get a better understanding, analyze the
<code>db/schema.rb</code> file after running the migration.</p><p>In addition to the model, Rails has also made a migration to create the
corresponding database table:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">CreateComments</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">7.0</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:comments</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:commenter</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">text</span> <span class="ss">:body</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">references</span> <span class="ss">:article</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">foreign_key: </span><span class="kp">true</span>

      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class CreateComments &lt; ActiveRecord::Migration[7.0]
  def change
    create_table :comments do |t|
      t.string :commenter
      t.text :body
      t.references :article, null: false, foreign_key: true

      t.timestamps
    end
  end
end
">复制</button>
</div>
<p>The <code>t.references</code> line creates an integer column called <code>article_id</code>, an index
for it, and a foreign key constraint that points to the <code>id</code> column of the <code>articles</code>
table. Go ahead and run the migration:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>db:migrate
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails db:migrate
">复制</button>
</div>
<p>Rails is smart enough to only execute the migrations that have not already been
run against the current database, so in this case you will just see:</p><div class="code_container">
<pre><code class="highlight plaintext">==  CreateComments: migrating =================================================
-- create_table(:comments)
   -&gt; 0.0115s
==  CreateComments: migrated (0.0119s) ========================================
</code></pre>
<button class="clipboard-button" data-clipboard-text="==  CreateComments: migrating =================================================
-- create_table(:comments)
   -&gt; 0.0115s
==  CreateComments: migrated (0.0119s) ========================================
">复制</button>
</div>
<h4 id="模型关联"><a class="anchorlink" href="#%E6%A8%A1%E5%9E%8B%E5%85%B3%E8%81%94" data-turbolinks="false">8.2 模型关联</a></h4><p>Active Record associations let you easily declare the relationship between two
models. In the case of comments and articles, you could write out the
relationships this way:</p>
<ul>
<li>Each comment belongs to one article.</li>
<li>One article can have many comments.</li>
</ul>
<p>In fact, this is very close to the syntax that Rails uses to declare this
association. You've already seen the line of code inside the <code>Comment</code> model
(app/models/comment.rb) that makes each comment belong to an Article:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:article</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Comment &lt; ApplicationRecord
  belongs_to :article
end
">复制</button>
</div>
<p>You'll need to edit <code>app/models/article.rb</code> to add the other side of the
association:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:comments</span>

  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">10</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Article &lt; ApplicationRecord
  has_many :comments

  validates :title, presence: true
  validates :body, presence: true, length: { minimum: 10 }
end
">复制</button>
</div>
<p>These two declarations enable a good bit of automatic behavior. For example, if
you have an instance variable <code>@article</code> containing an article, you can retrieve
all the comments belonging to that article as an array using
<code>@article.comments</code>.</p><div class="info"><p>For more information on Active Record associations, see the <a href="association_basics.html">Active Record
Associations</a> guide.</p></div><h4 id="添加评论（comment）路由"><a class="anchorlink" href="#%E6%B7%BB%E5%8A%A0%E8%AF%84%E8%AE%BA%EF%BC%88comment%EF%BC%89%E8%B7%AF%E7%94%B1" data-turbolinks="false">8.3 添加评论（Comment）路由</a></h4><p>As with the <code>articles</code> controller, we will need to add a route so that Rails
knows where we would like to navigate to see <code>comments</code>. Open up the
<code>config/routes.rb</code> file again, and edit it as follows:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s2">"articles#index"</span>

  <span class="n">resources</span> <span class="ss">:articles</span> <span class="k">do</span>
    <span class="n">resources</span> <span class="ss">:comments</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='Rails.application.routes.draw do
  root "articles#index"

  resources :articles do
    resources :comments
  end
end
'>复制</button>
</div>
<p>This creates <code>comments</code> as a <em>nested resource</em> within <code>articles</code>. This is
another part of capturing the hierarchical relationship that exists between
articles and comments.</p><div class="info"><p>For more information on routing, see the <a href="routing.html">Rails Routing</a>
guide.</p></div><h4 id="生成控制器（controller）"><a class="anchorlink" href="#%E7%94%9F%E6%88%90%E6%8E%A7%E5%88%B6%E5%99%A8%EF%BC%88controller%EF%BC%89" data-turbolinks="false">8.4 生成控制器（Controller）</a></h4><p>With the model in hand, you can turn your attention to creating a matching
controller. Again, we'll use the same generator we used before:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate controller Comments
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails generate controller Comments
">复制</button>
</div>
<p>This creates three files and one empty directory:</p>
<table>
<thead>
<tr>
<th>File/Directory</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>app/controllers/comments_controller.rb</td>
<td>The Comments controller</td>
</tr>
<tr>
<td>app/views/comments/</td>
<td>Views of the controller are stored here</td>
</tr>
<tr>
<td>test/controllers/comments_controller_test.rb</td>
<td>The test for the controller</td>
</tr>
<tr>
<td>app/helpers/comments_helper.rb</td>
<td>A view helper file</td>
</tr>
</tbody>
</table>
<p>Like with any blog, our readers will create their comments directly after
reading the article, and once they have added their comment, will be sent back
to the article show page to see their comment now listed. Due to this, our
<code>CommentsController</code> is there to provide a method to create comments and delete
spam comments when they arrive.</p><p>So first, we'll wire up the Article show template
(<code>app/views/articles/show.html.erb</code>) to let us make a new comment:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Edit"</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Destroy"</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">),</span> <span class="ss">data: </span><span class="p">{</span>
                    <span class="ss">turbo_method: :delete</span><span class="p">,</span>
                    <span class="ss">turbo_confirm: </span><span class="s2">"Are you sure?"</span>
                  <span class="p">}</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="nt">&lt;h2&gt;</span>Add a comment:<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="p">[</span> <span class="vi">@article</span><span class="p">,</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">build</span> <span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to "Edit", edit_article_path(@article) %&gt;&lt;/li&gt;
  &lt;li&gt;&lt;%= link_to "Destroy", article_path(@article), data: {
                    turbo_method: :delete,
                    turbo_confirm: "Are you sure?"
                  } %&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Add a comment:&lt;/h2&gt;
&lt;%= form_with model: [ @article, @article.comments.build ] do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :commenter %&gt;&lt;br&gt;
    &lt;%= form.text_field :commenter %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.submit %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
'>复制</button>
</div>
<p>This adds a form on the <code>Article</code> show page that creates a new comment by
calling the <code>CommentsController</code> <code>create</code> action. The <code>form_with</code> call here uses
an array, which will build a nested route, such as <code>/articles/1/comments</code>.</p><p>Let's wire up the <code>create</code> in <code>app/controllers/comments_controller.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article_id</span><span class="p">])</span>
    <span class="vi">@comment</span> <span class="o">=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">comment_params</span><span class="p">)</span>
    <span class="n">redirect_to</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">comment_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:comment</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:commenter</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class CommentsController &lt; ApplicationController
  def create
    @article = Article.find(params[:article_id])
    @comment = @article.comments.create(comment_params)
    redirect_to article_path(@article)
  end

  private
    def comment_params
      params.require(:comment).permit(:commenter, :body)
    end
end
">复制</button>
</div>
<p>You'll see a bit more complexity here than you did in the controller for
articles. That's a side-effect of the nesting that you've set up. Each request
for a comment has to keep track of the article to which the comment is attached,
thus the initial call to the <code>find</code> method of the <code>Article</code> model to get the
article in question.</p><p>In addition, the code takes advantage of some of the methods available for an
association. We use the <code>create</code> method on <code>@article.comments</code> to create and
save the comment. This will automatically link the comment so that it belongs to
that particular article.</p><p>Once we have made the new comment, we send the user back to the original article
using the <code>article_path(@article)</code> helper. As we have already seen, this calls
the <code>show</code> action of the <code>ArticlesController</code> which in turn renders the
<code>show.html.erb</code> template. This is where we want the comment to show, so let's
add that to the <code>app/views/articles/show.html.erb</code>.</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Edit"</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Destroy"</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">),</span> <span class="ss">data: </span><span class="p">{</span>
                    <span class="ss">turbo_method: :delete</span><span class="p">,</span>
                    <span class="ss">turbo_confirm: </span><span class="s2">"Are you sure?"</span>
                  <span class="p">}</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="nt">&lt;h2&gt;</span>Comments<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">comment</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;strong&gt;</span>Commenter:<span class="nt">&lt;/strong&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;strong&gt;</span>Comment:<span class="nt">&lt;/strong&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;h2&gt;</span>Add a comment:<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="p">[</span> <span class="vi">@article</span><span class="p">,</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">build</span> <span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to "Edit", edit_article_path(@article) %&gt;&lt;/li&gt;
  &lt;li&gt;&lt;%= link_to "Destroy", article_path(@article), data: {
                    turbo_method: :delete,
                    turbo_confirm: "Are you sure?"
                  } %&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Comments&lt;/h2&gt;
&lt;% @article.comments.each do |comment| %&gt;
  &lt;p&gt;
    &lt;strong&gt;Commenter:&lt;/strong&gt;
    &lt;%= comment.commenter %&gt;
  &lt;/p&gt;

  &lt;p&gt;
    &lt;strong&gt;Comment:&lt;/strong&gt;
    &lt;%= comment.body %&gt;
  &lt;/p&gt;
&lt;% end %&gt;

&lt;h2&gt;Add a comment:&lt;/h2&gt;
&lt;%= form_with model: [ @article, @article.comments.build ] do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :commenter %&gt;&lt;br&gt;
    &lt;%= form.text_field :commenter %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.submit %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
'>复制</button>
</div>
<p>Now you can add articles and comments to your blog and have them show up in the
right places.</p><p><img src="images/getting_started/article_with_comments.png" alt="Article with Comments"></p><h3 id="重构"><a class="anchorlink" href="#%E9%87%8D%E6%9E%84" data-turbolinks="false">9 重构</a></h3><p>Now that we have articles and comments working, take a look at the
<code>app/views/articles/show.html.erb</code> template. It is getting long and awkward. We
can use partials to clean it up.</p><h4 id="通过局部模板渲染数据集"><a class="anchorlink" href="#%E9%80%9A%E8%BF%87%E5%B1%80%E9%83%A8%E6%A8%A1%E6%9D%BF%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE%E9%9B%86" data-turbolinks="false">9.1 通过局部模板渲染数据集</a></h4><p>First, we will make a comment partial to extract showing all the comments for
the article. Create the file <code>app/views/comments/_comment.html.erb</code> and put the
following into it:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Commenter:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">commenter</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Comment:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;p&gt;
  &lt;strong&gt;Commenter:&lt;/strong&gt;
  &lt;%= comment.commenter %&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;strong&gt;Comment:&lt;/strong&gt;
  &lt;%= comment.body %&gt;
&lt;/p&gt;
">复制</button>
</div>
<p>Then you can change <code>app/views/articles/show.html.erb</code> to look like the
following:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Edit"</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Destroy"</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">),</span> <span class="ss">data: </span><span class="p">{</span>
                    <span class="ss">turbo_method: :delete</span><span class="p">,</span>
                    <span class="ss">turbo_confirm: </span><span class="s2">"Are you sure?"</span>
                  <span class="p">}</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="nt">&lt;h2&gt;</span>Comments<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;h2&gt;</span>Add a comment:<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="p">[</span> <span class="vi">@article</span><span class="p">,</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">build</span> <span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to "Edit", edit_article_path(@article) %&gt;&lt;/li&gt;
  &lt;li&gt;&lt;%= link_to "Destroy", article_path(@article), data: {
                    turbo_method: :delete,
                    turbo_confirm: "Are you sure?"
                  } %&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Comments&lt;/h2&gt;
&lt;%= render @article.comments %&gt;

&lt;h2&gt;Add a comment:&lt;/h2&gt;
&lt;%= form_with model: [ @article, @article.comments.build ] do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :commenter %&gt;&lt;br&gt;
    &lt;%= form.text_field :commenter %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.submit %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
'>复制</button>
</div>
<p>This will now render the partial in <code>app/views/comments/_comment.html.erb</code> once
for each comment that is in the <code>@article.comments</code> collection. As the <code>render</code>
method iterates over the <code>@article.comments</code> collection, it assigns each
comment to a local variable named the same as the partial, in this case
<code>comment</code>, which is then available in the partial for us to show.</p><h4 id="渲染局部模板表单"><a class="anchorlink" href="#%E6%B8%B2%E6%9F%93%E5%B1%80%E9%83%A8%E6%A8%A1%E6%9D%BF%E8%A1%A8%E5%8D%95" data-turbolinks="false">9.2 渲染局部模板表单</a></h4><p>Let us also move that new comment section out to its own partial. Again, you
create a file <code>app/views/comments/_form.html.erb</code> containing:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="p">[</span> <span class="vi">@article</span><span class="p">,</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">build</span> <span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: [ @article, @article.comments.build ] do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :commenter %&gt;&lt;br&gt;
    &lt;%= form.text_field :commenter %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.submit %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
">复制</button>
</div>
<p>Then you make the <code>app/views/articles/show.html.erb</code> look like the following:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Edit"</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Destroy"</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">),</span> <span class="ss">data: </span><span class="p">{</span>
                    <span class="ss">turbo_method: :delete</span><span class="p">,</span>
                    <span class="ss">turbo_confirm: </span><span class="s2">"Are you sure?"</span>
                  <span class="p">}</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="nt">&lt;h2&gt;</span>Comments<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;h2&gt;</span>Add a comment:<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'comments/form'</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to &quot;Edit&quot;, edit_article_path(@article) %&gt;&lt;/li&gt;
  &lt;li&gt;&lt;%= link_to &quot;Destroy&quot;, article_path(@article), data: {
                    turbo_method: :delete,
                    turbo_confirm: &quot;Are you sure?&quot;
                  } %&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Comments&lt;/h2&gt;
&lt;%= render @article.comments %&gt;

&lt;h2&gt;Add a comment:&lt;/h2&gt;
&lt;%= render 'comments/form' %&gt;
">复制</button>
</div>
<p>The second render just defines the partial template we want to render,
<code>comments/form</code>. Rails is smart enough to spot the forward slash in that
string and realize that you want to render the <code>_form.html.erb</code> file in
the <code>app/views/comments</code> directory.</p><p>The <code>@article</code> object is available to any partials rendered in the view because
we defined it as an instance variable.</p><h4 id="使用焦点（concern）"><a class="anchorlink" href="#%E4%BD%BF%E7%94%A8%E7%84%A6%E7%82%B9%EF%BC%88concern%EF%BC%89" data-turbolinks="false">9.3 使用焦点（Concern）</a></h4><p>Concerns are a way to make large controllers or models easier to understand and manage. This also has the advantage of reusability when multiple models (or controllers) share the same concerns. Concerns are implemented using modules that contain methods representing a well-defined slice of the functionality that a model or controller is responsible for. In other languages, modules are often known as mixins.</p><p>You can use concerns in your controller or model the same way you would use any module. When you first created your app with <code>rails new blog</code>, two folders were created within <code>app/</code> along with the rest:</p><div class="code_container">
<pre><code class="highlight plaintext">app/controllers/concerns
app/models/concerns
</code></pre>
<button class="clipboard-button" data-clipboard-text="app/controllers/concerns
app/models/concerns
">复制</button>
</div>
<p>In the example below, we will implement a new feature for our blog that would benefit from using a concern. Then, we will create a concern, and refactor the code to use it, making the code more DRY and maintainable.</p><p>A blog article might have various statuses - for instance, it might be visible to everyone (i.e. <code>public</code>), or only visible to the author (i.e. <code>private</code>). It may also be hidden to all but still retrievable (i.e. <code>archived</code>). Comments may similarly be hidden or visible. This could be represented using a <code>status</code> column in each model.</p><p>First, let's run the following migrations to add <code>status</code> to <code>Articles</code> and <code>Comments</code>:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate migration AddStatusToArticles status:string
<span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate migration AddStatusToComments status:string
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails generate migration AddStatusToArticles status:string
bin/rails generate migration AddStatusToComments status:string
">复制</button>
</div>
<p>And next, let's update the database with the generated migrations:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>db:migrate
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails db:migrate
">复制</button>
</div>
<p>To choose the status for the existing articles and comments you can add a default value to the generated migration files by adding the <code>default: "public"</code> option and launch the migrations again. You can also call in a rails console <code>Article.update_all(status: "public")</code> and <code>Comment.update_all(status: "public")</code>.</p><div class="info"><p>To learn more about migrations, see <a href="active_record_migrations.html">Active Record Migrations</a>.</p></div><p>We also have to permit the <code>:status</code> key as part of the strong parameter, in <code>app/controllers/articles_controller.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby">  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">article_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:article</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">:status</span><span class="p">)</span>
    <span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="  private
    def article_params
      params.require(:article).permit(:title, :body, :status)
    end
">复制</button>
</div>
<p>and in <code>app/controllers/comments_controller.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby">  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">comment_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:comment</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:commenter</span><span class="p">,</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">:status</span><span class="p">)</span>
    <span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="  private
    def comment_params
      params.require(:comment).permit(:commenter, :body, :status)
    end
">复制</button>
</div>
<p>Within the <code>article</code> model, after running a migration to add a <code>status</code> column using <code>bin/rails db:migrate</code> command, you would add:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:comments</span>

  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">10</span> <span class="p">}</span>

  <span class="no">VALID_STATUSES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'public'</span><span class="p">,</span> <span class="s1">'private'</span><span class="p">,</span> <span class="s1">'archived'</span><span class="p">]</span>

  <span class="n">validates</span> <span class="ss">:status</span><span class="p">,</span> <span class="ss">inclusion: </span><span class="p">{</span> <span class="ss">in: </span><span class="no">VALID_STATUSES</span> <span class="p">}</span>

  <span class="k">def</span> <span class="nf">archived?</span>
    <span class="n">status</span> <span class="o">==</span> <span class="s1">'archived'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Article &lt; ApplicationRecord
  has_many :comments

  validates :title, presence: true
  validates :body, presence: true, length: { minimum: 10 }

  VALID_STATUSES = ['public', 'private', 'archived']

  validates :status, inclusion: { in: VALID_STATUSES }

  def archived?
    status == 'archived'
  end
end
">复制</button>
</div>
<p>and in the <code>Comment</code> model:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:article</span>

  <span class="no">VALID_STATUSES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'public'</span><span class="p">,</span> <span class="s1">'private'</span><span class="p">,</span> <span class="s1">'archived'</span><span class="p">]</span>

  <span class="n">validates</span> <span class="ss">:status</span><span class="p">,</span> <span class="ss">inclusion: </span><span class="p">{</span> <span class="ss">in: </span><span class="no">VALID_STATUSES</span> <span class="p">}</span>

  <span class="k">def</span> <span class="nf">archived?</span>
    <span class="n">status</span> <span class="o">==</span> <span class="s1">'archived'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Comment &lt; ApplicationRecord
  belongs_to :article

  VALID_STATUSES = ['public', 'private', 'archived']

  validates :status, inclusion: { in: VALID_STATUSES }

  def archived?
    status == 'archived'
  end
end
">复制</button>
</div>
<p>Then, in our <code>index</code> action template (<code>app/views/articles/index.html.erb</code>) we would use the <code>archived?</code> method to avoid displaying any article that is archived:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">unless</span> <span class="n">article</span><span class="p">.</span><span class="nf">archived?</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span><span class="p">,</span> <span class="n">article</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"New Article"</span><span class="p">,</span> <span class="n">new_article_path</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;% unless article.archived? %&gt;
      &lt;li&gt;
        &lt;%= link_to article.title, article %&gt;
      &lt;/li&gt;
    &lt;% end %&gt;
  &lt;% end %&gt;
&lt;/ul&gt;

&lt;%= link_to "New Article", new_article_path %&gt;
'>复制</button>
</div>
<p>Similarly, in our comment partial view (<code>app/views/comments/_comment.html.erb</code>) we would use the <code>archived?</code> method to avoid displaying any comment that is archived:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%</span> <span class="k">unless</span> <span class="n">comment</span><span class="p">.</span><span class="nf">archived?</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;strong&gt;</span>Commenter:<span class="nt">&lt;/strong&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;strong&gt;</span>Comment:<span class="nt">&lt;/strong&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;% unless comment.archived? %&gt;
  &lt;p&gt;
    &lt;strong&gt;Commenter:&lt;/strong&gt;
    &lt;%= comment.commenter %&gt;
  &lt;/p&gt;

  &lt;p&gt;
    &lt;strong&gt;Comment:&lt;/strong&gt;
    &lt;%= comment.body %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
">复制</button>
</div>
<p>However, if you look again at our models now, you can see that the logic is duplicated. If in the future we increase the functionality of our blog - to include private messages, for instance -  we might find ourselves duplicating the logic yet again. This is where concerns come in handy.</p><p>A concern is only responsible for a focused subset of the model's responsibility; the methods in our concern will all be related to the visibility of a model. Let's call our new concern (module) <code>Visible</code>. We can create a new file inside <code>app/models/concerns</code> called <code>visible.rb</code> , and store all of the status methods that were duplicated in the models.</p><p><code>app/models/concerns/visible.rb</code></p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">Visible</span>
  <span class="k">def</span> <span class="nf">archived?</span>
    <span class="n">status</span> <span class="o">==</span> <span class="s1">'archived'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="module Visible
  def archived?
    status == 'archived'
  end
end
">复制</button>
</div>
<p>We can add our status validation to the concern, but this is slightly more complex as validations are methods called at the class level. The <code>ActiveSupport::Concern</code> (<a href="https://edgeapi.rubyonrails.org/classes/ActiveSupport/Concern.html">API Guide</a>) gives us a simpler way to include them:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">Visible</span>
  <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>

  <span class="no">VALID_STATUSES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'public'</span><span class="p">,</span> <span class="s1">'private'</span><span class="p">,</span> <span class="s1">'archived'</span><span class="p">]</span>

  <span class="n">included</span> <span class="k">do</span>
    <span class="n">validates</span> <span class="ss">:status</span><span class="p">,</span> <span class="ss">inclusion: </span><span class="p">{</span> <span class="ss">in: </span><span class="no">VALID_STATUSES</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">archived?</span>
    <span class="n">status</span> <span class="o">==</span> <span class="s1">'archived'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="module Visible
  extend ActiveSupport::Concern

  VALID_STATUSES = ['public', 'private', 'archived']

  included do
    validates :status, inclusion: { in: VALID_STATUSES }
  end

  def archived?
    status == 'archived'
  end
end
">复制</button>
</div>
<p>Now, we can remove the duplicated logic from each model and instead include our new <code>Visible</code> module:</p><p>In <code>app/models/article.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="kp">include</span> <span class="no">Visible</span>

  <span class="n">has_many</span> <span class="ss">:comments</span>

  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">10</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Article &lt; ApplicationRecord
  include Visible

  has_many :comments

  validates :title, presence: true
  validates :body, presence: true, length: { minimum: 10 }
end
">复制</button>
</div>
<p>and in <code>app/models/comment.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="kp">include</span> <span class="no">Visible</span>

  <span class="n">belongs_to</span> <span class="ss">:article</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Comment &lt; ApplicationRecord
  include Visible

  belongs_to :article
end
">复制</button>
</div>
<p>Class methods can also be added to concerns. If we want to display a count of public articles or comments on our main page, we might add a class method to Visible as follows:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">Visible</span>
  <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>

  <span class="no">VALID_STATUSES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'public'</span><span class="p">,</span> <span class="s1">'private'</span><span class="p">,</span> <span class="s1">'archived'</span><span class="p">]</span>

  <span class="n">included</span> <span class="k">do</span>
    <span class="n">validates</span> <span class="ss">:status</span><span class="p">,</span> <span class="ss">inclusion: </span><span class="p">{</span> <span class="ss">in: </span><span class="no">VALID_STATUSES</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">class_methods</span> <span class="k">do</span>
    <span class="k">def</span> <span class="nf">public_count</span>
      <span class="n">where</span><span class="p">(</span><span class="ss">status: </span><span class="s1">'public'</span><span class="p">).</span><span class="nf">count</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">archived?</span>
    <span class="n">status</span> <span class="o">==</span> <span class="s1">'archived'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="module Visible
  extend ActiveSupport::Concern

  VALID_STATUSES = ['public', 'private', 'archived']

  included do
    validates :status, inclusion: { in: VALID_STATUSES }
  end

  class_methods do
    def public_count
      where(status: 'public').count
    end
  end

  def archived?
    status == 'archived'
  end
end
">复制</button>
</div>
<p>Then in the view, you can call it like any class method:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

Our blog has <span class="cp">&lt;%=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">public_count</span> <span class="cp">%&gt;</span> articles and counting!

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">unless</span> <span class="n">article</span><span class="p">.</span><span class="nf">archived?</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span><span class="p">,</span> <span class="n">article</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"New Article"</span><span class="p">,</span> <span class="n">new_article_path</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;h1&gt;Articles&lt;/h1&gt;

Our blog has &lt;%= Article.public_count %&gt; articles and counting!

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;% unless article.archived? %&gt;
      &lt;li&gt;
        &lt;%= link_to article.title, article %&gt;
      &lt;/li&gt;
    &lt;% end %&gt;
  &lt;% end %&gt;
&lt;/ul&gt;

&lt;%= link_to "New Article", new_article_path %&gt;
'>复制</button>
</div>
<p>To finish up, we will add a select box to the forms, and let the user select the status when they create a new article or post a new comment. We can also specify the default status as <code>public</code>. In <code>app/views/articles/_form.html.erb</code>, we can add:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;div&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:status</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">select</span> <span class="ss">:status</span><span class="p">,</span> <span class="p">[</span><span class="s1">'public'</span><span class="p">,</span> <span class="s1">'private'</span><span class="p">,</span> <span class="s1">'archived'</span><span class="p">],</span> <span class="ss">selected: </span><span class="s1">'public'</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;div&gt;
  &lt;%= form.label :status %&gt;&lt;br&gt;
  &lt;%= form.select :status, ['public', 'private', 'archived'], selected: 'public' %&gt;
&lt;/div&gt;
">复制</button>
</div>
<p>and in <code>app/views/comments/_form.html.erb</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;p&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:status</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">select</span> <span class="ss">:status</span><span class="p">,</span> <span class="p">[</span><span class="s1">'public'</span><span class="p">,</span> <span class="s1">'private'</span><span class="p">,</span> <span class="s1">'archived'</span><span class="p">],</span> <span class="ss">selected: </span><span class="s1">'public'</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;p&gt;
  &lt;%= form.label :status %&gt;&lt;br&gt;
  &lt;%= form.select :status, ['public', 'private', 'archived'], selected: 'public' %&gt;
&lt;/p&gt;
">复制</button>
</div>
<h3 id="删除评论"><a class="anchorlink" href="#%E5%88%A0%E9%99%A4%E8%AF%84%E8%AE%BA" data-turbolinks="false">10 删除评论</a></h3><p>Another important feature of a blog is being able to delete spam comments. To do
this, we need to implement a link of some sort in the view and a <code>destroy</code>
action in the <code>CommentsController</code>.</p><p>So first, let's add the delete link in the
<code>app/views/comments/_comment.html.erb</code> partial:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Commenter:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">commenter</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Comment:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Destroy Comment"</span><span class="p">,</span> <span class="p">[</span><span class="n">comment</span><span class="p">.</span><span class="nf">article</span><span class="p">,</span> <span class="n">comment</span><span class="p">],</span> <span class="ss">data: </span><span class="p">{</span>
                <span class="ss">turbo_method: :delete</span><span class="p">,</span>
                <span class="ss">turbo_confirm: </span><span class="s2">"Are you sure?"</span>
              <span class="p">}</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;p&gt;
  &lt;strong&gt;Commenter:&lt;/strong&gt;
  &lt;%= comment.commenter %&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;strong&gt;Comment:&lt;/strong&gt;
  &lt;%= comment.body %&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;%= link_to "Destroy Comment", [comment.article, comment], data: {
                turbo_method: :delete,
                turbo_confirm: "Are you sure?"
              } %&gt;
&lt;/p&gt;
'>复制</button>
</div>
<p>Clicking this new "Destroy Comment" link will fire off a <code>DELETE
/articles/:article_id/comments/:id</code> to our <code>CommentsController</code>, which can then
use this to find the comment we want to delete, so let's add a <code>destroy</code> action
to our controller (<code>app/controllers/comments_controller.rb</code>):</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article_id</span><span class="p">])</span>
    <span class="vi">@comment</span> <span class="o">=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">comment_params</span><span class="p">)</span>
    <span class="n">redirect_to</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article_id</span><span class="p">])</span>
    <span class="vi">@comment</span> <span class="o">=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
    <span class="vi">@comment</span><span class="p">.</span><span class="nf">destroy</span>
    <span class="n">redirect_to</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">),</span> <span class="ss">status: </span><span class="mi">303</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">comment_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:comment</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:commenter</span><span class="p">,</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">:status</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class CommentsController &lt; ApplicationController
  def create
    @article = Article.find(params[:article_id])
    @comment = @article.comments.create(comment_params)
    redirect_to article_path(@article)
  end

  def destroy
    @article = Article.find(params[:article_id])
    @comment = @article.comments.find(params[:id])
    @comment.destroy
    redirect_to article_path(@article), status: 303
  end

  private
    def comment_params
      params.require(:comment).permit(:commenter, :body, :status)
    end
end
">复制</button>
</div>
<p>The <code>destroy</code> action will find the article we are looking at, locate the comment
within the <code>@article.comments</code> collection, and then remove it from the
database and send us back to the show action for the article.</p><h4 id="删除关联对象"><a class="anchorlink" href="#%E5%88%A0%E9%99%A4%E5%85%B3%E8%81%94%E5%AF%B9%E8%B1%A1" data-turbolinks="false">10.1 删除关联对象</a></h4><p>If you delete an article, its associated comments will also need to be
deleted, otherwise they would simply occupy space in the database. Rails allows
you to use the <code>dependent</code> option of an association to achieve this. Modify the
Article model, <code>app/models/article.rb</code>, as follows:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="kp">include</span> <span class="no">Visible</span>

  <span class="n">has_many</span> <span class="ss">:comments</span><span class="p">,</span> <span class="ss">dependent: :destroy</span>

  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">10</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Article &lt; ApplicationRecord
  include Visible

  has_many :comments, dependent: :destroy

  validates :title, presence: true
  validates :body, presence: true, length: { minimum: 10 }
end
">复制</button>
</div>
<h3 id="安全"><a class="anchorlink" href="#%E5%AE%89%E5%85%A8" data-turbolinks="false">11 安全</a></h3><h4 id="基本认证"><a class="anchorlink" href="#%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%81" data-turbolinks="false">11.1 基本认证</a></h4><p>If you were to publish your blog online, anyone would be able to add, edit and
delete articles or delete comments.</p><p>Rails provides an HTTP authentication system that will work nicely in
this situation.</p><p>In the <code>ArticlesController</code> we need to have a way to block access to the
various actions if the person is not authenticated. Here we can use the Rails
<code>http_basic_authenticate_with</code> method, which allows access to the requested
action if that method allows it.</p><p>To use the authentication system, we specify it at the top of our
<code>ArticlesController</code> in <code>app/controllers/articles_controller.rb</code>. In our case,
we want the user to be authenticated on every action except <code>index</code> and <code>show</code>,
so we write that:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="n">http_basic_authenticate_with</span> <span class="ss">name: </span><span class="s2">"dhh"</span><span class="p">,</span> <span class="ss">password: </span><span class="s2">"secret"</span><span class="p">,</span> <span class="ss">except: </span><span class="p">[</span><span class="ss">:index</span><span class="p">,</span> <span class="ss">:show</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="c1"># snippet for brevity</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='class ArticlesController &lt; ApplicationController

  http_basic_authenticate_with name: "dhh", password: "secret", except: [:index, :show]

  def index
    @articles = Article.all
  end

  # snippet for brevity
'>复制</button>
</div>
<p>We also want to allow only authenticated users to delete comments, so in the
<code>CommentsController</code> (<code>app/controllers/comments_controller.rb</code>) we write:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="n">http_basic_authenticate_with</span> <span class="ss">name: </span><span class="s2">"dhh"</span><span class="p">,</span> <span class="ss">password: </span><span class="s2">"secret"</span><span class="p">,</span> <span class="ss">only: :destroy</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article_id</span><span class="p">])</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>

  <span class="c1"># snippet for brevity</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='class CommentsController &lt; ApplicationController

  http_basic_authenticate_with name: "dhh", password: "secret", only: :destroy

  def create
    @article = Article.find(params[:article_id])
    # ...
  end

  # snippet for brevity
'>复制</button>
</div>
<p>Now if you try to create a new article, you will be greeted with a basic HTTP
Authentication challenge:</p><p><img src="images/getting_started/challenge.png" alt="Basic HTTP Authentication Challenge"></p><p>After entering the correct username and password, you will remain authenticated
until a different username and password is required or the browser is closed.</p><p>Other authentication methods are available for Rails applications. Two popular
authentication add-ons for Rails are the
<a href="https://github.com/plataformatec/devise">Devise</a> rails engine and
the <a href="https://github.com/binarylogic/authlogic">Authlogic</a> gem,
along with a number of others.</p><h4 id="其他安全方案"><a class="anchorlink" href="#%E5%85%B6%E4%BB%96%E5%AE%89%E5%85%A8%E6%96%B9%E6%A1%88" data-turbolinks="false">11.2 其他安全方案</a></h4><p>Security, especially in web applications, is a broad and detailed area. Security
in your Rails application is covered in more depth in
the <a href="security.html">Ruby on Rails 安全指南</a>.</p><h3 id="接下来做什么？"><a class="anchorlink" href="#%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%81%9A%E4%BB%80%E4%B9%88%EF%BC%9F" data-turbolinks="false">12 接下来做什么？</a></h3><p>Now that you've seen your first Rails application, you should feel free to
update it and experiment on your own.</p><p>Remember, you don't have to do everything without help. As you need assistance
getting up and running with Rails, feel free to consult these support
resources:</p>
<ul>
<li>The <a href="index.html">Ruby on Rails Guides</a>
</li>
<li>The <a href="https://discuss.rubyonrails.org/c/rubyonrails-talk">Ruby on Rails mailing list</a>
</li>
</ul>
<h3 id="配置的坑"><a class="anchorlink" href="#%E9%85%8D%E7%BD%AE%E7%9A%84%E5%9D%91" data-turbolinks="false">13 配置的坑</a></h3><p>The easiest way to work with Rails is to store all external data as UTF-8. If
you don't, Ruby libraries and Rails will often be able to convert your native
data into UTF-8, but this doesn't always work reliably, so you're better off
ensuring that all external data is UTF-8.</p><p>If you have made a mistake in this area, the most common symptom is a black
diamond with a question mark inside appearing in the browser. Another common
symptom is characters like "Ã¼" appearing instead of "ü". Rails takes a number
of internal steps to mitigate common causes of these problems that can be
automatically detected and corrected. However, if you have external data that is
not stored as UTF-8, it can occasionally result in these kinds of issues that
cannot be automatically detected by Rails and corrected.</p><p>Two very common sources of data that are not UTF-8:</p>
<ul>
<li>Your text editor: Most text editors (such as TextMate), default to saving
files as UTF-8. If your text editor does not, this can result in special
characters that you enter in your templates (such as é) to appear as a diamond
with a question mark inside in the browser. This also applies to your i18n
translation files. Most editors that do not already default to UTF-8 (such as
some versions of Dreamweaver) offer a way to change the default to UTF-8. Do
so.</li>
<li>Your database: Rails defaults to converting data from your database into UTF-8
at the boundary. However, if your database is not using UTF-8 internally, it
may not be able to store all characters that your users enter. For instance,
if your database is using Latin-1 internally, and your user enters a Russian,
Hebrew, or Japanese character, the data will be lost forever once it enters
the database. If possible, use UTF-8 as the internal storage of your database.</li>
</ul>


        <h3>反馈</h3>
        <p>
          衷心希望您能帮我们提升指南质量。
        </p>
        <p>
          您发现任何错误都可以帮助我们。
          如果想要参与贡献可以参阅<a href="https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">文档贡献</a>章节获取相关细节。
        </p>
        <p>
          如果您发现有内容不完整或者有些内容需要更新，请进行相关补充和完善。
          开始之前要检查一下
          <a href="https://edgeguides.rubyonrails.org">抢鲜版指南</a>中是否
          已经修复了这些问题，或者这些问题是否出现在主分支（main branch）内。
          如果以上检查完成后，确认为需要完善文档，请参考<a href="ruby_on_rails_guides_guidelines.html">《Ruby on Rails 指南》之指南</a>，
          以确保您使用了正确的编写风格和编写习惯。
        </p>
        <p>
          如果您发现了一个问题，但是自己不会修复，请在 Github 
          <a href="https://github.com/rails/rails/issues">发一个问题帖子</a>。
        </p>
        <p>最后，但并非不重要的是——<a href="https://discuss.rubyonrails.org/c/rubyonrails-docs">Rubyonrails-Docs 邮件列表</a>
        欢迎大家提出任何关于 Ruby on Rails 文档的问题。
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>本作品基于<a href="https://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a>创作共享</p>
<p>“Rails”、“Ruby on Rails” 和 Rails 标志都是 David Heinemeier Hansson 注册的商标，版权所有。</p>

    </div>
  </div>
  <button id="back2Top">▲</button>
  <script>
		const button = document.querySelector("#back2Top");
		BACK2TOP(button, 200);
	</script>	
</body>
</html>
