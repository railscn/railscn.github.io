<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Action View 表单辅助方法 — Ruby on Rails 指南</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
  <link rel="stylesheet" type="text/css" href="stylesheets/highlight.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/backtop.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/chntypo.css" data-turbolinks-track="reload">
  <link href="images/favicon.ico" rel="icon" type="image/x-icon" />
  <script src="javascripts/turbolinks.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/clipboard.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/guides.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/back2top.js" data-turbolinks-track="reload"></script>
  <meta property="og:title" content="Action View 表单辅助方法 — Ruby on Rails 指南" />
  <meta name="description" content="Action View 表单辅助方法表单（Form）是 Web 应用程序中用户输入数据必备工具。但是，由于需要处理表单控 件命名及其众多属性，表单标记的编写和维护很快就会变得乏味。Rails 通过提供用 于生成表单标记的视图辅助方法来消除这种复杂性。但是，由于这些辅助方法有不同 的使用方法，开发人员需要在使用它们之前了解不同辅助方法之间的区别。通过阅读本指南，您将掌握： 如何在您的应用程序中创建不代表任何特定模型的搜索表单和其他类似类型的通用表单。 如何制作以模型为中心的表单来创建和编辑特定数据库记录。 如何从多种类型的数据中生成选择框。 Rails 提供了哪些日期和时间辅助方法。 是什么让文件上传表单与众不同。 如何将表单发布到外部资源并设置 authenticity_token。 如何构建复杂的表单。" />
  <meta property="og:description" content="Action View 表单辅助方法表单（Form）是 Web 应用程序中用户输入数据必备工具。但是，由于需要处理表单控 件命名及其众多属性，表单标记的编写和维护很快就会变得乏味。Rails 通过提供用 于生成表单标记的视图辅助方法来消除这种复杂性。但是，由于这些辅助方法有不同 的使用方法，开发人员需要在使用它们之前了解不同辅助方法之间的区别。通过阅读本指南，您将掌握： 如何在您的应用程序中创建不代表任何特定模型的搜索表单和其他类似类型的通用表单。 如何制作以模型为中心的表单来创建和编辑特定数据库记录。 如何从多种类型的数据中生成选择框。 Rails 提供了哪些日期和时间辅助方法。 是什么让文件上传表单与众不同。 如何将表单发布到外部资源并设置 authenticity_token。 如何构建复杂的表单。" />
  <meta property="og:locale" content="zh_CN" />
  <meta property="og:site_name" content="Ruby on Rails 指南" />
  <meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
  <meta property="og:type" content="website" />
</head>
<body class="guide">
  <div>
    <div id="version-badge">edge</div>
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">更多信息在 <a href="https://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        更多 Ruby on Rails 信息
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://rubyonrails.org/blog">博客</a></li>
        <li class="more-info"><a href="https://guides.rubyonrails.org/">指南</a></li>
        <li class="more-info"><a href="https://api.rubyonrails.org/">API</a></li>
        <li class="more-info"><a href="https://discuss.rubyonrails.org/">论坛</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">在 GitHub 做贡献</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="返回首页">railsguides.cn</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">首页</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">指南目录</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
            <dl class="guides-section-container">
                <div class="guides-section">
                  <dt>从这里开始</dt>
                  <dd><a href="getting_started.html">Rails 入门</a></dd>
                </div>
                <div class="guides-section">
                  <dt>模型（Model）</dt>
                  <dd><a href="active_record_basics.html">Active Record 基础</a></dd>
                  <dd><a href="active_record_migrations.html">Active Record 修改</a></dd>
                  <dd><a href="active_record_validations.html">Active Record 验证</a></dd>
                  <dd><a href="active_record_callbacks.html">Active Record 回调</a></dd>
                  <dd><a href="association_basics.html">Active Record 关联</a></dd>
                  <dd><a href="active_record_querying.html">Active Record 查询接口</a></dd>
                </div>
                <div class="guides-section">
                  <dt>视图（View）</dt>
                  <dd><a href="layouts_and_rendering.html">Rails 的模板布局与视图呈现</a></dd>
                  <dd><a href="form_helpers.html">Action View 表单辅助方法</a></dd>
                </div>
                <div class="guides-section">
                  <dt>控制器（Controller）</dt>
                  <dd><a href="action_controller_overview.html">Action Controller 概览</a></dd>
                  <dd><a href="routing.html">Rails 路由从入门到精通</a></dd>
                </div>
                <div class="guides-section">
                  <dt>其他组件</dt>
                  <dd><a href="active_support_core_extensions.html">Active Support 核心扩展</a></dd>
                  <dd><a href="action_mailer_basics.html">Action Mailer 基础</a></dd>
                  <dd><a href="active_job_basics.html">Active Job 基础</a></dd>
                  <dd><a href="active_storage_overview.html">Active Storage 概览</a></dd>
                  <dd><a href="action_cable_overview.html">Action Cable 概览</a></dd>
                  <dd><a href="webpacker.html">Webpacker</a></dd>
                </div>
                <div class="guides-section">
                  <dt>高级指南</dt>
                  <dd><a href="i18n.html">Rails 国际化（I18n） API</a></dd>
                  <dd><a href="testing.html">Rails 应用程序的测试</a></dd>
                  <dd><a href="security.html">Rails 应用程序的安全</a></dd>
                  <dd><a href="debugging_rails_applications.html">Rails 应用程序的调试</a></dd>
                  <dd><a href="configuring.html">Rails 应用程序的配置</a></dd>
                  <dd><a href="command_line.html">Rails 命令行</a></dd>
                  <dd><a href="asset_pipeline.html">Asset Pipeline</a></dd>
                  <dd><a href="working_with_javascript_in_rails.html">在 Rails 中使用 JavaScript</a></dd>
                  <dd><a href="autoloading_and_reloading_constants.html">自动加载和重载常量</a></dd>
                  <dd><a href="classic_to_zeitwerk_howto.html">如何从传统过渡到 Zeitwerk</a></dd>
                  <dd><a href="caching_with_rails.html">Rails 缓存概览</a></dd>
                  <dd><a href="api_app.html">用 Rails 只做应用程序后台 API</a></dd>
                  <dd><a href="active_record_multiple_databases.html">Active Record 支持多数据库</a></dd>
                </div>
                <div class="guides-section">
                  <dt>扩展 Rails</dt>
                  <dd><a href="rails_on_rack.html">Rack 中的 Rails</a></dd>
                  <dd><a href="generators.html">创建和定制 Rails 生成器/模板</a></dd>
                </div>
                <div class="guides-section">
                  <dt>贡献</dt>
                  <dd><a href="contributing_to_ruby_on_rails.html">为 Ruby on Rails 贡献</a></dd>
                  <dd><a href="api_documentation_guidelines.html">API 文档指南</a></dd>
                  <dd><a href="ruby_on_rails_guides_guidelines.html">指南大纲</a></dd>
                </div>
                <div class="guides-section">
                  <dt>政策（Policies）</dt>
                  <dd><a href="maintenance_policy.html">维护政策</a></dd>
                </div>
                <div class="guides-section">
                  <dt>版本说明</dt>
                  <dd><a href="upgrading_ruby_on_rails.html">更新 Ruby on Rails</a></dd>
                  <dd><a href="7_0_release_notes.html">7.0 版本 —— 2021 年 12 月</a></dd>
                  <dd><a href="6_1_release_notes.html">6.1 版本 —— 2020 年 12 月</a></dd>
                  <dd><a href="6_0_release_notes.html">6.0 版本 —— 2019 年 9 月</a></dd>
                  <dd><a href="5_2_release_notes.html">5.2 版本 —— 2018 年 4 月</a></dd>
                  <dd><a href="5_1_release_notes.html">5.1 版本 —— 2017 年 4 月</a></dd>
                  <dd><a href="5_0_release_notes.html">5.0 版本 —— 2016 年 6 月</a></dd>
                  <dd><a href="4_2_release_notes.html">4.2 版本 —— 2014 年 12 月</a></dd>
                  <dd><a href="4_1_release_notes.html">4.1 版本 —— 2014 年 4 月</a></dd>
                  <dd><a href="4_0_release_notes.html">4.0 版本 —— 2013 年 6 月</a></dd>
                  <dd><a href="3_2_release_notes.html">3.2 版本 —— 2012 年 1 月</a></dd>
                  <dd><a href="3_1_release_notes.html">3.1 版本 —— 2011 年 8 月</a></dd>
                  <dd><a href="3_0_release_notes.html">3.0 版本 —— 2010 年 8 月</a></dd>
                  <dd><a href="2_3_release_notes.html">2.3 版本 —— 2009 年 3 月</a></dd>
                  <dd><a href="2_2_release_notes.html">2.2 版本 —— 2008 年 11 月</a></dd>
                </div>
            </dl>
          </div>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">贡献</a></li>
        <li><a class="nav-item" href="about.html">关于</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">指南目录</option>
              <optgroup label="从这里开始">
                  <option value="getting_started.html">Rails 入门</option>
              </optgroup>
              <optgroup label="模型（Model）">
                  <option value="active_record_basics.html">Active Record 基础</option>
                  <option value="active_record_migrations.html">Active Record 修改</option>
                  <option value="active_record_validations.html">Active Record 验证</option>
                  <option value="active_record_callbacks.html">Active Record 回调</option>
                  <option value="association_basics.html">Active Record 关联</option>
                  <option value="active_record_querying.html">Active Record 查询接口</option>
              </optgroup>
              <optgroup label="视图（View）">
                  <option value="layouts_and_rendering.html">Rails 的模板布局与视图呈现</option>
                  <option value="form_helpers.html">Action View 表单辅助方法</option>
              </optgroup>
              <optgroup label="控制器（Controller）">
                  <option value="action_controller_overview.html">Action Controller 概览</option>
                  <option value="routing.html">Rails 路由从入门到精通</option>
              </optgroup>
              <optgroup label="其他组件">
                  <option value="active_support_core_extensions.html">Active Support 核心扩展</option>
                  <option value="action_mailer_basics.html">Action Mailer 基础</option>
                  <option value="active_job_basics.html">Active Job 基础</option>
                  <option value="active_storage_overview.html">Active Storage 概览</option>
                  <option value="action_cable_overview.html">Action Cable 概览</option>
                  <option value="webpacker.html">Webpacker</option>
              </optgroup>
              <optgroup label="高级指南">
                  <option value="i18n.html">Rails 国际化（I18n） API</option>
                  <option value="testing.html">Rails 应用程序的测试</option>
                  <option value="security.html">Rails 应用程序的安全</option>
                  <option value="debugging_rails_applications.html">Rails 应用程序的调试</option>
                  <option value="configuring.html">Rails 应用程序的配置</option>
                  <option value="command_line.html">Rails 命令行</option>
                  <option value="asset_pipeline.html">Asset Pipeline</option>
                  <option value="working_with_javascript_in_rails.html">在 Rails 中使用 JavaScript</option>
                  <option value="autoloading_and_reloading_constants.html">自动加载和重载常量</option>
                  <option value="classic_to_zeitwerk_howto.html">如何从传统过渡到 Zeitwerk</option>
                  <option value="caching_with_rails.html">Rails 缓存概览</option>
                  <option value="api_app.html">用 Rails 只做应用程序后台 API</option>
                  <option value="active_record_multiple_databases.html">Active Record 支持多数据库</option>
              </optgroup>
              <optgroup label="扩展 Rails">
                  <option value="rails_on_rack.html">Rack 中的 Rails</option>
                  <option value="generators.html">创建和定制 Rails 生成器/模板</option>
              </optgroup>
              <optgroup label="贡献">
                  <option value="contributing_to_ruby_on_rails.html">为 Ruby on Rails 贡献</option>
                  <option value="api_documentation_guidelines.html">API 文档指南</option>
                  <option value="ruby_on_rails_guides_guidelines.html">指南大纲</option>
              </optgroup>
              <optgroup label="政策（Policies）">
                  <option value="maintenance_policy.html">维护政策</option>
              </optgroup>
              <optgroup label="版本说明">
                  <option value="upgrading_ruby_on_rails.html">更新 Ruby on Rails</option>
                  <option value="7_0_release_notes.html">7.0 版本 —— 2021 年 12 月</option>
                  <option value="6_1_release_notes.html">6.1 版本 —— 2020 年 12 月</option>
                  <option value="6_0_release_notes.html">6.0 版本 —— 2019 年 9 月</option>
                  <option value="5_2_release_notes.html">5.2 版本 —— 2018 年 4 月</option>
                  <option value="5_1_release_notes.html">5.1 版本 —— 2017 年 4 月</option>
                  <option value="5_0_release_notes.html">5.0 版本 —— 2016 年 6 月</option>
                  <option value="4_2_release_notes.html">4.2 版本 —— 2014 年 12 月</option>
                  <option value="4_1_release_notes.html">4.1 版本 —— 2014 年 4 月</option>
                  <option value="4_0_release_notes.html">4.0 版本 —— 2013 年 6 月</option>
                  <option value="3_2_release_notes.html">3.2 版本 —— 2012 年 1 月</option>
                  <option value="3_1_release_notes.html">3.1 版本 —— 2011 年 8 月</option>
                  <option value="3_0_release_notes.html">3.0 版本 —— 2010 年 8 月</option>
                  <option value="2_3_release_notes.html">2.3 版本 —— 2009 年 3 月</option>
                  <option value="2_2_release_notes.html">2.2 版本 —— 2008 年 11 月</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Action View 表单辅助方法</h2><p>表单（Form）是 Web 应用程序中用户输入数据必备工具。但是，由于需要处理表单控
件命名及其众多属性，表单标记的编写和维护很快就会变得乏味。Rails 通过提供用
于生成表单标记的视图辅助方法来消除这种复杂性。但是，由于这些辅助方法有不同
的使用方法，开发人员需要在使用它们之前了解不同辅助方法之间的区别。</p><p>通过阅读本指南，您将掌握：</p>
<ul>
<li>如何在您的应用程序中创建不代表任何特定模型的搜索表单和其他类似类型的通用表单。</li>
<li>如何制作以模型为中心的表单来创建和编辑特定数据库记录。</li>
<li>如何从多种类型的数据中生成选择框。</li>
<li>Rails 提供了哪些日期和时间辅助方法。</li>
<li>是什么让文件上传表单与众不同。</li>
<li>如何将表单发布到外部资源并设置 <code>authenticity_token</code>。</li>
<li>如何构建复杂的表单。</li>
</ul>


                <div id="subCol" data-turbolinks="false">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />题要</h3>
            <ol class="chapters">
<li>
<a href="#%E5%A4%84%E7%90%86%E5%9F%BA%E6%9C%AC%E8%A1%A8%E5%8D%95">处理基本表单</a>

<ul>
<li><a href="#%E9%80%9A%E7%94%A8%E6%90%9C%E7%B4%A2%E8%A1%A8%E5%8D%95">通用搜索表单</a></li>
<li><a href="#%E7%94%9F%E6%88%90%E8%A1%A8%E5%8D%95%E5%85%83%E7%B4%A0%E7%9A%84%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95">生成表单元素的辅助方法</a></li>
<li><a href="#%E5%85%B6%E4%BB%96%E6%84%9F%E5%85%B4%E8%B6%A3%E7%9A%84%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95">其他感兴趣的辅助方法</a></li>
</ul>
</li>
<li>
<a href="#%E5%A4%84%E7%90%86%E6%A8%A1%E5%9E%8B%E5%AF%B9%E8%B1%A1">处理模型对象</a>

<ul>
<li><a href="#%E7%BB%91%E5%AE%9A%E5%AF%B9%E8%B1%A1%E5%88%B0%E8%A1%A8%E5%8D%95">绑定对象到表单</a></li>
<li><a href="#relying-on-record-identification">Relying on Record Identification</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8-patch%E3%80%81put-%E6%88%96-delete-%E6%96%B9%E6%B3%95%E7%9A%84%E8%A1%A8%E5%8D%95%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%EF%BC%9F">使用 PATCH、PUT 或 DELETE 方法的表单如何工作？</a></li>
</ul>
</li>
<li>
<a href="#%E8%BD%BB%E6%9D%BE%E5%88%B6%E4%BD%9C%E9%80%89%E6%8B%A9%E6%A1%86">轻松制作选择框</a>

<ul>
<li><a href="#%E7%BE%A4%E7%BB%84%E9%80%89%E9%A1%B9">群组选项</a></li>
<li><a href="#%E9%80%89%E6%8B%A9%E6%A1%86%E5%92%8C%E6%A8%A1%E5%9E%8B%E5%AF%B9%E8%B1%A1">选择框和模型对象</a></li>
<li><a href="#%E6%97%B6%E5%8C%BA%EF%BC%88time-zone%EF%BC%89%E5%92%8C%E5%9B%BD%E5%AE%B6%E9%80%89%E6%8B%A9%E6%A1%86">时区（Time Zone）和国家选择框</a></li>
</ul>
</li>
<li>
<a href="#%E4%BD%BF%E7%94%A8%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E8%A1%A8%E5%8D%95%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95">使用日期和时间表单辅助方法</a>

<ul>
<li><a href="#%E5%8D%95%E7%8B%AC%E6%97%B6%E9%97%B4%E7%BB%84%E4%BB%B6%E9%80%89%E6%8B%A9%E6%A1%86">单独时间组件选择框</a></li>
</ul>
</li>
<li>
<a href="#%E6%9D%A5%E8%87%AA%E4%BB%BB%E6%84%8F%E9%9B%86%E5%90%88%E5%AF%B9%E8%B1%A1%E7%9A%84%E9%80%89%E6%8B%A9%E6%A1%86">来自任意集合对象的选择框</a>

<ul>
<li><a href="#collection-select-%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95"><code>collection_select</code> 辅助方法</a></li>
<li><a href="#collection-radio-buttons-%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95"><code>collection_radio_buttons</code> 辅助方法</a></li>
<li><a href="#collection-check-boxes-%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95"><code>collection_check_boxes</code> 辅助方法</a></li>
</ul>
</li>
<li>
<a href="#%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6">上传文件</a>

<ul>
<li><a href="#%E4%B8%8A%E4%BC%A0%E4%BA%86%E4%BB%80%E4%B9%88">上传了什么</a></li>
</ul>
</li>
<li><a href="#%E5%AE%9A%E5%88%B6%E8%A1%A8%E5%8D%95%E6%9E%84%E9%80%A0%E5%99%A8">定制表单构造器</a></li>
<li>
<a href="#%E7%90%86%E8%A7%A3%E5%8F%82%E6%95%B0%E5%91%BD%E5%90%8D%E7%BA%A6%E5%AE%9A">理解参数命名约定</a>

<ul>
<li><a href="#%E5%9F%BA%E6%9C%AC%E6%9E%84%E6%88%90">基本构成</a></li>
<li><a href="#%E7%BB%84%E5%90%88%E5%AE%83%E4%BB%AC">组合它们</a></li>
<li><a href="#fields-for-%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95%E5%92%8C-index-%E9%80%89%E9%A1%B9"><code>fields_for</code> 辅助方法和 <code>:index</code> 选项</a></li>
</ul>
</li>
<li><a href="#%E8%A1%A8%E5%8D%95%E6%89%A9%E5%B1%95%E8%B5%84%E6%BA%90">表单扩展资源</a></li>
<li>
<a href="#%E6%9E%84%E5%BB%BA%E5%A4%8D%E6%9D%82%E8%A1%A8%E5%8D%95">构建复杂表单</a>

<ul>
<li><a href="#%E9%85%8D%E7%BD%AE%E6%A8%A1%E5%9E%8B">配置模型</a></li>
<li><a href="#%E5%B5%8C%E5%A5%97%E8%A1%A8%E5%8D%95">嵌套表单</a></li>
<li><a href="#%E6%8E%A7%E5%88%B6%E5%99%A8">控制器</a></li>
<li><a href="#%E5%88%A0%E9%99%A4%E5%AF%B9%E8%B1%A1">删除对象</a></li>
<li><a href="#%E9%98%BB%E6%AD%A2%E7%A9%BA%E8%AE%B0%E5%BD%95">阻止空记录</a></li>
<li><a href="#%E5%87%AD%E7%A9%BA%E6%B7%BB%E5%8A%A0%E5%AD%97%E6%AE%B5">凭空添加字段</a></li>
</ul>
</li>
<li><a href="#%E8%84%B1%E7%A6%BB%E8%A1%A8%E5%8D%95%E6%9E%84%E9%80%A0%E5%99%A8%E4%BD%BF%E7%94%A8-tag-%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95">脱离表单构造器使用 Tag 辅助方法</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8-form-tag-%E5%92%8C-form-for">使用 <code>form_tag</code> 和 <code>form_for</code></a></li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <div class="note"><p>本指南并非表单辅助方法及其参数的完整文档，获取完整参考请查阅 <a href="https://edgeapi.rubyonrails.org/">Rails API 文档</a>。</p></div><h3 id="处理基本表单"><a class="anchorlink" href="#%E5%A4%84%E7%90%86%E5%9F%BA%E6%9C%AC%E8%A1%A8%E5%8D%95" data-turbolinks="false">1 处理基本表单</a></h3><p>最主要的表单辅助方法是 <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormHelper.html#method-i-form_with"><code>form_with</code></a>。</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  Form contents
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= form_with do |form| %&gt;
  Form contents
&lt;% end %&gt;
">复制</button>
</div>
<p>当我们向这样调用没有参数的 <code>form_with</code> 的时候，它会创建一个表单标签，提交时
将以 POST 方式发送当前页面。例如：假设当前页是主页，生成的 HTML 看起来像这样：</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">action=</span><span class="s">"/"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"authenticity_token"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"J7CBxfHalt49OSHp27hblqK20c9PgwJ108nDHX/8Cts="</span> <span class="nt">/&gt;</span>
  Form contents
<span class="nt">&lt;/form&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;form accept-charset="UTF-8" action="/" method="post"&gt;
  &lt;input name="authenticity_token" type="hidden" value="J7CBxfHalt49OSHp27hblqK20c9PgwJ108nDHX/8Cts=" /&gt;
  Form contents
&lt;/form&gt;
'>复制</button>
</div>
<p>您会看到 HTML 包含一个类型（Type)为 <code>hidden</code> 的 <code>input</code> 元素，这个 <code>input</code> 元
素很重要，因为是非 GET 表单没有该元素就不能成功提交。隐藏型 <code>input</code> 元素的名字为
 <code>authenticity_token</code> 的属性是 Rails 中叫做 <strong>跨站点请求伪造保护（cross-site request forgery protection）</strong>
 的一个安全功能，对于每一个非 GET 表单（由安全功能启用提供）表单辅助方法都
 会生成它。更多信息查阅 <a href="security.html#cross-site-request-forgery-csrf">Rails 应用程序安全防护</a>指南。</p><h4 id="通用搜索表单"><a class="anchorlink" href="#%E9%80%9A%E7%94%A8%E6%90%9C%E7%B4%A2%E8%A1%A8%E5%8D%95" data-turbolinks="false">1.1 通用搜索表单</a></h4><p>网络上最常见的表单就是搜索表单。这种表单通常包含：</p>
<ul>
<li>使用“GET”方法的表单，</li>
<li>一个输入框的标签，</li>
<li>一个输入文本输入框元素，和</li>
<li>一个提交元所。</li>
</ul>
<p>创建这样的表单您需要使用 <code>form_with</code> 和它生成的表单构造器对象。像这样：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">url: </span><span class="s2">"/search"</span><span class="p">,</span> <span class="ss">method: :get</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:query</span><span class="p">,</span> <span class="s2">"Search for:"</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:query</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="s2">"Search"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;%= form_with url: "/search", method: :get do |form| %&gt;
  &lt;%= form.label :query, "Search for:" %&gt;
  &lt;%= form.text_field :query %&gt;
  &lt;%= form.submit "Search" %&gt;
&lt;% end %&gt;
'>复制</button>
</div>
<p>这将生成下面的 HTML：</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/search"</span> <span class="na">method=</span><span class="s">"get"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"query"</span><span class="nt">&gt;</span>Search for:<span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"query"</span> <span class="na">name=</span><span class="s">"query"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"commit"</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Search"</span> <span class="na">data-disable-with=</span><span class="s">"Search"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;form action="/search" method="get" accept-charset="UTF-8" &gt;
  &lt;label for="query"&gt;Search for:&lt;/label&gt;
  &lt;input id="query" name="query" type="text" /&gt;
  &lt;input name="commit" type="submit" value="Search" data-disable-with="Search" /&gt;
&lt;/form&gt;
'>复制</button>
</div>
<div class="info"><p>传递 <code>url: my_specified_path</code> 给 <code>form_with</code> 告诉表单哪里处理请求。然而，
像后面我们还要涉及到的，您也可以传递 ActiveRecord 对象给表单。</p></div><div class="info"><p>对于每个表单输入，ID 属性由它的名字（上面示例中的<code>"query"</code>）生成。这些
 ID 对于 CSS 的样式化或者利用 JavaScript 对表单急性控制非常有用。</p></div><div class="warning"><p>搜索表单要使用 “GET”方法。这允许用户为特定搜索添加书签并返回。
一般情况下，Rails 鼓励您使用正确的 HTTP 动词来执行操作。</p></div><h4 id="生成表单元素的辅助方法"><a class="anchorlink" href="#%E7%94%9F%E6%88%90%E8%A1%A8%E5%8D%95%E5%85%83%E7%B4%A0%E7%9A%84%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95" data-turbolinks="false">1.2 生成表单元素的辅助方法</a></h4><p>表单构造器由 <code>form_with</code> 生成，它会提供各种辅助方法来生成表单元素，例如文本
框、选择框和单选按钮等。这些方法的第一个参数是输入框的名字。当表单提交时名字
会随表单数据一起传递，并将用户输入的值以 <code>params</code> 的方式传递给控制器。例如：
如果表单包含 <code>&lt;%= form.text_field :query %&gt;</code>，那么您会在控制器中使用 <code>params[:query]</code>
 获得该输入的值。</p><p>命名输入时，Rails 使用某些约定可以提交具有非标量值的参数，例如数组或哈希值，
这些参数也可以在 params 中访问。您可以在本指南的<a href="#%E7%90%86%E8%A7%A3%E5%8F%82%E6%95%B0%E5%91%BD%E5%90%8D%E7%BA%A6%E5%AE%9A">理解参数命名约定</a>
中了解有关它们的更多信息。有关这些帮助程序的精确用法的详细信息，请参阅 <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormTagHelper.html">API 文档</a>。</p><h5 id="多选框"><a class="anchorlink" href="#%E5%A4%9A%E9%80%89%E6%A1%86" data-turbolinks="false">1.2.1 多选框</a></h5><p>多选框（Checkboxe）给用户提供一组可以选择或不选择的表单控件：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">check_box</span> <span class="ss">:pet_dog</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:pet_dog</span><span class="p">,</span> <span class="s2">"I own a dog"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">check_box</span> <span class="ss">:pet_cat</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:pet_cat</span><span class="p">,</span> <span class="s2">"I own a cat"</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;%= form.check_box :pet_dog %&gt;
&lt;%= form.label :pet_dog, "I own a dog" %&gt;
&lt;%= form.check_box :pet_cat %&gt;
&lt;%= form.label :pet_cat, "I own a cat" %&gt;
'>复制</button>
</div>
<p>这将生成：</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">id=</span><span class="s">"pet_dog"</span> <span class="na">name=</span><span class="s">"pet_dog"</span> <span class="na">value=</span><span class="s">"1"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"pet_dog"</span><span class="nt">&gt;</span>I own a dog<span class="nt">&lt;/label&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">id=</span><span class="s">"pet_cat"</span> <span class="na">name=</span><span class="s">"pet_cat"</span> <span class="na">value=</span><span class="s">"1"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"pet_cat"</span><span class="nt">&gt;</span>I own a cat<span class="nt">&lt;/label&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;input type="checkbox" id="pet_dog" name="pet_dog" value="1" /&gt;
&lt;label for="pet_dog"&gt;I own a dog&lt;/label&gt;
&lt;input type="checkbox" id="pet_cat" name="pet_cat" value="1" /&gt;
&lt;label for="pet_cat"&gt;I own a cat&lt;/label&gt;
'>复制</button>
</div>
<p><a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-check_box"><code>check_box</code></a> 
的第一个参数时输入的名字，第二个参数时输入的值，这个值当复选框被选择的时候
会包含到表单数据（出现在 <code>params</code> 中）。</p><h5 id="单选按钮"><a class="anchorlink" href="#%E5%8D%95%E9%80%89%E6%8C%89%E9%92%AE" data-turbolinks="false">1.2.2 单选按钮</a></h5><p>单选按虽然类似多选框提供一组选项，但是其选项时互斥的（也就是用户只能从一组
选项中选择一个选项）：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">radio_button</span> <span class="ss">:age</span><span class="p">,</span> <span class="s2">"child"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:age_child</span><span class="p">,</span> <span class="s2">"I am younger than 21"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">radio_button</span> <span class="ss">:age</span><span class="p">,</span> <span class="s2">"adult"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:age_adult</span><span class="p">,</span> <span class="s2">"I am over 21"</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;%= form.radio_button :age, "child" %&gt;
&lt;%= form.label :age_child, "I am younger than 21" %&gt;
&lt;%= form.radio_button :age, "adult" %&gt;
&lt;%= form.label :age_adult, "I am over 21" %&gt;
'>复制</button>
</div>
<p>输出：</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">id=</span><span class="s">"age_child"</span> <span class="na">name=</span><span class="s">"age"</span> <span class="na">value=</span><span class="s">"child"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"age_child"</span><span class="nt">&gt;</span>I am younger than 21<span class="nt">&lt;/label&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">id=</span><span class="s">"age_adult"</span> <span class="na">name=</span><span class="s">"age"</span> <span class="na">value=</span><span class="s">"adult"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"age_adult"</span><span class="nt">&gt;</span>I am over 21<span class="nt">&lt;/label&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;input type="radio" id="age_child" name="age" value="child" /&gt;
&lt;label for="age_child"&gt;I am younger than 21&lt;/label&gt;
&lt;input type="radio" id="age_adult" name="age" value="adult" /&gt;
&lt;label for="age_adult"&gt;I am over 21&lt;/label&gt;
'>复制</button>
</div>
<p>类似于 <code>check_box</code>，<a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-radio_button"><code>radio_button</code></a> 的
第二个参数时输入的值。因为两个单选按钮共享一个名字（<code>age</code>），用户只能选择其
中一个，<code>params[:age]</code> 的值也只能是 <code>"child"</code> 或者 <code>"adult"</code>。</p><div class="note"><p>多选框和单选按钮总是要使用标签（Label），其关联文本是选项，同时可以扩
展点击区域，使该选项更容易点击到。</p></div><h4 id="其他感兴趣的辅助方法"><a class="anchorlink" href="#%E5%85%B6%E4%BB%96%E6%84%9F%E5%85%B4%E8%B6%A3%E7%9A%84%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95" data-turbolinks="false">1.3 其他感兴趣的辅助方法</a></h4><p>其他值得注意的表单控件有文本区（textarea）、隐藏输入框（hidden fields）、密码
输入框（password field）、数字输入框（number field）、日期和时间输入框（date 
和 time field）等：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:message</span><span class="p">,</span> <span class="ss">size: </span><span class="s2">"70x5"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">hidden_field</span> <span class="ss">:parent_id</span><span class="p">,</span> <span class="ss">value: </span><span class="s2">"foo"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">password_field</span> <span class="ss">:password</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">number_field</span> <span class="ss">:price</span><span class="p">,</span> <span class="ss">in: </span><span class="mf">1.0</span><span class="o">..</span><span class="mf">20.0</span><span class="p">,</span> <span class="ss">step: </span><span class="mf">0.5</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">range_field</span> <span class="ss">:discount</span><span class="p">,</span> <span class="ss">in: </span><span class="mi">1</span><span class="o">..</span><span class="mi">100</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">date_field</span> <span class="ss">:born_on</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">time_field</span> <span class="ss">:started_at</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">datetime_local_field</span> <span class="ss">:graduation_day</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">month_field</span> <span class="ss">:birthday_month</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">week_field</span> <span class="ss">:birthday_week</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">search_field</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">email_field</span> <span class="ss">:address</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">telephone_field</span> <span class="ss">:phone</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">url_field</span> <span class="ss">:homepage</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">color_field</span> <span class="ss">:favorite_color</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;%= form.text_area :message, size: "70x5" %&gt;
&lt;%= form.hidden_field :parent_id, value: "foo" %&gt;
&lt;%= form.password_field :password %&gt;
&lt;%= form.number_field :price, in: 1.0..20.0, step: 0.5 %&gt;
&lt;%= form.range_field :discount, in: 1..100 %&gt;
&lt;%= form.date_field :born_on %&gt;
&lt;%= form.time_field :started_at %&gt;
&lt;%= form.datetime_local_field :graduation_day %&gt;
&lt;%= form.month_field :birthday_month %&gt;
&lt;%= form.week_field :birthday_week %&gt;
&lt;%= form.search_field :name %&gt;
&lt;%= form.email_field :address %&gt;
&lt;%= form.telephone_field :phone %&gt;
&lt;%= form.url_field :homepage %&gt;
&lt;%= form.color_field :favorite_color %&gt;
'>复制</button>
</div>
<p>输出：</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;textarea</span> <span class="na">name=</span><span class="s">"message"</span> <span class="na">id=</span><span class="s">"message"</span> <span class="na">cols=</span><span class="s">"70"</span> <span class="na">rows=</span><span class="s">"5"</span><span class="nt">&gt;&lt;/textarea&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"parent_id"</span> <span class="na">id=</span><span class="s">"parent_id"</span> <span class="na">value=</span><span class="s">"foo"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">id=</span><span class="s">"password"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"number"</span> <span class="na">name=</span><span class="s">"price"</span> <span class="na">id=</span><span class="s">"price"</span> <span class="na">step=</span><span class="s">"0.5"</span> <span class="na">min=</span><span class="s">"1.0"</span> <span class="na">max=</span><span class="s">"20.0"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"range"</span> <span class="na">name=</span><span class="s">"discount"</span> <span class="na">id=</span><span class="s">"discount"</span> <span class="na">min=</span><span class="s">"1"</span> <span class="na">max=</span><span class="s">"100"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"date"</span> <span class="na">name=</span><span class="s">"born_on"</span> <span class="na">id=</span><span class="s">"born_on"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"time"</span> <span class="na">name=</span><span class="s">"started_at"</span> <span class="na">id=</span><span class="s">"started_at"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"datetime-local"</span> <span class="na">name=</span><span class="s">"graduation_day"</span> <span class="na">id=</span><span class="s">"graduation_day"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"month"</span> <span class="na">name=</span><span class="s">"birthday_month"</span> <span class="na">id=</span><span class="s">"birthday_month"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"week"</span> <span class="na">name=</span><span class="s">"birthday_week"</span> <span class="na">id=</span><span class="s">"birthday_week"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"search"</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">id=</span><span class="s">"name"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"email"</span> <span class="na">name=</span><span class="s">"address"</span> <span class="na">id=</span><span class="s">"address"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"tel"</span> <span class="na">name=</span><span class="s">"phone"</span> <span class="na">id=</span><span class="s">"phone"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"url"</span> <span class="na">name=</span><span class="s">"homepage"</span> <span class="na">id=</span><span class="s">"homepage"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"color"</span> <span class="na">name=</span><span class="s">"favorite_color"</span> <span class="na">id=</span><span class="s">"favorite_color"</span> <span class="na">value=</span><span class="s">"#000000"</span> <span class="nt">/&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;textarea name="message" id="message" cols="70" rows="5"&gt;&lt;/textarea&gt;
&lt;input type="hidden" name="parent_id" id="parent_id" value="foo" /&gt;
&lt;input type="password" name="password" id="password" /&gt;
&lt;input type="number" name="price" id="price" step="0.5" min="1.0" max="20.0" /&gt;
&lt;input type="range" name="discount" id="discount" min="1" max="100" /&gt;
&lt;input type="date" name="born_on" id="born_on" /&gt;
&lt;input type="time" name="started_at" id="started_at" /&gt;
&lt;input type="datetime-local" name="graduation_day" id="graduation_day" /&gt;
&lt;input type="month" name="birthday_month" id="birthday_month" /&gt;
&lt;input type="week" name="birthday_week" id="birthday_week" /&gt;
&lt;input type="search" name="name" id="name" /&gt;
&lt;input type="email" name="address" id="address" /&gt;
&lt;input type="tel" name="phone" id="phone" /&gt;
&lt;input type="url" name="homepage" id="homepage" /&gt;
&lt;input type="color" name="favorite_color" id="favorite_color" value="#000000" /&gt;
'>复制</button>
</div>
<p>隐藏输入框用户是看不到的，但是也会像其他文本字段一样会绑定数据。字段值可以
使用 JavaScript 修改。</p><div class="warning"><p>搜索、电话、日期、时间、颜色、日期时间、本地日期时间、月、星期、
URL 地址、电子邮件、数字和使用 HTML5 控制的范围输入。如果您需要应用程序在旧
浏览器中有一个持续的体验，您需要一个 HTML5 构建器（由 CSS 和/或 JavaScript 
提供)。绝对<a href="https://github.com/Modernizr/Modernizr/wiki/HTML5-Cross-Browser-Polyfills">不缺解决方案</a>，
目前最流行的工具是 <a href="https://modernizr.com/">Modernizr</a>，它提供了一种基于 
HTML5 功能检测添加功能的简单方法。</p></div><div class="info"><p>如果您使用了密码输入框（可能基于某些原因），您应当配置应用程序不要在日
志中记录这些参数。更多相关信息参阅 <a href="security.html#logging">Rails 应用程序安全防护</a>指南。</p></div><h3 id="处理模型对象"><a class="anchorlink" href="#%E5%A4%84%E7%90%86%E6%A8%A1%E5%9E%8B%E5%AF%B9%E8%B1%A1" data-turbolinks="false">2 处理模型对象</a></h3><h4 id="绑定对象到表单"><a class="anchorlink" href="#%E7%BB%91%E5%AE%9A%E5%AF%B9%E8%B1%A1%E5%88%B0%E8%A1%A8%E5%8D%95" data-turbolinks="false">2.1 绑定对象到表单</a></h4><p><code>form_with</code> 的 <code>:model</code> 参数允许我们绑定表单构建器到模型对象。这意味着表
单将被限定为该模型对象，并且表单的字段将使用来自该模型对象的值填充。</p><p>例如：如果我们有 <code>@article</code> 模型对象：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;Article id: 42, title: "My Title", body: "My Body"&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='@article = Article.find(42)
# =&gt; #&lt;Article id: 42, title: "My Title", body: "My Body"&gt;
'>复制</button>
</div>
<p>表单：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@article</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">size: </span><span class="s2">"60x10"</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;%= form_with model: @article do |form| %&gt;
  &lt;%= form.text_field :title %&gt;
  &lt;%= form.text_area :body, size: "60x10" %&gt;
  &lt;%= form.submit %&gt;
&lt;% end %&gt;
'>复制</button>
</div>
<p>输出：</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/articles/42"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"authenticity_token"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"..."</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"article[title]"</span> <span class="na">id=</span><span class="s">"article_title"</span> <span class="na">value=</span><span class="s">"My Title"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;textarea</span> <span class="na">name=</span><span class="s">"article[body]"</span> <span class="na">id=</span><span class="s">"article_body"</span> <span class="na">cols=</span><span class="s">"60"</span> <span class="na">rows=</span><span class="s">"10"</span><span class="nt">&gt;</span>
    My Body
  <span class="nt">&lt;/textarea&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">name=</span><span class="s">"commit"</span> <span class="na">value=</span><span class="s">"Update Article"</span> <span class="na">data-disable-with=</span><span class="s">"Update Article"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;form action="/articles/42" method="post" accept-charset="UTF-8" &gt;
  &lt;input name="authenticity_token" type="hidden" value="..." /&gt;
  &lt;input type="text" name="article[title]" id="article_title" value="My Title" /&gt;
  &lt;textarea name="article[body]" id="article_body" cols="60" rows="10"&gt;
    My Body
  &lt;/textarea&gt;
  &lt;input type="submit" name="commit" value="Update Article" data-disable-with="Update Article"&gt;
&lt;/form&gt;
'>复制</button>
</div>
<p>这里有一些事情需要注意：</p>
<ul>
<li>表单 <code>action</code> 的值是由相关的 <code>@article</code> 的值自动填充的。</li>
<li>表单字段的值是由 <code>@article</code> 的对应值自动填充的。</li>
<li>表单字段名字由 <code>article[...]</code> 限定。<code>params[:article]</code> 的意思就是包含所有字
段值的哈希。关于更多输入字段意义的信息查阅本指南的<a href="#%E7%90%86%E8%A7%A3%E5%8F%82%E6%95%B0%E5%91%BD%E5%90%8D%E7%BA%A6%E5%AE%9A">理解参数命名约定</a>部分。</li>
<li>提交按钮由给定的相关文本值自动生成。</li>
</ul>
<div class="info"><p>通常，您的输入将反映模型属性。但是，这并非必须！如果您需要其他信息，您
可以将其包含在表单中，就像使用属性一样，并通过 <code>params[:article][:my_nifty_non_attribute_input]</code> 
调用并使用它。</p></div><h5 id="fields-for-辅助方法"><a class="anchorlink" href="#fields-for-%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95" data-turbolinks="false">2.1.1 <code>fields_for</code> 辅助方法</a></h5><p><a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-fields_for"><code>fields_for</code></a> 辅助方法可以实现一个的类似绑定输入但不用 <code>&lt;form&gt;</code> 标签。该方
法常用于在同一表单内添加其他模型对象的渲染字段。例如：如果您有一个 <code>Person</code> 
模型关联另一个 <code>ContactDetail</code> 模型，您就可以创建一个表单同时绑定两个模型：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@person</span> <span class="k">do</span> <span class="o">|</span><span class="n">person_form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">person_form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">fields_for</span> <span class="ss">:contact_detail</span><span class="p">,</span> <span class="vi">@person</span><span class="p">.</span><span class="nf">contact_detail</span> <span class="k">do</span> <span class="o">|</span><span class="n">contact_detail_form</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">contact_detail_form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:phone_number</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: @person do |person_form| %&gt;
  &lt;%= person_form.text_field :name %&gt;
  &lt;%= fields_for :contact_detail, @person.contact_detail do |contact_detail_form| %&gt;
    &lt;%= contact_detail_form.text_field :phone_number %&gt;
  &lt;% end %&gt;
&lt;% end %&gt;
">复制</button>
</div>
<p>生成下面的输出：</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/people"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"authenticity_token"</span> <span class="na">value=</span><span class="s">"bL13x72pldyDD8bgtkjKQakJCpd4A8JdXGbfksxBDHdf1uC0kCMqe2tvVdUYfidJt0fj3ihC4NxiVHv8GVYxJA=="</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"person[name]"</span> <span class="na">id=</span><span class="s">"person_name"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"contact_detail[phone_number]"</span> <span class="na">id=</span><span class="s">"contact_detail_phone_number"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;form action="/people" accept-charset="UTF-8" method="post"&gt;
  &lt;input type="hidden" name="authenticity_token" value="bL13x72pldyDD8bgtkjKQakJCpd4A8JdXGbfksxBDHdf1uC0kCMqe2tvVdUYfidJt0fj3ihC4NxiVHv8GVYxJA==" /&gt;
  &lt;input type="text" name="person[name]" id="person_name" /&gt;
  &lt;input type="text" name="contact_detail[phone_number]" id="contact_detail_phone_number" /&gt;
&lt;/form&gt;
'>复制</button>
</div>
<p>由 <code>fields_for</code> 生成的对象表单构造器同 <code>form_with</code> 的类似。</p><h4 id="relying-on-record-identification"><a class="anchorlink" href="#relying-on-record-identification" data-turbolinks="false">2.2 Relying on Record Identification</a></h4><p>模型 Article 对应用程序用户而言可直接使用，所以，按照 Rails 开发最佳实践——
您应当将其声明为<strong>一个资源</strong>：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:articles</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :articles
">复制</button>
</div>
<div class="info"><p>声明一个资源有很多副作用。更多关于设置和使用资源的信息查阅 <a href="routing.html#resource-routing-the-rails-default">Rails 路由全解</a>。</p></div><p>当处理 REST 式资源时，如果您依赖<strong>记录标识</strong>调用 <code>form_with</code> 会变得容易。简而
言之，您可以只传递模型实例并让 Rails 找出模型名称和其余部分。在这两个示例中，
长短两种形式结果相同：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1">## 创建新 article</span>
<span class="c1"># 长的形式：</span>
<span class="n">form_with</span><span class="p">(</span><span class="ss">model: </span><span class="vi">@article</span><span class="p">,</span> <span class="ss">url: </span><span class="n">articles_path</span><span class="p">)</span>
<span class="c1"># 短的形式：</span>
<span class="n">form_with</span><span class="p">(</span><span class="ss">model: </span><span class="vi">@article</span><span class="p">)</span>

<span class="c1">## 编辑一个已经存在的 article</span>
<span class="c1"># 长的形式：</span>
<span class="n">form_with</span><span class="p">(</span><span class="ss">model: </span><span class="vi">@article</span><span class="p">,</span> <span class="ss">url: </span><span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">),</span> <span class="ss">method: </span><span class="s2">"patch"</span><span class="p">)</span>
<span class="c1"># 短的形式：</span>
<span class="n">form_with</span><span class="p">(</span><span class="ss">model: </span><span class="vi">@article</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='## 创建新 article
# 长的形式：
form_with(model: @article, url: articles_path)
# 短的形式：
form_with(model: @article)

## 编辑一个已经存在的 article
# 长的形式：
form_with(model: @article, url: article_path(@article), method: "patch")
# 短的形式：
form_with(model: @article)
'>复制</button>
</div>
<p>我们看到无论是新记录还是已经存在的记录，短形式的 <code>form_with</code> 调用方式都是相
通的。记录识别系统很聪明，通过询问 <code>record.persisted?</code> 可以知道是否是新记录。
也能够选择正确的提交路径和基于对象的类的名字。</p><p>如果您有一个<a href="routing.html#%E5%8D%95%E6%95%B0%E8%B5%84%E6%BA%90">单数资源</a>，您需要调用 <code>resource</code>
 和 <code>resolve</code> 来同 <code>form_with</code> 共同工作：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resource</span> <span class="ss">:geocoder</span>
<span class="n">resolve</span><span class="p">(</span><span class="s1">'Geocoder'</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="ss">:geocoder</span><span class="p">]</span> <span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resource :geocoder
resolve('Geocoder') { [:geocoder] }
">复制</button>
</div>
<div class="warning"><p>当您的模型使用 STI（(single-table inheritance，单表继承）的时候，如果
只有父类声明为资源，您不能在子类上依赖记录识别，您需要准确的定义 <code>:url</code> 和 
<code>:scope</code> (模型名)。</p></div><h5 id="处理带命名空间的模型"><a class="anchorlink" href="#%E5%A4%84%E7%90%86%E5%B8%A6%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E7%9A%84%E6%A8%A1%E5%9E%8B" data-turbolinks="false">2.2.1 处理带命名空间的模型</a></h5><p>如果您已经创建了命名空间路由，<code>form_with</code> 有一个漂亮的短形式。假如您的应用程
序使用的是 admin 命名空间，那么</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">form_with</span> <span class="ss">model: </span><span class="p">[</span><span class="ss">:admin</span><span class="p">,</span> <span class="vi">@article</span><span class="p">]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="form_with model: [:admin, @article]
">复制</button>
</div>
<p>将会创建一个提交到 admin 命名空间内 <code>ArticlesController</code> 的表单（提交到 
<code>admin_article_path(@article)</code> 的更新动作）。如果您有多个级别的命名空间，语法
类似：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">form_with</span> <span class="ss">model: </span><span class="p">[</span><span class="ss">:admin</span><span class="p">,</span> <span class="ss">:management</span><span class="p">,</span> <span class="vi">@article</span><span class="p">]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="form_with model: [:admin, :management, @article]
">复制</button>
</div>
<p>有关 Rails 路由系统和相关约定的更多信息查阅 <a href="routing.html">Rails 路由全解</a>指南。</p><h4 id="使用-patch、put-或-delete-方法的表单如何工作？"><a class="anchorlink" href="#%E4%BD%BF%E7%94%A8-patch%E3%80%81put-%E6%88%96-delete-%E6%96%B9%E6%B3%95%E7%9A%84%E8%A1%A8%E5%8D%95%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%EF%BC%9F" data-turbolinks="false">2.3 使用 PATCH、PUT 或 DELETE 方法的表单如何工作？</a></h4><p>Rails 框架鼓励应用程序使用 REST 式设计，这就是说您会面对 “PATCH”、“PUT”
和“DELETE”请求（除了“GET”和“POST”外）。然而大多数浏览器在提交表单的时
候<strong>不支持</strong>“GET”和“POST”之外的方法。</p><p>Rails 通过使用名为 <code>"_method"</code> 的隐藏 input 字段在 POST 上模拟其他方法来解决
此问题——就是这样设置为期望的方法：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">form_with</span><span class="p">(</span><span class="ss">url: </span><span class="n">search_path</span><span class="p">,</span> <span class="ss">method: </span><span class="s2">"patch"</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='form_with(url: search_path, method: "patch")
'>复制</button>
</div>
<p>输出：</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">action=</span><span class="s">"/search"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"_method"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"patch"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"authenticity_token"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"f755bb0ed134b76c432144748a6d4b7a7ddf2b71"</span> <span class="nt">/&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;form accept-charset="UTF-8" action="/search" method="post"&gt;
  &lt;input name="_method" type="hidden" value="patch" /&gt;
  &lt;input name="authenticity_token" type="hidden" value="f755bb0ed134b76c432144748a6d4b7a7ddf2b71" /&gt;
  &lt;!-- ... --&gt;
&lt;/form&gt;
'>复制</button>
</div>
<p>当解析 POST 发送的数据时，Rails 会考虑设定的 <code>_method</code> 参数并将其 HTTP 方法作
为指定方法（本示例中为“PATCH”）。</p><p>当渲染表单时，提交按钮可以通过通过关键字 <code>formmethod:</code> 覆盖掉已经声明的 <code>method</code>：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">url: </span><span class="s2">"/posts/1"</span><span class="p">,</span> <span class="ss">method: :patch</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">button</span> <span class="s2">"Delete"</span><span class="p">,</span> <span class="ss">formmethod: :delete</span><span class="p">,</span> <span class="ss">data: </span><span class="p">{</span> <span class="ss">confirm: </span><span class="s2">"Are you sure?"</span> <span class="p">}</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">button</span> <span class="s2">"Update"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;%= form_with url: "/posts/1", method: :patch do |form| %&gt;
  &lt;%= form.button "Delete", formmethod: :delete, data: { confirm: "Are you sure?" } %&gt;
  &lt;%= form.button "Update" %&gt;
&lt;% end %&gt;
'>复制</button>
</div>
<p>类似于 <code>&lt;form&gt;</code> 元素，大多数浏览器<strong>不支持</strong> “GET” 和 “POST” 之外的表单方法通过
 <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#attr-formmethod">formmethod</a> 声明覆盖 。</p><p>Rails 通过结合 <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#attr-formmethod">formmethod</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#attr-value">value</a> 和 <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#attr-name">name</a> 属性在
POST 上模拟其他方法解决这个问题：</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">action=</span><span class="s">"/posts/1"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"_method"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"patch"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"authenticity_token"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"f755bb0ed134b76c432144748a6d4b7a7ddf2b71"</span> <span class="nt">/&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>

  <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">formmethod=</span><span class="s">"post"</span> <span class="na">name=</span><span class="s">"_method"</span> <span class="na">value=</span><span class="s">"delete"</span> <span class="na">data-confirm=</span><span class="s">"Are you sure?"</span><span class="nt">&gt;</span>Delete<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">name=</span><span class="s">"button"</span><span class="nt">&gt;</span>Update<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;form accept-charset="UTF-8" action="/posts/1" method="post"&gt;
  &lt;input name="_method" type="hidden" value="patch" /&gt;
  &lt;input name="authenticity_token" type="hidden" value="f755bb0ed134b76c432144748a6d4b7a7ddf2b71" /&gt;
  &lt;!-- ... --&gt;

  &lt;button type="submit" formmethod="post" name="_method" value="delete" data-confirm="Are you sure?"&gt;Delete&lt;/button&gt;
  &lt;button type="submit" name="button"&gt;Update&lt;/button&gt;
&lt;/form&gt;
'>复制</button>
</div>
<div class="warning"><p>在 Rails 6.0 和 5.2 中，所有表单默认使用 <code>form_with</code> 的扩展 <code>remote: true</code> 
方法。这些表单通过 XHR（Ajax） 请求提交数据。想要关闭此功能需要包含 <code>local: true</code> 参数。
更多信息查阅 <a href="working_with_javascript_in_rails.html#remote-elements">在 Rails 中与 JavaScript 共舞</a> 指南。</p></div><h3 id="轻松制作选择框"><a class="anchorlink" href="#%E8%BD%BB%E6%9D%BE%E5%88%B6%E4%BD%9C%E9%80%89%E6%8B%A9%E6%A1%86" data-turbolinks="false">3 轻松制作选择框</a></h3><p>HTML 中的选择框需要大量标记——每个选项都是一个 <code>&lt;option&gt;</code> 元素可供选择。  所以 Rails 提
供了辅助方法来减轻这个负担。</p><p>例如：假设我们有一个用于给用户选择自己所在城市的选择框。我们可以这样使用 <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-select"><code>select</code></a> 辅助方法：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">select</span> <span class="ss">:city</span><span class="p">,</span> <span class="p">[</span><span class="s2">"Berlin"</span><span class="p">,</span> <span class="s2">"Chicago"</span><span class="p">,</span> <span class="s2">"Madrid"</span><span class="p">]</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;%= form.select :city, ["Berlin", "Chicago", "Madrid"] %&gt;
'>复制</button>
</div>
<p>输出：</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"city"</span> <span class="na">id=</span><span class="s">"city"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"Berlin"</span><span class="nt">&gt;</span>Berlin<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"Chicago"</span><span class="nt">&gt;</span>Chicago<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"Madrid"</span><span class="nt">&gt;</span>Madrid<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;select name="city" id="city"&gt;
  &lt;option value="Berlin"&gt;Berlin&lt;/option&gt;
  &lt;option value="Chicago"&gt;Chicago&lt;/option&gt;
  &lt;option value="Madrid"&gt;Madrid&lt;/option&gt;
&lt;/select&gt;
'>复制</button>
</div>
<p>我们还可以设计不同于标签的 <code>&lt;option&gt;</code> 值：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">select</span> <span class="ss">:city</span><span class="p">,</span> <span class="p">[[</span><span class="s2">"Berlin"</span><span class="p">,</span> <span class="s2">"BE"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"Chicago"</span><span class="p">,</span> <span class="s2">"CHI"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"Madrid"</span><span class="p">,</span> <span class="s2">"MD"</span><span class="p">]]</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;%= form.select :city, [["Berlin", "BE"], ["Chicago", "CHI"], ["Madrid", "MD"]] %&gt;
'>复制</button>
</div>
<p>输出：</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"city"</span> <span class="na">id=</span><span class="s">"city"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"BE"</span><span class="nt">&gt;</span>Berlin<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"CHI"</span><span class="nt">&gt;</span>Chicago<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"MD"</span><span class="nt">&gt;</span>Madrid<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;select name="city" id="city"&gt;
  &lt;option value="BE"&gt;Berlin&lt;/option&gt;
  &lt;option value="CHI"&gt;Chicago&lt;/option&gt;
  &lt;option value="MD"&gt;Madrid&lt;/option&gt;
&lt;/select&gt;
'>复制</button>
</div>
<p>这次用户选择城市全名，但是 <code>params[:city]</code> 的值是 <code>“BE”</code>、<code>“CHI”</code> 和 <code>“MD”</code> 之一。</p><p>最后，我们用 <code>:selected</code> 参数为选择框指定一个默认选项：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">select</span> <span class="ss">:city</span><span class="p">,</span> <span class="p">[[</span><span class="s2">"Berlin"</span><span class="p">,</span> <span class="s2">"BE"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"Chicago"</span><span class="p">,</span> <span class="s2">"CHI"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"Madrid"</span><span class="p">,</span> <span class="s2">"MD"</span><span class="p">]],</span> <span class="ss">selected: </span><span class="s2">"CHI"</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;%= form.select :city, [["Berlin", "BE"], ["Chicago", "CHI"], ["Madrid", "MD"]], selected: "CHI" %&gt;
'>复制</button>
</div>
<p>输出：</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"city"</span> <span class="na">id=</span><span class="s">"city"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"BE"</span><span class="nt">&gt;</span>Berlin<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"CHI"</span> <span class="na">selected=</span><span class="s">"selected"</span><span class="nt">&gt;</span>Chicago<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"MD"</span><span class="nt">&gt;</span>Madrid<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;select name="city" id="city"&gt;
  &lt;option value="BE"&gt;Berlin&lt;/option&gt;
  &lt;option value="CHI" selected="selected"&gt;Chicago&lt;/option&gt;
  &lt;option value="MD"&gt;Madrid&lt;/option&gt;
&lt;/select&gt;
'>复制</button>
</div>
<h4 id="群组选项"><a class="anchorlink" href="#%E7%BE%A4%E7%BB%84%E9%80%89%E9%A1%B9" data-turbolinks="false">3.1 群组选项</a></h4><p>有时我们想要将相关选项通过分组来提升用户体验。我们可以通过传递一个 <code>Hash</code> （或者类似 <code>Array</code>）给 <code>select</code> 做到：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">select</span> <span class="ss">:city</span><span class="p">,</span>
      <span class="p">{</span>
        <span class="s2">"Europe"</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="p">[</span><span class="s2">"Berlin"</span><span class="p">,</span> <span class="s2">"BE"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"Madrid"</span><span class="p">,</span> <span class="s2">"MD"</span><span class="p">]</span> <span class="p">],</span>
        <span class="s2">"North America"</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="p">[</span><span class="s2">"Chicago"</span><span class="p">,</span> <span class="s2">"CHI"</span><span class="p">]</span> <span class="p">],</span>
      <span class="p">},</span>
      <span class="ss">selected: </span><span class="s2">"CHI"</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;%= form.select :city,
      {
        "Europe" =&gt; [ ["Berlin", "BE"], ["Madrid", "MD"] ],
        "North America" =&gt; [ ["Chicago", "CHI"] ],
      },
      selected: "CHI" %&gt;
'>复制</button>
</div>
<p>输出：</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"city"</span> <span class="na">id=</span><span class="s">"city"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;optgroup</span> <span class="na">label=</span><span class="s">"Europe"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"BE"</span><span class="nt">&gt;</span>Berlin<span class="nt">&lt;/option&gt;</span>
    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"MD"</span><span class="nt">&gt;</span>Madrid<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;/optgroup&gt;</span>
  <span class="nt">&lt;optgroup</span> <span class="na">label=</span><span class="s">"North America"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"CHI"</span> <span class="na">selected=</span><span class="s">"selected"</span><span class="nt">&gt;</span>Chicago<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;/optgroup&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;select name="city" id="city"&gt;
  &lt;optgroup label="Europe"&gt;
    &lt;option value="BE"&gt;Berlin&lt;/option&gt;
    &lt;option value="MD"&gt;Madrid&lt;/option&gt;
  &lt;/optgroup&gt;
  &lt;optgroup label="North America"&gt;
    &lt;option value="CHI" selected="selected"&gt;Chicago&lt;/option&gt;
  &lt;/optgroup&gt;
&lt;/select&gt;
'>复制</button>
</div>
<h4 id="选择框和模型对象"><a class="anchorlink" href="#%E9%80%89%E6%8B%A9%E6%A1%86%E5%92%8C%E6%A8%A1%E5%9E%8B%E5%AF%B9%E8%B1%A1" data-turbolinks="false">3.2 选择框和模型对象</a></h4><p>像其他表单控件一样，选择框可以绑定到模型属性。例如：如果我们有一个 <code>@person</code> 模型对象：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="vi">@person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">city: </span><span class="s2">"MD"</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='@person = Person.new(city: "MD")
'>复制</button>
</div>
<p>下面的表单：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@person</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">select</span> <span class="ss">:city</span><span class="p">,</span> <span class="p">[[</span><span class="s2">"Berlin"</span><span class="p">,</span> <span class="s2">"BE"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"Chicago"</span><span class="p">,</span> <span class="s2">"CHI"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"Madrid"</span><span class="p">,</span> <span class="s2">"MD"</span><span class="p">]]</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;%= form_with model: @person do |form| %&gt;
  &lt;%= form.select :city, [["Berlin", "BE"], ["Chicago", "CHI"], ["Madrid", "MD"]] %&gt;
&lt;% end %&gt;
'>复制</button>
</div>
<p>选择框输出这样：</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"person[city]"</span> <span class="na">id=</span><span class="s">"person_city"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"BE"</span><span class="nt">&gt;</span>Berlin<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"CHI"</span><span class="nt">&gt;</span>Chicago<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"MD"</span> <span class="na">selected=</span><span class="s">"selected"</span><span class="nt">&gt;</span>Madrid<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;select name="person[city]" id="person_city"&gt;
  &lt;option value="BE"&gt;Berlin&lt;/option&gt;
  &lt;option value="CHI"&gt;Chicago&lt;/option&gt;
  &lt;option value="MD" selected="selected"&gt;Madrid&lt;/option&gt;
&lt;/select&gt;
'>复制</button>
</div>
<p>注意相关选项自动标记为 <code>selected="selected"</code>。因为这个选择框绑定到了一个模型，所以我们
不需要定一个 <code>:selected</code> 参数，Rails 会自动选择批配值！</p><h4 id="时区（time-zone）和国家选择框"><a class="anchorlink" href="#%E6%97%B6%E5%8C%BA%EF%BC%88time-zone%EF%BC%89%E5%92%8C%E5%9B%BD%E5%AE%B6%E9%80%89%E6%8B%A9%E6%A1%86" data-turbolinks="false">3.3 时区（Time Zone）和国家选择框</a></h4><p>有时您可能询问用户所在的时区，这就要用到 Rails 中的时区支持。这需要从预定义的 <a href="https://edgeapi.rubyonrails.org/classes/ActiveSupport/TimeZone.html"><code>ActiveSupport::TimeZone</code></a>
 对象列表中来生成选择选项，这可能有些复杂，所幸 Rails 已经提供了相关的辅助方法，您只需
 引用 <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-time_zone_select"><code>time_zone_select</code></a> 即可：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">time_zone_select</span> <span class="ss">:time_zone</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= form.time_zone_select :time_zone %&gt;
">复制</button>
</div>
<p>Rails <strong>常用</strong>的还有选择国家的 <code>country_select</code> 辅助方法，但是现在该方法已经成为独立
的 <a href="https://github.com/stefanpenner/country_select">country_select 插件</a>了。</p><h3 id="使用日期和时间表单辅助方法"><a class="anchorlink" href="#%E4%BD%BF%E7%94%A8%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E8%A1%A8%E5%8D%95%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95" data-turbolinks="false">4 使用日期和时间表单辅助方法</a></h3><p>如果您不想使用 HTML5 的日期和时间输入控件，Rails 提供了可渲染为简单选择框的日期和时间
辅助方法替代品。该辅助方法为选择框的每一个时间组成部分都生成一个选择框（例如：年、月、
日等）。例如，如果我们有一个 <code>@person</code> 模型对象：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="vi">@person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">birth_date: </span><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">1995</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">21</span><span class="p">))</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="@person = Person.new(birth_date: Date.new(1995, 12, 21))
">复制</button>
</div>
<p>表单如下：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@person</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">date_select</span> <span class="ss">:birth_date</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: @person do |form| %&gt;
  &lt;%= form.date_select :birth_date %&gt;
&lt;% end %&gt;
">复制</button>
</div>
<p>输出选择框：</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"person[birth_date(1i)]"</span> <span class="na">id=</span><span class="s">"person_birth_date_1i"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1990"</span><span class="nt">&gt;</span>1990<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1991"</span><span class="nt">&gt;</span>1991<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1992"</span><span class="nt">&gt;</span>1992<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1993"</span><span class="nt">&gt;</span>1993<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1994"</span><span class="nt">&gt;</span>1994<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1995"</span> <span class="na">selected=</span><span class="s">"selected"</span><span class="nt">&gt;</span>1995<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1996"</span><span class="nt">&gt;</span>1996<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1997"</span><span class="nt">&gt;</span>1997<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1998"</span><span class="nt">&gt;</span>1998<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1999"</span><span class="nt">&gt;</span>1999<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2000"</span><span class="nt">&gt;</span>2000<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
<span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"person[birth_date(2i)]"</span> <span class="na">id=</span><span class="s">"person_birth_date_2i"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1"</span><span class="nt">&gt;</span>January<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2"</span><span class="nt">&gt;</span>February<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"3"</span><span class="nt">&gt;</span>March<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"4"</span><span class="nt">&gt;</span>April<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"5"</span><span class="nt">&gt;</span>May<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"6"</span><span class="nt">&gt;</span>June<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"7"</span><span class="nt">&gt;</span>July<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"8"</span><span class="nt">&gt;</span>August<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"9"</span><span class="nt">&gt;</span>September<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"10"</span><span class="nt">&gt;</span>October<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"11"</span><span class="nt">&gt;</span>November<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"12"</span> <span class="na">selected=</span><span class="s">"selected"</span><span class="nt">&gt;</span>December<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
<span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"person[birth_date(3i)]"</span> <span class="na">id=</span><span class="s">"person_birth_date_3i"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1"</span><span class="nt">&gt;</span>1<span class="nt">&lt;/option&gt;</span>
  ...
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"21"</span> <span class="na">selected=</span><span class="s">"selected"</span><span class="nt">&gt;</span>21<span class="nt">&lt;/option&gt;</span>
  ...
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"31"</span><span class="nt">&gt;</span>31<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;select name="person[birth_date(1i)]" id="person_birth_date_1i"&gt;
  &lt;option value="1990"&gt;1990&lt;/option&gt;
  &lt;option value="1991"&gt;1991&lt;/option&gt;
  &lt;option value="1992"&gt;1992&lt;/option&gt;
  &lt;option value="1993"&gt;1993&lt;/option&gt;
  &lt;option value="1994"&gt;1994&lt;/option&gt;
  &lt;option value="1995" selected="selected"&gt;1995&lt;/option&gt;
  &lt;option value="1996"&gt;1996&lt;/option&gt;
  &lt;option value="1997"&gt;1997&lt;/option&gt;
  &lt;option value="1998"&gt;1998&lt;/option&gt;
  &lt;option value="1999"&gt;1999&lt;/option&gt;
  &lt;option value="2000"&gt;2000&lt;/option&gt;
&lt;/select&gt;
&lt;select name="person[birth_date(2i)]" id="person_birth_date_2i"&gt;
  &lt;option value="1"&gt;January&lt;/option&gt;
  &lt;option value="2"&gt;February&lt;/option&gt;
  &lt;option value="3"&gt;March&lt;/option&gt;
  &lt;option value="4"&gt;April&lt;/option&gt;
  &lt;option value="5"&gt;May&lt;/option&gt;
  &lt;option value="6"&gt;June&lt;/option&gt;
  &lt;option value="7"&gt;July&lt;/option&gt;
  &lt;option value="8"&gt;August&lt;/option&gt;
  &lt;option value="9"&gt;September&lt;/option&gt;
  &lt;option value="10"&gt;October&lt;/option&gt;
  &lt;option value="11"&gt;November&lt;/option&gt;
  &lt;option value="12" selected="selected"&gt;December&lt;/option&gt;
&lt;/select&gt;
&lt;select name="person[birth_date(3i)]" id="person_birth_date_3i"&gt;
  &lt;option value="1"&gt;1&lt;/option&gt;
  ...
  &lt;option value="21" selected="selected"&gt;21&lt;/option&gt;
  ...
  &lt;option value="31"&gt;31&lt;/option&gt;
&lt;/select&gt;
'>复制</button>
</div>
<p>注意这个表单提交时，<code>params</code> 哈希中传递的标准日期并非由单一值构成。也就是说，里面有多
个形如 <code>"birth_date(1i)"</code> 的特定类型日期组成。Active Record 会根据模型属性的声明重新
组装这些值到需要的类型。所以，我们只需要像处理单一值一样传递 <code>params[:person]</code> 给诸如
 <code>Person.new</code> 或 <code>Person#update</code> 就可以了。</p><p>另外，除了 <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-date_select"><code>date_select</code></a> 辅助方法，Rails 还提供了 <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-time_select"><code>time_select</code></a> 和 <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-datetime_select"><code>datetime_select</code></a> 可以使用。</p><h4 id="单独时间组件选择框"><a class="anchorlink" href="#%E5%8D%95%E7%8B%AC%E6%97%B6%E9%97%B4%E7%BB%84%E4%BB%B6%E9%80%89%E6%8B%A9%E6%A1%86" data-turbolinks="false">4.1 单独时间组件选择框</a></h4><p>Rails 还提供了用于单独时间组件的选择框辅助方法：<a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#method-i-select_year"><code>select_year</code></a>、<a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#method-i-select_month"><code>select_month</code></a>、<a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#method-i-select_day"><code>select_day</code></a>、<a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#method-i-select_hour"><code>select_hour</code></a>、<a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#method-i-select_minute"><code>select_minute</code></a> 和 <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#method-i-select_second"><code>select_second</code></a>。这些辅助
方法都是“单独的”方法，也就是说它们不能调用表单构造器实例。例如：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">select_year</span> <span class="mi">1999</span><span class="p">,</span> <span class="ss">prefix: </span><span class="s2">"party"</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;%= select_year 1999, prefix: "party" %&gt;
'>复制</button>
</div>
<p>输出一个这样的选择框：</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"party[year]"</span> <span class="na">id=</span><span class="s">"party_year"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1994"</span><span class="nt">&gt;</span>1994<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1995"</span><span class="nt">&gt;</span>1995<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1996"</span><span class="nt">&gt;</span>1996<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1997"</span><span class="nt">&gt;</span>1997<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1998"</span><span class="nt">&gt;</span>1998<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1999"</span> <span class="na">selected=</span><span class="s">"selected"</span><span class="nt">&gt;</span>1999<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2000"</span><span class="nt">&gt;</span>2000<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2001"</span><span class="nt">&gt;</span>2001<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2002"</span><span class="nt">&gt;</span>2002<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2003"</span><span class="nt">&gt;</span>2003<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2004"</span><span class="nt">&gt;</span>2004<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;select name="party[year]" id="party_year"&gt;
  &lt;option value="1994"&gt;1994&lt;/option&gt;
  &lt;option value="1995"&gt;1995&lt;/option&gt;
  &lt;option value="1996"&gt;1996&lt;/option&gt;
  &lt;option value="1997"&gt;1997&lt;/option&gt;
  &lt;option value="1998"&gt;1998&lt;/option&gt;
  &lt;option value="1999" selected="selected"&gt;1999&lt;/option&gt;
  &lt;option value="2000"&gt;2000&lt;/option&gt;
  &lt;option value="2001"&gt;2001&lt;/option&gt;
  &lt;option value="2002"&gt;2002&lt;/option&gt;
  &lt;option value="2003"&gt;2003&lt;/option&gt;
  &lt;option value="2004"&gt;2004&lt;/option&gt;
&lt;/select&gt;
'>复制</button>
</div>
<p>这些辅助方法默认值都可以设定，注意那时一个日期或者时间对象而不是数字，然后相关的时间
组件就能够抽取和使用了。</p><h3 id="来自任意集合对象的选择框"><a class="anchorlink" href="#%E6%9D%A5%E8%87%AA%E4%BB%BB%E6%84%8F%E9%9B%86%E5%90%88%E5%AF%B9%E8%B1%A1%E7%9A%84%E9%80%89%E6%8B%A9%E6%A1%86" data-turbolinks="false">5 来自任意集合对象的选择框</a></h3><p>经常我们表单中需要的一组数据可能来自于一个对象集合。例如：我们想让用户选择来自于我们
数据库中的城市的时候，我们有一个 <code>City</code> 模型：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">City</span><span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="ss">:name</span><span class="p">).</span><span class="nf">to_a</span>
<span class="c1"># =&gt; [</span>
<span class="c1">#      #&lt;City id: 3, name: "Berlin"&gt;,</span>
<span class="c1">#      #&lt;City id: 1, name: "Chicago"&gt;,</span>
<span class="c1">#      #&lt;City id: 2, name: "Madrid"&gt;</span>
<span class="c1">#    ]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='City.order(:name).to_a
# =&gt; [
#      #&lt;City id: 3, name: "Berlin"&gt;,
#      #&lt;City id: 1, name: "Chicago"&gt;,
#      #&lt;City id: 2, name: "Madrid"&gt;
#    ]
'>复制</button>
</div>
<p>Rails 提供了将一个将集合不需要复杂的循环就可以生成选择框的辅助方法。这些辅助方法通过调
用集合的每一个对象的特定方法探测选项值和标签文本。</p><h4 id="collection-select-辅助方法"><a class="anchorlink" href="#collection-select-%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95" data-turbolinks="false">5.1 <code>collection_select</code> 辅助方法</a></h4><p>生成城市选择框，我们可以使用 <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-collection_select"><code>collection_select</code></a>：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">collection_select</span> <span class="ss">:city_id</span><span class="p">,</span> <span class="no">City</span><span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="ss">:name</span><span class="p">),</span> <span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= form.collection_select :city_id, City.order(:name), :id, :name %&gt;
">复制</button>
</div>
<p>输出：</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"city_id"</span> <span class="na">id=</span><span class="s">"city_id"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"3"</span><span class="nt">&gt;</span>Berlin<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1"</span><span class="nt">&gt;</span>Chicago<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2"</span><span class="nt">&gt;</span>Madrid<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;select name="city_id" id="city_id"&gt;
  &lt;option value="3"&gt;Berlin&lt;/option&gt;
  &lt;option value="1"&gt;Chicago&lt;/option&gt;
  &lt;option value="2"&gt;Madrid&lt;/option&gt;
&lt;/select&gt;
'>复制</button>
</div>
<div class="note"><p>使用 <code>collection_select</code> 我们首先指定了值的方法（上例中的 <code>:id</code>），然后指定了
文本标签的方法（上例中的 <code>:name</code>）。这里与 <code>select</code> 辅助方法指定值和标签的顺序相反，
这里是先值后标签，那个则是先标签后值。</p></div><h4 id="collection-radio-buttons-辅助方法"><a class="anchorlink" href="#collection-radio-buttons-%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95" data-turbolinks="false">5.2 <code>collection_radio_buttons</code> 辅助方法</a></h4><p>生成一组城市的单选按钮可以使用 <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-collection_radio_buttons"><code>collection_radio_buttons</code></a>：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">collection_radio_buttons</span> <span class="ss">:city_id</span><span class="p">,</span> <span class="no">City</span><span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="ss">:name</span><span class="p">),</span> <span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= form.collection_radio_buttons :city_id, City.order(:name), :id, :name %&gt;
">复制</button>
</div>
<p>输出：</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"city_id"</span> <span class="na">value=</span><span class="s">"3"</span> <span class="na">id=</span><span class="s">"city_id_3"</span><span class="nt">&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"city_id_3"</span><span class="nt">&gt;</span>Berlin<span class="nt">&lt;/label&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"city_id"</span> <span class="na">value=</span><span class="s">"1"</span> <span class="na">id=</span><span class="s">"city_id_1"</span><span class="nt">&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"city_id_1"</span><span class="nt">&gt;</span>Chicago<span class="nt">&lt;/label&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"city_id"</span> <span class="na">value=</span><span class="s">"2"</span> <span class="na">id=</span><span class="s">"city_id_2"</span><span class="nt">&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"city_id_2"</span><span class="nt">&gt;</span>Madrid<span class="nt">&lt;/label&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;input type="radio" name="city_id" value="3" id="city_id_3"&gt;
&lt;label for="city_id_3"&gt;Berlin&lt;/label&gt;
&lt;input type="radio" name="city_id" value="1" id="city_id_1"&gt;
&lt;label for="city_id_1"&gt;Chicago&lt;/label&gt;
&lt;input type="radio" name="city_id" value="2" id="city_id_2"&gt;
&lt;label for="city_id_2"&gt;Madrid&lt;/label&gt;
'>复制</button>
</div>
<h4 id="collection-check-boxes-辅助方法"><a class="anchorlink" href="#collection-check-boxes-%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95" data-turbolinks="false">5.3 <code>collection_check_boxes</code> 辅助方法</a></h4><p>生成一组城市的复选框（允许用户可以选择不止一个），可以使用 <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-collection_check_boxes"><code>collection_check_boxes</code></a>：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">collection_check_boxes</span> <span class="ss">:city_id</span><span class="p">,</span> <span class="no">City</span><span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="ss">:name</span><span class="p">),</span> <span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= form.collection_check_boxes :city_id, City.order(:name), :id, :name %&gt;
">复制</button>
</div>
<p>输出：</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">"city_id[]"</span> <span class="na">value=</span><span class="s">"3"</span> <span class="na">id=</span><span class="s">"city_id_3"</span><span class="nt">&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"city_id_3"</span><span class="nt">&gt;</span>Berlin<span class="nt">&lt;/label&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">"city_id[]"</span> <span class="na">value=</span><span class="s">"1"</span> <span class="na">id=</span><span class="s">"city_id_1"</span><span class="nt">&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"city_id_1"</span><span class="nt">&gt;</span>Chicago<span class="nt">&lt;/label&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">"city_id[]"</span> <span class="na">value=</span><span class="s">"2"</span> <span class="na">id=</span><span class="s">"city_id_2"</span><span class="nt">&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"city_id_2"</span><span class="nt">&gt;</span>Madrid<span class="nt">&lt;/label&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;input type="checkbox" name="city_id[]" value="3" id="city_id_3"&gt;
&lt;label for="city_id_3"&gt;Berlin&lt;/label&gt;
&lt;input type="checkbox" name="city_id[]" value="1" id="city_id_1"&gt;
&lt;label for="city_id_1"&gt;Chicago&lt;/label&gt;
&lt;input type="checkbox" name="city_id[]" value="2" id="city_id_2"&gt;
&lt;label for="city_id_2"&gt;Madrid&lt;/label&gt;
'>复制</button>
</div>
<h3 id="上传文件"><a class="anchorlink" href="#%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6" data-turbolinks="false">6 上传文件</a></h3><p>上传一个人的照片或者一个 CSV 文件，这是比较常见的任务。文件上传字段可以使用 <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-file_field"><code>file_field</code></a> 辅助方法渲染
完成。</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@person</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">file_field</span> <span class="ss">:picture</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: @person do |form| %&gt;
  &lt;%= form.file_field :picture %&gt;
&lt;% end %&gt;
">复制</button>
</div>
<p>文件上传最重要需要记住的就是渲染表单的 <code>enctype</code> 属性<strong>必须</strong>是 "multipart/form-data"。
如果您在一个 <code>form_with</code> 块内使用 <code>file_field</code> 辅助方法，该属性会自动设置。否则您就需
要自行手动设置：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">url: </span><span class="s2">"/uploads"</span><span class="p">,</span> <span class="ss">multipart: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">file_field_tag</span> <span class="ss">:picture</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;%= form_with url: "/uploads", multipart: true do |form| %&gt;
  &lt;%= file_field_tag :picture %&gt;
&lt;% end %&gt;
'>复制</button>
</div>
<p>注意根据 <code>form_with</code> 的约定，上面两个表单的字段名是不一样的。第一个表单的字段名是  <code>person[picture]</code>
（通过 <code>params[:person][:picture]</code> 访问），第二个表单的字段名就是 <code>picture</code>（通过  <code>params[:picture]</code> 访问）。</p><h4 id="上传了什么"><a class="anchorlink" href="#%E4%B8%8A%E4%BC%A0%E4%BA%86%E4%BB%80%E4%B9%88" data-turbolinks="false">6.1 上传了什么</a></h4><p><code>params</code> 哈希中的对象是 <a href="https://edgeapi.rubyonrails.org/classes/ActionDispatch/Http/UploadedFile.html"><code>ActionDispatch::Http::UploadedFile</code></a> 的实例。下面代码将上传文件以原始文件名保存在 <code>#{Rails.root}/public/uploads</code> 目录下。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">upload</span>
  <span class="n">uploaded_file</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:picture</span><span class="p">]</span>
  <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="no">Rails</span><span class="p">.</span><span class="nf">root</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s1">'public'</span><span class="p">,</span> <span class="s1">'uploads'</span><span class="p">,</span> <span class="n">uploaded_file</span><span class="p">.</span><span class="nf">original_filename</span><span class="p">),</span> <span class="s1">'wb'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
    <span class="n">file</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">uploaded_file</span><span class="p">.</span><span class="nf">read</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="def upload
  uploaded_file = params[:picture]
  File.open(Rails.root.join('public', 'uploads', uploaded_file.original_filename), 'wb') do |file|
    file.write(uploaded_file.read)
  end
end
">复制</button>
</div>
<p>一旦文件上传成功，就会有许多相关的任务，包括文件的存储位置（磁盘、Amazon S3 等）、将
它们与模型关联、调整图像文件的大小以及生成缩略图等。<a href="active_storage_overview.html">Active Storage</a> 
设计的主旨就是协助完成这些任务。</p><h3 id="定制表单构造器"><a class="anchorlink" href="#%E5%AE%9A%E5%88%B6%E8%A1%A8%E5%8D%95%E6%9E%84%E9%80%A0%E5%99%A8" data-turbolinks="false">7 定制表单构造器</a></h3><p>The object yielded by <code>form_with</code> and <code>fields_for</code> is an instance of <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html"><code>ActionView::Helpers::FormBuilder</code></a>. Form builders encapsulate the notion of displaying form elements for a single object. While you can write helpers for your forms in the usual way, you can also create a subclass of <code>ActionView::Helpers::FormBuilder</code>, and add the helpers there. For example,</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@person</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">text_field_with_label</span> <span class="n">form</span><span class="p">,</span> <span class="ss">:first_name</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: @person do |form| %&gt;
  &lt;%= text_field_with_label form, :first_name %&gt;
&lt;% end %&gt;
">复制</button>
</div>
<p>can be replaced with</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@person</span><span class="p">,</span> <span class="ss">builder: </span><span class="no">LabellingFormBuilder</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:first_name</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: @person, builder: LabellingFormBuilder do |form| %&gt;
  &lt;%= form.text_field :first_name %&gt;
&lt;% end %&gt;
">复制</button>
</div>
<p>by defining a <code>LabellingFormBuilder</code> class similar to the following:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">LabellingFormBuilder</span> <span class="o">&lt;</span> <span class="no">ActionView</span><span class="o">::</span><span class="no">Helpers</span><span class="o">::</span><span class="no">FormBuilder</span>
  <span class="k">def</span> <span class="nf">text_field</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{})</span>
    <span class="n">label</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span> <span class="o">+</span> <span class="k">super</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class LabellingFormBuilder &lt; ActionView::Helpers::FormBuilder
  def text_field(attribute, options={})
    label(attribute) + super
  end
end
">复制</button>
</div>
<p>If you reuse this frequently you could define a <code>labeled_form_with</code> helper that automatically applies the <code>builder: LabellingFormBuilder</code> option:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">labeled_form_with</span><span class="p">(</span><span class="ss">model: </span><span class="kp">nil</span><span class="p">,</span> <span class="ss">scope: </span><span class="kp">nil</span><span class="p">,</span> <span class="ss">url: </span><span class="kp">nil</span><span class="p">,</span> <span class="ss">format: </span><span class="kp">nil</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="n">options</span><span class="p">.</span><span class="nf">merge!</span> <span class="ss">builder: </span><span class="no">LabellingFormBuilder</span>
  <span class="n">form_with</span> <span class="ss">model: </span><span class="n">model</span><span class="p">,</span> <span class="ss">scope: </span><span class="n">scope</span><span class="p">,</span> <span class="ss">url: </span><span class="n">url</span><span class="p">,</span> <span class="ss">format: </span><span class="nb">format</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="def labeled_form_with(model: nil, scope: nil, url: nil, format: nil, **options, &amp;block)
  options.merge! builder: LabellingFormBuilder
  form_with model: model, scope: scope, url: url, format: format, **options, &amp;block
end
">复制</button>
</div>
<p>The form builder used also determines what happens when you do:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="n">f</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= render partial: f %&gt;
">复制</button>
</div>
<p>If <code>f</code> is an instance of <code>ActionView::Helpers::FormBuilder</code>, then this will render the <code>form</code> partial, setting the partial's object to the form builder. If the form builder is of class <code>LabellingFormBuilder</code>, then the <code>labelling_form</code> partial would be rendered instead.</p><h3 id="理解参数命名约定"><a class="anchorlink" href="#%E7%90%86%E8%A7%A3%E5%8F%82%E6%95%B0%E5%91%BD%E5%90%8D%E7%BA%A6%E5%AE%9A" data-turbolinks="false">8 理解参数命名约定</a></h3><p>Values from forms can be at the top level of the <code>params</code> hash or nested in another hash. For example, in a standard <code>create</code> action for a Person model, <code>params[:person]</code> would usually be a hash of all the attributes for the person to create. The <code>params</code> hash can also contain arrays, arrays of hashes, and so on.</p><p>Fundamentally HTML forms don't know about any sort of structured data, all they generate is name-value pairs, where pairs are just plain strings. The arrays and hashes you see in your application are the result of some parameter naming conventions that Rails uses.</p><h4 id="基本构成"><a class="anchorlink" href="#%E5%9F%BA%E6%9C%AC%E6%9E%84%E6%88%90" data-turbolinks="false">8.1 基本构成</a></h4><p>The two basic structures are arrays and hashes. Hashes mirror the syntax used for accessing the value in <code>params</code>. For example, if a form contains:</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"person_name"</span> <span class="na">name=</span><span class="s">"person[name]"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">"Henry"</span><span class="nt">/&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;input id="person_name" name="person[name]" type="text" value="Henry"/&gt;
'>复制</button>
</div>
<p>the <code>params</code> hash will contain</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="s1">'person'</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Henry'</span><span class="p">}}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="{'person' =&gt; {'name' =&gt; 'Henry'}}
">复制</button>
</div>
<p>and <code>params[:person][:name]</code> will retrieve the submitted value in the controller.</p><p>Hashes can be nested as many levels as required, for example:</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"person_address_city"</span> <span class="na">name=</span><span class="s">"person[address][city]"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">"New York"</span><span class="nt">/&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;input id="person_address_city" name="person[address][city]" type="text" value="New York"/&gt;
'>复制</button>
</div>
<p>will result in the <code>params</code> hash being</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="s1">'person'</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="s1">'address'</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="s1">'city'</span> <span class="o">=&gt;</span> <span class="s1">'New York'</span><span class="p">}}}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="{'person' =&gt; {'address' =&gt; {'city' =&gt; 'New York'}}}
">复制</button>
</div>
<p>Normally Rails ignores duplicate parameter names. If the parameter name ends with an empty set of square brackets <code>[]</code> then they will be accumulated in an array. If you wanted users to be able to input multiple phone numbers, you could place this in the form:</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"person[phone_number][]"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"person[phone_number][]"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"person[phone_number][]"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">/&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;input name="person[phone_number][]" type="text"/&gt;
&lt;input name="person[phone_number][]" type="text"/&gt;
&lt;input name="person[phone_number][]" type="text"/&gt;
'>复制</button>
</div>
<p>This would result in <code>params[:person][:phone_number]</code> being an array containing the inputted phone numbers.</p><h4 id="组合它们"><a class="anchorlink" href="#%E7%BB%84%E5%90%88%E5%AE%83%E4%BB%AC" data-turbolinks="false">8.2 组合它们</a></h4><p>We can mix and match these two concepts. One element of a hash might be an array as in the previous example, or you can have an array of hashes. For example, a form might let you create any number of addresses by repeating the following form fragment</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"person[addresses][][line1]"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"person[addresses][][line2]"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"person[addresses][][city]"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"person[addresses][][line1]"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"person[addresses][][line2]"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"person[addresses][][city]"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">/&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;input name="person[addresses][][line1]" type="text"/&gt;
&lt;input name="person[addresses][][line2]" type="text"/&gt;
&lt;input name="person[addresses][][city]" type="text"/&gt;
&lt;input name="person[addresses][][line1]" type="text"/&gt;
&lt;input name="person[addresses][][line2]" type="text"/&gt;
&lt;input name="person[addresses][][city]" type="text"/&gt;
'>复制</button>
</div>
<p>This would result in <code>params[:person][:addresses]</code> being an array of hashes with keys <code>line1</code>, <code>line2</code>, and <code>city</code>.</p><p>There's a restriction, however: while hashes can be nested arbitrarily, only one level of "arrayness" is allowed. Arrays can usually be replaced by hashes; for example, instead of having an array of model objects, one can have a hash of model objects keyed by their id, an array index, or some other parameter.</p><div class="warning"><p>Array parameters do not play well with the <code>check_box</code> helper. According to the HTML specification unchecked checkboxes submit no value. However it is often convenient for a checkbox to always submit a value. The <code>check_box</code> helper fakes this by creating an auxiliary hidden input with the same name. If the checkbox is unchecked only the hidden input is submitted and if it is checked then both are submitted but the value submitted by the checkbox takes precedence.</p></div><h4 id="fields-for-辅助方法和-index-选项"><a class="anchorlink" href="#fields-for-%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95%E5%92%8C-index-%E9%80%89%E9%A1%B9" data-turbolinks="false">8.3 <code>fields_for</code> 辅助方法和 <code>:index</code> 选项</a></h4><p>Let's say we want to render a form with a set of fields for each of a person's
addresses. The <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-fields_for"><code>fields_for</code></a> helper with its <code>:index</code> option can assist:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@person</span> <span class="k">do</span> <span class="o">|</span><span class="n">person_form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">person_form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@person</span><span class="p">.</span><span class="nf">addresses</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">address</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">person_form</span><span class="p">.</span><span class="nf">fields_for</span> <span class="n">address</span><span class="p">,</span> <span class="ss">index: </span><span class="n">address</span><span class="p">.</span><span class="nf">id</span> <span class="k">do</span> <span class="o">|</span><span class="n">address_form</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">address_form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:city</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: @person do |person_form| %&gt;
  &lt;%= person_form.text_field :name %&gt;
  &lt;% @person.addresses.each do |address| %&gt;
    &lt;%= person_form.fields_for address, index: address.id do |address_form| %&gt;
      &lt;%= address_form.text_field :city %&gt;
    &lt;% end %&gt;
  &lt;% end %&gt;
&lt;% end %&gt;
">复制</button>
</div>
<p>Assuming the person has two addresses with IDs 23 and 45, the above form would
render output similar to:</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">action=</span><span class="s">"/people/1"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"_method"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"patch"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"person_name"</span> <span class="na">name=</span><span class="s">"person[name]"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"person_address_23_city"</span> <span class="na">name=</span><span class="s">"person[address][23][city]"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"person_address_45_city"</span> <span class="na">name=</span><span class="s">"person[address][45][city]"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;form accept-charset="UTF-8" action="/people/1" method="post"&gt;
  &lt;input name="_method" type="hidden" value="patch" /&gt;
  &lt;input id="person_name" name="person[name]" type="text" /&gt;
  &lt;input id="person_address_23_city" name="person[address][23][city]" type="text" /&gt;
  &lt;input id="person_address_45_city" name="person[address][45][city]" type="text" /&gt;
&lt;/form&gt;
'>复制</button>
</div>
<p>Which will result in a <code>params</code> hash that looks like:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="s2">"person"</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="s2">"Bob"</span><span class="p">,</span>
    <span class="s2">"address"</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="s2">"23"</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="s2">"city"</span> <span class="o">=&gt;</span> <span class="s2">"Paris"</span>
      <span class="p">},</span>
      <span class="s2">"45"</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="s2">"city"</span> <span class="o">=&gt;</span> <span class="s2">"London"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{
  "person" =&gt; {
    "name" =&gt; "Bob",
    "address" =&gt; {
      "23" =&gt; {
        "city" =&gt; "Paris"
      },
      "45" =&gt; {
        "city" =&gt; "London"
      }
    }
  }
}
'>复制</button>
</div>
<p>All of the form inputs map to the <code>"person"</code> hash because we called <code>fields_for</code>
on the <code>person_form</code> form builder. By specifying an <code>:index</code> option, we mapped
the address inputs to <code>person[address][#{address.id}][city]</code> instead of
<code>person[address][city]</code>. Thus we are able to determine which Address records
should be modified when processing the <code>params</code> hash.</p><p>You can pass other numbers or strings of significance via the <code>:index</code> option.
You can even pass <code>nil</code>, which will produce an array parameter.</p><p>To create more intricate nestings, you can specify the leading portion of the
input name explicitly. For example:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">fields_for</span> <span class="s1">'person[address][primary]'</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="ss">index: </span><span class="n">address</span><span class="p">.</span><span class="nf">id</span> <span class="k">do</span> <span class="o">|</span><span class="n">address_form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">address_form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:city</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= fields_for 'person[address][primary]', address, index: address.id do |address_form| %&gt;
  &lt;%= address_form.text_field :city %&gt;
&lt;% end %&gt;
">复制</button>
</div>
<p>will create inputs like:</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"person_address_primary_23_city"</span> <span class="na">name=</span><span class="s">"person[address][primary][23][city]"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">"Paris"</span> <span class="nt">/&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;input id="person_address_primary_23_city" name="person[address][primary][23][city]" type="text" value="Paris" /&gt;
'>复制</button>
</div>
<p>You can also pass an <code>:index</code> option directly to helpers such as <code>text_field</code>,
but it is usually less repetitive to specify this at the form builder level
than on individual input fields.</p><p>Speaking generally, the final input name will be a concatenation of the name
given to <code>fields_for</code> / <code>form_with</code>, the <code>:index</code> option value, and the name of
the attribute.</p><p>Lastly, as a shortcut, instead of specifying an ID for <code>:index</code> (e.g.
<code>index: address.id</code>), you can append <code>"[]"</code> to the given name. For example:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">fields_for</span> <span class="s1">'person[address][primary][]'</span><span class="p">,</span> <span class="n">address</span> <span class="k">do</span> <span class="o">|</span><span class="n">address_form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">address_form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:city</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= fields_for 'person[address][primary][]', address do |address_form| %&gt;
  &lt;%= address_form.text_field :city %&gt;
&lt;% end %&gt;
">复制</button>
</div>
<p>produces exactly the same output as our original example.</p><h3 id="表单扩展资源"><a class="anchorlink" href="#%E8%A1%A8%E5%8D%95%E6%89%A9%E5%B1%95%E8%B5%84%E6%BA%90" data-turbolinks="false">9 表单扩展资源</a></h3><p>Rails' form helpers can also be used to build a form for posting data to an external resource. However, at times it can be necessary to set an <code>authenticity_token</code> for the resource; this can be done by passing an <code>authenticity_token: 'your_external_token'</code> parameter to the <code>form_with</code> options:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">url: </span><span class="s1">'http://farfar.away/form'</span><span class="p">,</span> <span class="ss">authenticity_token: </span><span class="s1">'external_token'</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  Form contents
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= form_with url: 'http://farfar.away/form', authenticity_token: 'external_token' do %&gt;
  Form contents
&lt;% end %&gt;
">复制</button>
</div>
<p>Sometimes when submitting data to an external resource, like a payment gateway, the fields that can be used in the form are limited by an external API and it may be undesirable to generate an <code>authenticity_token</code>. To not send a token, simply pass <code>false</code> to the <code>:authenticity_token</code> option:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">url: </span><span class="s1">'http://farfar.away/form'</span><span class="p">,</span> <span class="ss">authenticity_token: </span><span class="kp">false</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  Form contents
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= form_with url: 'http://farfar.away/form', authenticity_token: false do %&gt;
  Form contents
&lt;% end %&gt;
">复制</button>
</div>
<h3 id="构建复杂表单"><a class="anchorlink" href="#%E6%9E%84%E5%BB%BA%E5%A4%8D%E6%9D%82%E8%A1%A8%E5%8D%95" data-turbolinks="false">10 构建复杂表单</a></h3><p>Many apps grow beyond simple forms editing a single object. For example, when creating a <code>Person</code> you might want to allow the user to (on the same form) create multiple address records (home, work, etc.). When later editing that person the user should be able to add, remove, or amend addresses as necessary.</p><h4 id="配置模型"><a class="anchorlink" href="#%E9%85%8D%E7%BD%AE%E6%A8%A1%E5%9E%8B" data-turbolinks="false">10.1 配置模型</a></h4><p>Active Record provides model level support via the <a href="https://edgeapi.rubyonrails.org/classes/ActiveRecord/NestedAttributes/ClassMethods.html#method-i-accepts_nested_attributes_for"><code>accepts_nested_attributes_for</code></a> method:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:addresses</span><span class="p">,</span> <span class="ss">inverse_of: :person</span>
  <span class="n">accepts_nested_attributes_for</span> <span class="ss">:addresses</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Address</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:person</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person &lt; ApplicationRecord
  has_many :addresses, inverse_of: :person
  accepts_nested_attributes_for :addresses
end

class Address &lt; ApplicationRecord
  belongs_to :person
end
">复制</button>
</div>
<p>This creates an <code>addresses_attributes=</code> method on <code>Person</code> that allows you to create, update, and (optionally) destroy addresses.</p><h4 id="嵌套表单"><a class="anchorlink" href="#%E5%B5%8C%E5%A5%97%E8%A1%A8%E5%8D%95" data-turbolinks="false">10.2 嵌套表单</a></h4><p>The following form allows a user to create a <code>Person</code> and its associated addresses.</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@person</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  Addresses:
  <span class="nt">&lt;ul&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">fields_for</span> <span class="ss">:addresses</span> <span class="k">do</span> <span class="o">|</span><span class="n">addresses_form</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">addresses_form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:kind</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">addresses_form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:kind</span> <span class="cp">%&gt;</span>

        <span class="cp">&lt;%=</span> <span class="n">addresses_form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:street</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">addresses_form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:street</span> <span class="cp">%&gt;</span>
        ...
      <span class="nt">&lt;/li&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: @person do |form| %&gt;
  Addresses:
  &lt;ul&gt;
    &lt;%= form.fields_for :addresses do |addresses_form| %&gt;
      &lt;li&gt;
        &lt;%= addresses_form.label :kind %&gt;
        &lt;%= addresses_form.text_field :kind %&gt;

        &lt;%= addresses_form.label :street %&gt;
        &lt;%= addresses_form.text_field :street %&gt;
        ...
      &lt;/li&gt;
    &lt;% end %&gt;
  &lt;/ul&gt;
&lt;% end %&gt;
">复制</button>
</div>
<p>When an association accepts nested attributes <code>fields_for</code> renders its block once for every element of the association. In particular, if a person has no addresses it renders nothing. A common pattern is for the controller to build one or more empty children so that at least one set of fields is shown to the user. The example below would result in 2 sets of address fields being rendered on the new person form.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">new</span>
  <span class="vi">@person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
  <span class="mi">2</span><span class="p">.</span><span class="nf">times</span> <span class="p">{</span> <span class="vi">@person</span><span class="p">.</span><span class="nf">addresses</span><span class="p">.</span><span class="nf">build</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="def new
  @person = Person.new
  2.times { @person.addresses.build }
end
">复制</button>
</div>
<p>The <code>fields_for</code> yields a form builder. The parameters' name will be what
<code>accepts_nested_attributes_for</code> expects. For example, when creating a user with
2 addresses, the submitted parameters would look like:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="s1">'person'</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'John Doe'</span><span class="p">,</span>
    <span class="s1">'addresses_attributes'</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="s1">'0'</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="s1">'kind'</span> <span class="o">=&gt;</span> <span class="s1">'Home'</span><span class="p">,</span>
        <span class="s1">'street'</span> <span class="o">=&gt;</span> <span class="s1">'221b Baker Street'</span>
      <span class="p">},</span>
      <span class="s1">'1'</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="s1">'kind'</span> <span class="o">=&gt;</span> <span class="s1">'Office'</span><span class="p">,</span>
        <span class="s1">'street'</span> <span class="o">=&gt;</span> <span class="s1">'31 Spooner Street'</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="{
  'person' =&gt; {
    'name' =&gt; 'John Doe',
    'addresses_attributes' =&gt; {
      '0' =&gt; {
        'kind' =&gt; 'Home',
        'street' =&gt; '221b Baker Street'
      },
      '1' =&gt; {
        'kind' =&gt; 'Office',
        'street' =&gt; '31 Spooner Street'
      }
    }
  }
}
">复制</button>
</div>
<p>The keys of the <code>:addresses_attributes</code> hash are unimportant, they need merely be different for each address.</p><p>If the associated object is already saved, <code>fields_for</code> autogenerates a hidden input with the <code>id</code> of the saved record. You can disable this by passing <code>include_id: false</code> to <code>fields_for</code>.</p><h4 id="控制器"><a class="anchorlink" href="#%E6%8E%A7%E5%88%B6%E5%99%A8" data-turbolinks="false">10.3 控制器</a></h4><p>As usual you need to
<a href="action_controller_overview.html#strong-parameters">declare the permitted parameters</a> in
the controller before you pass them to the model:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">create</span>
  <span class="vi">@person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">person_params</span><span class="p">)</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="kp">private</span>
  <span class="k">def</span> <span class="nf">person_params</span>
    <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:person</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">addresses_attributes: </span><span class="p">[</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:kind</span><span class="p">,</span> <span class="ss">:street</span><span class="p">])</span>
  <span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="def create
  @person = Person.new(person_params)
  # ...
end

private
  def person_params
    params.require(:person).permit(:name, addresses_attributes: [:id, :kind, :street])
  end
">复制</button>
</div>
<h4 id="删除对象"><a class="anchorlink" href="#%E5%88%A0%E9%99%A4%E5%AF%B9%E8%B1%A1" data-turbolinks="false">10.4 删除对象</a></h4><p>You can allow users to delete associated objects by passing <code>allow_destroy: true</code> to <code>accepts_nested_attributes_for</code></p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:addresses</span>
  <span class="n">accepts_nested_attributes_for</span> <span class="ss">:addresses</span><span class="p">,</span> <span class="ss">allow_destroy: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person &lt; ApplicationRecord
  has_many :addresses
  accepts_nested_attributes_for :addresses, allow_destroy: true
end
">复制</button>
</div>
<p>If the hash of attributes for an object contains the key <code>_destroy</code> with a value that
evaluates to <code>true</code> (e.g. 1, '1', true, or 'true') then the object will be destroyed.
This form allows users to remove addresses:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@person</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  Addresses:
  <span class="nt">&lt;ul&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">fields_for</span> <span class="ss">:addresses</span> <span class="k">do</span> <span class="o">|</span><span class="n">addresses_form</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">addresses_form</span><span class="p">.</span><span class="nf">check_box</span> <span class="ss">:_destroy</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">addresses_form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:kind</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">addresses_form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:kind</span> <span class="cp">%&gt;</span>
        ...
      <span class="nt">&lt;/li&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: @person do |form| %&gt;
  Addresses:
  &lt;ul&gt;
    &lt;%= form.fields_for :addresses do |addresses_form| %&gt;
      &lt;li&gt;
        &lt;%= addresses_form.check_box :_destroy %&gt;
        &lt;%= addresses_form.label :kind %&gt;
        &lt;%= addresses_form.text_field :kind %&gt;
        ...
      &lt;/li&gt;
    &lt;% end %&gt;
  &lt;/ul&gt;
&lt;% end %&gt;
">复制</button>
</div>
<p>Don't forget to update the permitted params in your controller to also include
the <code>_destroy</code> field:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">person_params</span>
  <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:person</span><span class="p">).</span>
    <span class="nf">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">addresses_attributes: </span><span class="p">[</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:kind</span><span class="p">,</span> <span class="ss">:street</span><span class="p">,</span> <span class="ss">:_destroy</span><span class="p">])</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="def person_params
  params.require(:person).
    permit(:name, addresses_attributes: [:id, :kind, :street, :_destroy])
end
">复制</button>
</div>
<h4 id="阻止空记录"><a class="anchorlink" href="#%E9%98%BB%E6%AD%A2%E7%A9%BA%E8%AE%B0%E5%BD%95" data-turbolinks="false">10.5 阻止空记录</a></h4><p>It is often useful to ignore sets of fields that the user has not filled in. You can control this by passing a <code>:reject_if</code> proc to <code>accepts_nested_attributes_for</code>. This proc will be called with each hash of attributes submitted by the form. If the proc returns <code>true</code> then Active Record will not build an associated object for that hash. The example below only tries to build an address if the <code>kind</code> attribute is set.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:addresses</span>
  <span class="n">accepts_nested_attributes_for</span> <span class="ss">:addresses</span><span class="p">,</span> <span class="ss">reject_if: </span><span class="nb">lambda</span> <span class="p">{</span><span class="o">|</span><span class="n">attributes</span><span class="o">|</span> <span class="n">attributes</span><span class="p">[</span><span class="s1">'kind'</span><span class="p">].</span><span class="nf">blank?</span><span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Person &lt; ApplicationRecord
  has_many :addresses
  accepts_nested_attributes_for :addresses, reject_if: lambda {|attributes| attributes['kind'].blank?}
end
">复制</button>
</div>
<p>As a convenience you can instead pass the symbol <code>:all_blank</code> which will create a proc that will reject records where all the attributes are blank excluding any value for <code>_destroy</code>.</p><h4 id="凭空添加字段"><a class="anchorlink" href="#%E5%87%AD%E7%A9%BA%E6%B7%BB%E5%8A%A0%E5%AD%97%E6%AE%B5" data-turbolinks="false">10.6 凭空添加字段</a></h4><p>Rather than rendering multiple sets of fields ahead of time you may wish to add them only when a user clicks on an "Add new address" button. Rails does not provide any built-in support for this. When generating new sets of fields you must ensure the key of the associated array is unique - the current JavaScript date (milliseconds since the <a href="https://en.wikipedia.org/wiki/Unix_time">epoch</a>) is a common choice.</p><h3 id="脱离表单构造器使用-tag-辅助方法"><a class="anchorlink" href="#%E8%84%B1%E7%A6%BB%E8%A1%A8%E5%8D%95%E6%9E%84%E9%80%A0%E5%99%A8%E4%BD%BF%E7%94%A8-tag-%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95" data-turbolinks="false">11 脱离表单构造器使用 Tag 辅助方法</a></h3><p>In case you need to render form fields outside of the context of a form builder, Rails provides tag helpers for common form elements. For example, <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormTagHelper.html#method-i-check_box_tag"><code>check_box_tag</code></a>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">check_box_tag</span> <span class="s2">"accept"</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;%= check_box_tag "accept" %&gt;
'>复制</button>
</div>
<p>Output:</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">"accept"</span> <span class="na">id=</span><span class="s">"accept"</span> <span class="na">value=</span><span class="s">"1"</span> <span class="nt">/&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;input type="checkbox" name="accept" id="accept" value="1" /&gt;
'>复制</button>
</div>
<p>Generally, these helpers have the same name as their form builder counterparts plus a <code>_tag</code> suffix.  For a complete list, see the <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormTagHelper.html"><code>FormTagHelper</code> API documentation</a>.</p><h3 id="使用-form-tag-和-form-for"><a class="anchorlink" href="#%E4%BD%BF%E7%94%A8-form-tag-%E5%92%8C-form-for" data-turbolinks="false">12 使用 <code>form_tag</code> 和 <code>form_for</code></a></h3><p>Before <code>form_with</code> was introduced in Rails 5.1 its functionality used to be split between <a href="https://api.rubyonrails.org/v5.2/classes/ActionView/Helpers/FormTagHelper.html#method-i-form_tag"><code>form_tag</code></a> and <a href="https://api.rubyonrails.org/v5.2/classes/ActionView/Helpers/FormHelper.html#method-i-form_for"><code>form_for</code></a>. Both are now soft-deprecated. Documentation on their usage can be found in <a href="https://guides.rubyonrails.org/v5.2/form_helpers.html">older versions of this guide</a>.</p>

        <h3>反馈</h3>
        <p>
          衷心希望您能帮我们提升指南质量。
        </p>
        <p>
          您发现任何错误都可以帮助我们。
          如果想要参与贡献可以参阅<a href="https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">文档贡献</a>章节获取相关细节。
        </p>
        <p>
          如果您发现有内容不完整或者有些内容需要更新，请进行相关补充和完善。
          开始之前要检查一下
          <a href="https://edgeguides.rubyonrails.org">抢鲜版指南</a>中是否
          已经修复了这些问题，或者这些问题是否出现在主分支（main branch）内。
          如果以上检查完成后，确认为需要完善文档，请参考<a href="ruby_on_rails_guides_guidelines.html">《Ruby on Rails 指南》之指南</a>，
          以确保您使用了正确的编写风格和编写习惯。
        </p>
        <p>
          如果您发现了一个问题，但是自己不会修复，请在 Github 
          <a href="https://github.com/rails/rails/issues">发一个问题帖子</a>。
        </p>
        <p>最后，但并非不重要的是——<a href="https://discuss.rubyonrails.org/c/rubyonrails-docs">Rubyonrails-Docs 邮件列表</a>
        欢迎大家提出任何关于 Ruby on Rails 文档的问题。
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>本作品基于<a href="https://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a>创作共享</p>
<p>“Rails”、“Ruby on Rails” 和 Rails 标志都是 David Heinemeier Hansson 注册的商标，版权所有。</p>

    </div>
  </div>
  <button id="back2Top">▲</button>
  <script>
		const button = document.querySelector("#back2Top");
		BACK2TOP(button, 200);
	</script>	
</body>
</html>
